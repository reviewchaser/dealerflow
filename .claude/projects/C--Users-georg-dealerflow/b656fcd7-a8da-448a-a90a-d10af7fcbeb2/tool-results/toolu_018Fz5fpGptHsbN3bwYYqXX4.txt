     1→/**
     2→ * Tenant Stock Page - /app/[dealerSlug]/stock
     3→ * Wraps the existing sales-prep functionality with tenant context
     4→ */
     5→
     6→import Head from "next/head";
     7→import { TenantPage, withTenantProps } from "@/components/TenantPage";
     8→import { useDealer } from "@/contexts/DealerContext";
     9→import { useState, useEffect, useCallback } from "react";
    10→import VehicleDrawer from "@/components/VehicleDrawer";
    11→
    12→// Status mapping for display
    13→const STATUS_LABELS = {
    14→  in_stock: "In Prep",
    15→  in_prep: "Advertised",
    16→  live: "Sold In Progress",
    17→  reserved: "Completed",
    18→  delivered: "Delivered",
    19→};
    20→
    21→const STATUS_COLORS = {
    22→  in_stock: "bg-blue-100 text-blue-700",
    23→  in_prep: "bg-amber-100 text-amber-700",
    24→  live: "bg-emerald-100 text-emerald-700",
    25→  reserved: "bg-purple-100 text-purple-700",
    26→  delivered: "bg-slate-100 text-slate-600",
    27→};
    28→
    29→export default function TenantStock({ dealer, dealerSlug, error }) {
    30→  const { fetchWithTenant, tenantPath } = useDealer();
    31→  const [vehicles, setVehicles] = useState([]);
    32→  const [isLoading, setIsLoading] = useState(true);
    33→  const [selectedVehicle, setSelectedVehicle] = useState(null);
    34→  const [drawerOpen, setDrawerOpen] = useState(false);
    35→  const [statusFilter, setStatusFilter] = useState("all");
    36→
    37→  const loadVehicles = useCallback(async () => {
    38→    try {
    39→      const res = await fetchWithTenant("/api/vehicles");
    40→      if (res.ok) {
    41→        const data = await res.json();
    42→        setVehicles(data);
    43→      }
    44→    } catch (err) {
    45→      console.error("Error loading vehicles:", err);
    46→    } finally {
    47→      setIsLoading(false);
    48→    }
    49→  }, [fetchWithTenant]);
    50→
    51→  useEffect(() => {
    52→    if (!error) loadVehicles();
    53→  }, [error, loadVehicles]);
    54→
    55→  const openDrawer = (vehicle) => {
    56→    setSelectedVehicle(vehicle);
    57→    setDrawerOpen(true);
    58→  };
    59→
    60→  const closeDrawer = () => {
    61→    setDrawerOpen(false);
    62→    setSelectedVehicle(null);
    63→  };
    64→
    65→  const filteredVehicles = vehicles.filter(v =>
    66→    statusFilter === "all" || v.status === statusFilter
    67→  );
    68→
    69→  const statusCounts = vehicles.reduce((acc, v) => {
    70→    acc[v.status] = (acc[v.status] || 0) + 1;
    71→    return acc;
    72→  }, {});
    73→
    74→  return (
    75→    <TenantPage dealer={dealer} dealerSlug={dealerSlug} error={error}>
    76→      <Head><title>Stock | {dealer?.name || 'DealerFlow'}</title></Head>
    77→
    78→      <div className="mb-6">
    79→        <h1 className="text-2xl font-bold text-slate-900">Stock & Prep</h1>
    80→        <p className="text-slate-600 mt-1">Manage your vehicle inventory</p>
    81→      </div>
    82→
    83→      {/* Status filter tabs */}
    84→      <div className="flex flex-wrap gap-2 mb-6">
    85→        <button
    86→          onClick={() => setStatusFilter("all")}
    87→          className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
    88→            statusFilter === "all" ? "bg-[#0066CC] text-white" : "bg-slate-100 text-slate-600 hover:bg-slate-200"
    89→          }`}
    90→        >
    91→          All ({vehicles.length})
    92→        </button>
    93→        {Object.entries(STATUS_LABELS).map(([status, label]) => (
    94→          <button
    95→            key={status}
    96→            onClick={() => setStatusFilter(status)}
    97→            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
    98→              statusFilter === status ? "bg-[#0066CC] text-white" : "bg-slate-100 text-slate-600 hover:bg-slate-200"
    99→            }`}
   100→          >
   101→            {label} ({statusCounts[status] || 0})
   102→          </button>
   103→        ))}
   104→      </div>
   105→
   106→      {isLoading ? (
   107→        <div className="flex justify-center py-20">
   108→          <div className="w-12 h-12 border-4 border-[#0066CC]/20 border-t-[#0066CC] rounded-full animate-spin" />
   109→        </div>
   110→      ) : filteredVehicles.length === 0 ? (
   111→        <div className="text-center py-20 bg-white rounded-2xl border border-slate-100">
   112→          <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
   113→            <svg className="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   114→              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M8 7h8m-8 4h8m-8 4h4m-7 4h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
   115→            </svg>
   116→          </div>
   117→          <h3 className="text-lg font-semibold text-slate-900 mb-2">No vehicles found</h3>
   118→          <p className="text-slate-500">Add your first vehicle to get started</p>
   119→        </div>
   120→      ) : (
   121→        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
   122→          {filteredVehicles.map((vehicle) => (
   123→            <div
   124→              key={vehicle.id}
   125→              onClick={() => openDrawer(vehicle)}
   126→              className="bg-white rounded-xl border border-slate-200 p-4 hover:shadow-lg hover:border-[#0066CC]/30 transition-all cursor-pointer"
   127→            >
   128→              <div className="flex items-start justify-between mb-3">
   129→                <div>
   130→                  <p className="font-mono text-lg font-bold text-slate-900">{vehicle.regCurrent}</p>
   131→                  <p className="text-sm text-slate-600">{vehicle.make} {vehicle.model}</p>
   132→                </div>
   133→                <span className={`px-2.5 py-1 rounded-full text-xs font-semibold ${STATUS_COLORS[vehicle.status]}`}>
   134→                  {STATUS_LABELS[vehicle.status]}
   135→                </span>
   136→              </div>
   137→              <div className="flex items-center gap-4 text-sm text-slate-500">
   138→                {vehicle.year && <span>{vehicle.year}</span>}
   139→                {vehicle.colour && <span>{vehicle.colour}</span>}
   140→                {vehicle.mileageCurrent && <span>{Number(vehicle.mileageCurrent).toLocaleString()} mi</span>}
   141→              </div>
   142→              {vehicle.dvlaDetails?.fuelType && (
   143→                <div className="mt-2 flex items-center gap-2">
   144→                  <span className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">
   145→                    {vehicle.dvlaDetails.fuelType}
   146→                  </span>
   147→                  {vehicle.dvlaDetails.engineCapacity && (
   148→                    <span className="px-2 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">
   149→                      {vehicle.dvlaDetails.engineCapacity}cc
   150→                    </span>
   151→                  )}
   152→                </div>
   153→              )}
   154→            </div>
   155→          ))}
   156→        </div>
   157→      )}
   158→
   159→      {/* Vehicle Drawer */}
   160→      <VehicleDrawer
   161→        vehicle={selectedVehicle}
   162→        isOpen={drawerOpen}
   163→        onClose={closeDrawer}
   164→        onUpdate={loadVehicles}
   165→      />
   166→    </TenantPage>
   167→  );
   168→}
   169→
   170→export const getServerSideProps = withTenantProps();
   171→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
