  4917→        const data = await res.json();
  4918→        // Store S3 key (permanent) if available, otherwise use URL (for local dev)
  4919→        uploadedUrls.push(data.key || data.url);
  4920→      }
  4921→    }
  4922→    return uploadedUrls;
  4923→  };
  4924→
  4925→  const handleSubmit = async (e) => {
  4926→    e.preventDefault();
  4927→    setIsLoading(true);
  4928→    try {
  4929→      // Upload photos first if any
  4930→      let photoUrls = [];
  4931→      if (photoFiles.length > 0) {
  4932→        setIsUploadingPhotos(true);
  4933→        photoUrls = await uploadPhotos();
  4934→        setIsUploadingPhotos(false);
  4935→      }
  4936→      // Pass photo URLs/keys to onSubmit
  4937→      await onSubmit(photoUrls);
  4938→    } finally {
  4939→      setIsLoading(false);
  4940→    }
  4941→  };
  4942→
  4943→  return (
  4944→    <div className="modal modal-open">
  4945→      <div className="modal-box max-w-2xl bg-white">
  4946→        <div className="flex items-center justify-between mb-6">
  4947→          <h3 className="text-xl font-bold text-slate-900">Add Issue</h3>
  4948→          <button
  4949→            type="button"
  4950→            onClick={onClose}
  4951→            className="p-2 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-all duration-200"
  4952→          >
  4953→            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  4954→              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
  4955→            </svg>
  4956→          </button>
  4957→        </div>
  4958→        <form onSubmit={handleSubmit}>
  4959→          <div className="grid grid-cols-2 gap-4">
  4960→            <div className="form-control">
  4961→              <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Category *</label>
  4962→              <select
  4963→                className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none appearance-none cursor-pointer"
  4964→                value={issueForm.category}
  4965→                onChange={(e) => {
  4966→                  setIssueForm({ ...issueForm, category: e.target.value, subcategory: "" });
  4967→                }}
  4968→                required
  4969→              >
  4970→                <option value="">Select category...</option>
  4971→                <option value="mechanical">Mechanical</option>
  4972→                <option value="electrical">Electrical</option>
  4973→                <option value="bodywork">Bodywork</option>
  4974→                <option value="interior">Interior</option>
  4975→                <option value="tyres">Tyres</option>
  4976→                <option value="mot">MOT</option>
  4977→                <option value="service">Service</option>
  4978→                <option value="fault_codes">Fault Codes</option>
  4979→                <option value="other">Other</option>
  4980→              </select>
  4981→            </div>
  4982→
  4983→            {issueForm.category && (
  4984→              <div className="form-control">
  4985→                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Subcategory</label>
  4986→                <select
  4987→                  className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none appearance-none cursor-pointer"
  4988→                  value={issueForm.subcategory}
  4989→                  onChange={(e) => setIssueForm({ ...issueForm, subcategory: e.target.value })}
  4990→                >
  4991→                  <option value="">Select subcategory...</option>
  4992→                  {ISSUE_SUBCATEGORIES[issueForm.category]?.map((sub) => (
  4993→                    <option key={sub} value={sub}>{sub}</option>
  4994→                  ))}
  4995→                </select>
  4996→              </div>
  4997→            )}
  4998→
  4999→            {/* Fault Codes field - only show for fault_codes category */}
  5000→            {issueForm.category === "fault_codes" && (
  5001→              <div className="form-control col-span-2">
  5002→                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Fault Codes</label>
  5003→                <input
  5004→                  type="text"
  5005→                  className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 font-mono placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none"
  5006→                  value={issueForm.faultCodes || ""}
  5007→                  onChange={(e) => setIssueForm({ ...issueForm, faultCodes: e.target.value })}
  5008→                  placeholder="e.g. P0301, P0420, C1234"
  5009→                />
  5010→                <p className="text-xs text-slate-400 mt-1.5">Enter codes separated by commas</p>
  5011→              </div>
  5012→            )}
  5013→
  5014→            <div className="form-control col-span-2">
  5015→              <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Description *</label>
  5016→              <textarea
  5017→                className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none resize-none"
  5018→                value={issueForm.description}
  5019→                onChange={(e) => setIssueForm({ ...issueForm, description: e.target.value })}
  5020→                placeholder={issueForm.category === "fault_codes" ? "Describe what the fault codes indicate..." : "Describe the issue..."}
  5021→                required
  5022→                rows="3"
  5023→              ></textarea>
  5024→            </div>
  5025→
  5026→            <div className="form-control col-span-2">
  5027→              <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Action Needed</label>
  5028→              <input
  5029→                type="text"
  5030→                className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none"
  5031→                value={issueForm.actionNeeded}
  5032→                onChange={(e) => setIssueForm({ ...issueForm, actionNeeded: e.target.value })}
  5033→                placeholder="What needs to be done?"
  5034→              />
  5035→            </div>
  5036→
  5037→            <div className="form-control">
  5038→              <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Status</label>
  5039→              <select
  5040→                className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none appearance-none cursor-pointer"
  5041→                value={issueForm.status}
  5042→                onChange={(e) => setIssueForm({ ...issueForm, status: e.target.value })}
  5043→              >
  5044→                <option value="outstanding">Outstanding</option>
  5045→                <option value="ordered">Ordered</option>
  5046→                <option value="in_progress">In Progress</option>
  5047→                <option value="resolved">Resolved</option>
  5048→              </select>
  5049→            </div>
  5050→
  5051→            {/* Parts Required Section */}
  5052→            <div className="form-control flex items-center">
  5053→              <label className="flex items-center gap-3 cursor-pointer mt-6">
  5054→                <div className="relative">
  5055→                  <input
  5056→                    type="checkbox"
  5057→                    className="sr-only peer"
  5058→                    checked={issueForm.partsRequired || false}
  5059→                    onChange={(e) => setIssueForm({ ...issueForm, partsRequired: e.target.checked })}
  5060→                  />
  5061→                  <div className="w-5 h-5 rounded border-2 border-slate-300 peer-checked:border-violet-500 peer-checked:bg-violet-500 transition-all duration-200 flex items-center justify-center">
  5062→                    <svg className="w-3 h-3 text-white opacity-0 peer-checked:opacity-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  5063→                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" />
  5064→                    </svg>
  5065→                  </div>
  5066→                </div>
  5067→                <span className="text-sm font-medium text-slate-700">Parts Required</span>
  5068→              </label>
  5069→            </div>
  5070→
  5071→            {issueForm.partsRequired && (
  5072→              <div className="form-control col-span-2">
  5073→                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Parts Details</label>
  5074→                <textarea
  5075→                  className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none resize-none"
  5076→                  value={issueForm.partsDetails || ""}
  5077→                  onChange={(e) => setIssueForm({ ...issueForm, partsDetails: e.target.value })}
  5078→                  placeholder="Supplier, part numbers, who ordered, ETA..."
  5079→                  rows="2"
  5080→                ></textarea>
  5081→              </div>
  5082→            )}
  5083→
  5084→            <div className="form-control col-span-2">
  5085→              <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Notes</label>
  5086→              <textarea
  5087→                className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none resize-none"
  5088→                value={issueForm.notes}
  5089→                onChange={(e) => setIssueForm({ ...issueForm, notes: e.target.value })}
  5090→                placeholder="Additional notes..."
  5091→                rows="2"
  5092→              ></textarea>
  5093→            </div>
  5094→
  5095→            {/* Photo Upload */}
  5096→            <div className="form-control col-span-2">
  5097→              <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Photos</label>
  5098→              <input
  5099→                type="file"
  5100→                accept="image/*"
  5101→                multiple
  5102→                onChange={handlePhotoChange}
  5103→                className="w-full px-4 py-3 bg-slate-50 border border-transparent rounded-lg text-slate-900 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-violet-50 file:text-violet-700 file:font-medium hover:file:bg-violet-100 focus:ring-2 focus:ring-violet-500 focus:shadow-sm transition-all duration-200 outline-none"
  5104→              />
  5105→              {photoPreviews.length > 0 && (
  5106→                <div className="flex flex-wrap gap-2 mt-3">
  5107→                  {photoPreviews.map((preview, idx) => (
  5108→                    <div key={idx} className="relative">
  5109→                      <img src={preview} alt={`Preview ${idx + 1}`} className="w-20 h-20 object-cover rounded-lg" />
  5110→                      <button
  5111→                        type="button"
  5112→                        onClick={() => removePhoto(idx)}
  5113→                        className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 hover:bg-red-600 text-white rounded-full text-xs flex items-center justify-center transition-colors"
  5114→                      >
  5115→                        ✕
  5116→                      </button>

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
