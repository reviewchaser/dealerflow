     1â†’     1â†’import { useEffect, useState } from "react";
     2â†’     2â†’import Head from "next/head";
     3â†’     3â†’import Link from "next/link";
     4â†’     4â†’import { useRouter } from "next/router";
     5â†’     5â†’import DashboardLayout from "@/components/DashboardLayout";
     6â†’     6â†’import StatsCard from "@/components/StatsCard";
     7â†’     7â†’
     8â†’     8â†’// Human-readable form type labels
     9â†’     9â†’const FORM_TYPE_LABELS = {
    10â†’    10â†’  PDI: "PDI",
    11â†’    11â†’  TEST_DRIVE: "Test Drive",
    12â†’    12â†’  WARRANTY_CLAIM: "Warranty Claim",
    13â†’    13â†’  COURTESY_OUT: "Courtesy Out",
    14â†’    14â†’  COURTESY_IN: "Courtesy In",
    15â†’    15â†’  SERVICE_RECEIPT: "Service",
    16â†’    16â†’  REVIEW_FEEDBACK: "Feedback",
    17â†’    17â†’  OTHER: "Other",
    18â†’    18â†’};
    19â†’    19â†’
    20â†’    20â†’// Default priority forms - PDI is always first as it's the most common daily task
    21â†’    21â†’// These are shown when there's no usage data, or PDI is forced to always be first
    22â†’    22â†’const DEFAULT_PRIORITY_FORM_TYPES = ["PDI", "TEST_DRIVE", "DELIVERY"];
    23â†’    23â†’const ALWAYS_FIRST_FORM_TYPE = "PDI"; // PDI always shows as the first quick form
    24â†’    24â†’
    25â†’    25â†’// Needs Attention item configurations
    26â†’    26â†’const NEEDS_ATTENTION_ITEMS = [
    27â†’    27â†’  {
    28â†’    28â†’    key: "soldInProgress",
    29â†’    29â†’    label: "Sold in progress",
    30â†’    30â†’    href: "/sales-prep",
    31â†’    31â†’    color: "bg-amber-500",
    32â†’    32â†’    description: "vehicles awaiting delivery"
    33â†’    33â†’  },
    34â†’    34â†’  {
    35â†’    35â†’    key: "warrantyNotBookedIn",
    36â†’    36â†’    label: "Warranty not booked in",
    37â†’    37â†’    href: "/warranty",
    38â†’    38â†’    color: "bg-red-500",
    39â†’    39â†’    description: "cases need scheduling"
    40â†’    40â†’  },
    41â†’    41â†’  {
    42â†’    42â†’    key: "eventsToday",
    43â†’    43â†’    label: "Events today",
    44â†’    44â†’    href: "/calendar",
    45â†’    45â†’    color: "bg-blue-500",
    46â†’    46â†’    description: "on your calendar"
    47â†’    47â†’  },
    48â†’    48â†’  {
    49â†’    49â†’    key: "courtesyDueBack",
    50â†’    50â†’    label: "Courtesy due back",
    51â†’    51â†’    href: "/warranty",
    52â†’    52â†’    color: "bg-amber-500",
    53â†’    53â†’    description: "vehicles due today or overdue"
    54â†’    54â†’  },
    55â†’    55â†’  {
    56â†’    56â†’    key: "motExpiringSoon",
    57â†’    57â†’    label: "MOT expiring soon",
    58â†’    58â†’    href: "/sales-prep",
    59â†’    59â†’    color: "bg-red-500",
    60â†’    60â†’    description: "within 14 days"
    61â†’    61â†’  }
    62â†’    62â†’];
    63â†’    63â†’
    64â†’    64â†’export default function Dashboard() {
    65â†’    65â†’  const router = useRouter();
    66â†’    66â†’  const [stats, setStats] = useState(null);
    67â†’    67â†’  const [forms, setForms] = useState([]);
    68â†’    68â†’  const [isLoading, setIsLoading] = useState(true);
    69â†’    69â†’
    70â†’    70â†’  // Default empty stats object to prevent crashes
    71â†’    71â†’  const defaultStats = {
    72â†’    72â†’    appraisals: { total: 0, pending: 0 },
    73â†’    73â†’    vehicles: { total: 0, inStock: 0, inPrep: 0, live: 0, delivered: 0 },
    74â†’    74â†’    aftercare: { total: 0, open: 0 },
    75â†’    75â†’    reviews: { count: 0, avgRating: "N/A", lastReviewDays: null },
    76â†’    76â†’    forms: { total: 0, submissions: 0 },
    77â†’    77â†’    recent: { appraisals: [], vehicles: [], formSubmissions: [] },
    78â†’    78â†’    needsAttention: { soldInProgress: 0, warrantyNotBookedIn: 0, eventsToday: 0, courtesyDueBack: 0, motExpiringSoon: 0 },
    79â†’    79â†’    today: { events: 0, deliveries: 0, testDrives: 0, courtesyDueBack: 0 },
    80â†’    80â†’    topForms: [],
    81â†’    81â†’    oldestAppraisalDays: null,
    82â†’    82â†’  };
    83â†’    83â†’
    84â†’    84â†’  useEffect(() => {
    85â†’    85â†’    // Helper to safely parse JSON responses
    86â†’    86â†’    const safeJsonParse = async (res) => {
    87â†’    87â†’      const contentType = res.headers.get("content-type") || "";
    88â†’    88â†’      if (!contentType.includes("application/json")) {
    89â†’    89â†’        console.error("[Dashboard] Non-JSON response:", res.status, contentType);
    90â†’    90â†’        return null;
    91â†’    91â†’      }
    92â†’    92â†’      return res.json();
    93â†’    93â†’    };
    94â†’    94â†’
    95â†’    95â†’    // Single API call - stats now includes forms list
    96â†’    96â†’    fetch("/api/dashboard/stats")
    97â†’    97â†’      .then(async (res) => {
    98â†’    98â†’        if (res.status === 403) return { error: "No dealer context" };
    99â†’    99â†’        if (!res.ok) return { error: "Failed to fetch stats" };
   100â†’   100â†’        return await safeJsonParse(res) || { error: "Invalid response" };
   101â†’   101â†’      })
   102â†’   102â†’      .then((statsData) => {
   103â†’   103â†’        if (statsData?.error) {
   104â†’   104â†’          console.error("Dashboard stats error:", statsData.error);
   105â†’   105â†’          setStats(defaultStats);
   106â†’   106â†’          setForms([]);
   107â†’   107â†’        } else {
   108â†’   108â†’          setStats(statsData || defaultStats);
   109â†’   109â†’          // Forms are now included in stats response
   110â†’   110â†’          setForms(Array.isArray(statsData?.formsList) ? statsData.formsList : []);
   111â†’   111â†’        }
   112â†’   112â†’        setIsLoading(false);
   113â†’   113â†’      })
   114â†’   114â†’      .catch((err) => {
   115â†’   115â†’        console.error("Dashboard fetch error:", err);
   116â†’   116â†’        setStats(defaultStats);
   117â†’   117â†’        setForms([]);
   118â†’   118â†’        setIsLoading(false);
   119â†’   119â†’      });
   120â†’   120â†’  }, []);
   121â†’   121â†’
   122â†’   122â†’  const handleFormClick = (form) => {
   123â†’   123â†’    if (form.isPublic && form.publicSlug) {
   124â†’   124â†’      window.open(`/public/forms/${form.publicSlug}`, '_blank');
   125â†’   125â†’    } else {
   126â†’   126â†’      router.push(`/forms/fill/${form.id || form._id}`);
   127â†’   127â†’    }
   128â†’   128â†’  };
   129â†’   129â†’
   130â†’   130â†’  // Get top forms - PDI is always first, then by usage stats or defaults
   131â†’   131â†’  const getTopForms = () => {
   132â†’   132â†’    // Find PDI form - it should always be first
   133â†’   133â†’    const pdiForm = forms.find(f => f.type === ALWAYS_FIRST_FORM_TYPE);
   134â†’   134â†’
   135â†’   135â†’    let otherTopForms = [];
   136â†’   136â†’    if (stats?.topForms?.length > 0) {
   137â†’   137â†’      // Map topForms to actual form objects - ensure both sides are strings for comparison
   138â†’   138â†’      // Exclude PDI since we're adding it first
   139â†’   139â†’      otherTopForms = stats.topForms
   140â†’   140â†’        .map(tf => forms.find(f => (f.id || f._id?.toString?.() || f._id) === (tf.formId?.toString?.() || tf.formId)))
   141â†’   141â†’        .filter(f => f && f.type !== ALWAYS_FIRST_FORM_TYPE)
   142â†’   142â†’        .slice(0, 2);
   143â†’   143â†’    } else {
   144â†’   144â†’      // Fallback to default priority forms (excluding PDI)
   145â†’   145â†’      otherTopForms = forms.filter(f => DEFAULT_PRIORITY_FORM_TYPES.includes(f.type) && f.type !== ALWAYS_FIRST_FORM_TYPE).slice(0, 2);
   146â†’   146â†’    }
   147â†’   147â†’
   148â†’   148â†’    // PDI first, then other top forms
   149â†’   149â†’    return pdiForm ? [pdiForm, ...otherTopForms] : otherTopForms;
   150â†’   150â†’  };
   151â†’   151â†’
   152â†’   152â†’  const topForms = getTopForms();
   153â†’   153â†’  const otherForms = forms.filter(f => !topForms.find(tf => (tf.id || tf._id?.toString?.() || tf._id) === (f.id || f._id?.toString?.() || f._id)));
   154â†’   154â†’
   155â†’   155â†’  // Get active needs attention items (only those with count > 0)
   156â†’   156â†’  const activeNeedsAttention = NEEDS_ATTENTION_ITEMS.filter(item =>
   157â†’   157â†’    stats?.needsAttention?.[item.key] > 0
   158â†’   158â†’  );
   159â†’   159â†’
   160â†’   160â†’  // Check if today strip has any data to show
   161â†’   161â†’  const hasTodayData = stats?.today && (
   162â†’   162â†’    stats.today.events > 0 ||
   163â†’   163â†’    stats.today.deliveries > 0 ||
   164â†’   164â†’    stats.today.testDrives > 0 ||
   165â†’   165â†’    stats.today.courtesyDueBack > 0
   166â†’   166â†’  );
   167â†’   167â†’
   168â†’   168â†’  return (
   169â†’   169â†’    <DashboardLayout>
   170â†’   170â†’      <Head><title>Dashboard | DealerFlow</title></Head>
   171â†’   171â†’
   172â†’   172â†’      {/* Header - Compact */}
   173â†’   173â†’      <div className="mb-4">
   174â†’   174â†’        <h1 className="text-2xl font-bold text-slate-900">Dashboard</h1>
   175â†’   175â†’        <p className="text-slate-500 text-sm mt-1">Here's what needs attention today</p>
   176â†’   176â†’      </div>
   177â†’   177â†’
   178â†’   178â†’      {isLoading ? (
   179â†’   179â†’        <div className="flex justify-center py-20">
   180â†’   180â†’          <span className="loading loading-spinner loading-lg"></span>
   181â†’   181â†’        </div>
   182â†’   182â†’      ) : (
   183â†’   183â†’        <div className="space-y-4">
   184â†’   184â†’          {/* Today Strip - Only show if there's data */}
   185â†’   185â†’          {hasTodayData && (
   186â†’   186â†’            <div className="bg-gradient-to-r from-slate-50 to-blue-50 rounded-2xl px-4 py-3 flex items-center gap-3 flex-wrap shadow-sm">
   187â†’   187â†’              <span className="text-sm font-semibold text-slate-700">Today</span>
   188â†’   188â†’              <div className="h-4 w-px bg-slate-300" />
   189â†’   189â†’              <div className="flex items-center gap-3 flex-wrap">
   190â†’   190â†’                {(stats?.today?.events ?? 0) > 0 && (
   191â†’   191â†’                  <Link href="/calendar" className="inline-flex items-center gap-1.5 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium hover:bg-blue-200 transition-colors">
   192â†’   192â†’                    <span className="w-2 h-2 rounded-full bg-blue-500" />
   193â†’   193â†’                    {stats.today.events} event{stats.today.events !== 1 ? "s" : ""}
   194â†’   194â†’                  </Link>
   195â†’   195â†’                )}
   196â†’   196â†’                {(stats?.today?.deliveries ?? 0) > 0 && (
   197â†’   197â†’                  <Link href="/calendar" className="inline-flex items-center gap-1.5 px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium hover:bg-emerald-200 transition-colors">
   198â†’   198â†’                    <span className="w-2 h-2 rounded-full bg-emerald-500" />
   199â†’   199â†’                    {stats.today.deliveries} deliver{stats.today.deliveries !== 1 ? "ies" : "y"}
   200â†’   200â†’                  </Link>
   201â†’   201â†’                )}
   202â†’   202â†’                {(stats?.today?.testDrives ?? 0) > 0 && (
   203â†’   203â†’                  <Link href="/calendar" className="inline-flex items-center gap-1.5 px-3 py-1 bg-cyan-100 text-cyan-700 rounded-full text-sm font-medium hover:bg-cyan-200 transition-colors">
   204â†’   204â†’                    <span className="w-2 h-2 rounded-full bg-cyan-500" />
   205â†’   205â†’                    {stats.today.testDrives} test drive{stats.today.testDrives !== 1 ? "s" : ""}
   206â†’   206â†’                  </Link>
   207â†’   207â†’                )}
   208â†’   208â†’                {(stats?.today?.courtesyDueBack ?? 0) > 0 && (
   209â†’   209â†’                  <Link href="/warranty" className="inline-flex items-center gap-1.5 px-3 py-1 bg-amber-100 text-amber-700 rounded-full text-sm font-medium hover:bg-amber-200 transition-colors">
   210â†’   210â†’                    <span className="w-2 h-2 rounded-full bg-amber-500" />
   211â†’   211â†’                    {stats.today.courtesyDueBack} courtesy due
   212â†’   212â†’                  </Link>
   213â†’   213â†’                )}
   214â†’   214â†’              </div>
   215â†’   215â†’            </div>
   216â†’   216â†’          )}
   217â†’   217â†’
   218â†’   218â†’          {/* Top Row - KPI Cards with micro-context */}
   219â†’   219â†’          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
   220â†’   220â†’            <StatsCard
   221â†’   221â†’              title="Pending Appraisals"
   222â†’   222â†’              value={stats?.appraisals?.pending ?? 0}
   223â†’   223â†’              trend={typeof stats?.oldestAppraisalDays === "number" ? `Oldest: ${stats.oldestAppraisalDays}d` : null}
   224â†’   224â†’              icon="ðŸ“‹"
   225â†’   225â†’              color="primary"
   226â†’   226â†’            />
   227â†’   227â†’            <StatsCard
   228â†’   228â†’              title="Total Stock"
   229â†’   229â†’              value={(stats?.vehicles?.inStock ?? 0) + (stats?.vehicles?.inPrep ?? 0)}
   230â†’   230â†’              trend={stats?.vehicles?.inPrep > 0 ? `${stats.vehicles.inPrep} in prep` : null}
   231â†’   231â†’              icon="ðŸš—"
   232â†’   232â†’              color="secondary"
   233â†’   233â†’            />
   234â†’   234â†’            <StatsCard
   235â†’   235â†’              title="Advertised"
   236â†’   236â†’              value={stats?.vehicles?.inPrep ?? 0}
   237â†’   237â†’              trend={stats?.vehicles?.live > 0 ? `${stats.vehicles.live} sold in progress` : null}
   238â†’   238â†’              icon="ðŸ“¢"
   239â†’   239â†’              color="accent"
   240â†’   240â†’            />
   241â†’   241â†’            <StatsCard
   242â†’   242â†’              title="Avg Rating"
   243â†’   243â†’              value={stats?.reviews?.avgRating ?? "N/A"}
   244â†’   244â†’              trend={
   245â†’   245â†’                typeof stats?.reviews?.lastReviewDays === "number"
   246â†’   246â†’                  ? `Last review: ${stats.reviews.lastReviewDays}d ago`
   247â†’   247â†’                  : stats?.reviews?.count === 0
   248â†’   248â†’                  ? "No reviews yet"
   249â†’   249â†’                  : null
   250â†’   250â†’              }
   251â†’   251â†’              icon="â­"
   252â†’   252â†’              color="warning"
   253â†’   253â†’            />
   254â†’   254â†’          </div>
   255â†’   255â†’
   256â†’   256â†’          {/* Quick Forms - Touch Cards Grid */}
   257â†’   257â†’          {forms.length > 0 && (
   258â†’   258â†’            <div>
   259â†’   259â†’              <div className="flex items-center justify-between mb-3">
   260â†’   260â†’                <div className="flex items-center gap-2">
   261â†’   261â†’                  <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
   262â†’   262â†’                  <span className="text-sm font-bold text-slate-700 uppercase tracking-wide">Quick Forms</span>
   263â†’   263â†’                </div>
   264â†’   264â†’                <Link href="/forms" className="text-sm text-blue-600 hover:text-blue-700 font-semibold transition-colors">All Submissions â†’</Link>
   265â†’   265â†’              </div>
   266â†’   266â†’              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
   267â†’   267â†’                {/* Top form buttons - Touch Cards */}
   268â†’   268â†’                {topForms.map((form) => (
   269â†’   269â†’                  <button
   270â†’   270â†’                    key={form.id || form._id}
   271â†’   271â†’                    onClick={() => handleFormClick(form)}
   272â†’   272â†’                    className="bg-white border border-slate-200 shadow-sm p-4 rounded-xl flex items-center gap-3 hover:border-blue-500 hover:shadow-md hover:scale-[1.02] transition-all cursor-pointer text-left"
   273â†’   273â†’                  >
   274â†’   274â†’                    <div className="bg-blue-50 text-blue-600 p-2 rounded-lg shrink-0">
   275â†’   275â†’                      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   276â†’   276â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
   277â†’   277â†’                      </svg>
   278â†’   278â†’                    </div>
   279â†’   279â†’                    <span className="font-semibold text-slate-700 truncate">
   280â†’   280â†’                      {FORM_TYPE_LABELS[form.type] || form.name}
   281â†’   281â†’                    </span>
   282â†’   282â†’                  </button>
   283â†’   283â†’                ))}
   284â†’   284â†’                {/* More Forms Card */}
   285â†’   285â†’                {otherForms.length > 0 && (
   286â†’   286â†’                  <div className="dropdown dropdown-end">
   287â†’   287â†’                    <label
   288â†’   288â†’                      tabIndex={0}
   289â†’   289â†’                      className="bg-white border border-slate-200 shadow-sm p-4 rounded-xl flex items-center gap-3 hover:border-slate-400 hover:shadow-md hover:scale-[1.02] transition-all cursor-pointer w-full"
   290â†’   290â†’                    >
   291â†’   291â†’                      <div className="bg-slate-100 text-slate-500 p-2 rounded-lg shrink-0">
   292â†’   292â†’                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   293â†’   293â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" />
   294â†’   294â†’                        </svg>
   295â†’   295â†’                      </div>
   296â†’   296â†’                      <span className="font-semibold text-slate-500">More ({otherForms.length})</span>
   297â†’   297â†’                    </label>
   298â†’   298â†’                    <div tabIndex={0} className="dropdown-content z-20 shadow-xl bg-white rounded-xl w-64 border border-slate-200 mt-2 overflow-hidden">
   299â†’   299â†’                      {/* Header */}
   300â†’   300â†’                      <div className="px-3 py-2.5 border-b border-slate-100 bg-slate-50">
   301â†’   301â†’                        <p className="text-xs font-semibold text-slate-500 uppercase tracking-wide">All Forms</p>
   302â†’   302â†’                      </div>
   303â†’   303â†’                      {/* Scrollable list */}
   304â†’   304â†’                      <div className="max-h-64 overflow-y-auto overscroll-contain">
   305â†’   305â†’                        {otherForms.map((form) => (
   306â†’   306â†’                          <button
   307â†’   307â†’                            key={form.id || form._id}
   308â†’   308â†’                            onClick={() => handleFormClick(form)}
   309â†’   309â†’                            className="w-full flex items-center gap-3 px-3 py-2.5 text-sm font-medium text-slate-700 hover:bg-blue-50 hover:text-blue-700 transition-colors border-b border-slate-50 last:border-0"
   310â†’   310â†’                          >
   311â†’   311â†’                            <div className="w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center flex-shrink-0">
   312â†’   312â†’                              <svg className="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   313â†’   313â†’                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
   314â†’   314â†’                              </svg>
   315â†’   315â†’                            </div>
   316â†’   316â†’                            <span className="truncate">{FORM_TYPE_LABELS[form.type] || form.name}</span>
   317â†’   317â†’                          </button>
   318â†’   318â†’                        ))}
   319â†’   319â†’                      </div>
   320â†’   320â†’                    </div>
   321â†’   321â†’                  </div>
   322â†’   322â†’                )}
   323â†’   323â†’              </div>
   324â†’   324â†’            </div>
   325â†’   325â†’          )}
   326â†’   326â†’
   327â†’   327â†’          {/* Middle Row - Needs Attention + Dealer Actions */}
   328â†’   328â†’          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4">
   329â†’   329â†’            {/* Needs Attention - 2/3 width - Task Style */}
   330â†’   330â†’            <div className="lg:col-span-2 bg-white border border-red-100 rounded-2xl p-1 shadow-sm">
   331â†’   331â†’              <div className="flex items-center gap-2 px-4 py-3 border-b border-slate-100">
   332â†’   332â†’                <svg className="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   333â†’   333â†’                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
   334â†’   334â†’                </svg>
   335â†’   335â†’                <h3 className="text-base font-bold text-slate-800">Needs Attention</h3>
   336â†’   336â†’              </div>
   337â†’   337â†’              {activeNeedsAttention.length > 0 ? (
   338â†’   338â†’                <div className="p-2">
   339â†’   339â†’                  {activeNeedsAttention.map((item) => (
   340â†’   340â†’                    <Link
   341â†’   341â†’                      key={item.key}
   342â†’   342â†’                      href={item.href}
   343â†’   343â†’                      className="flex items-center gap-4 p-3 hover:bg-red-50/50 rounded-lg cursor-pointer transition-colors"
   344â†’   344â†’                    >
   345â†’   345â†’                      {/* Soft Circle Counter */}
   346â†’   346â†’                      <div className="bg-red-100 text-red-600 font-bold w-8 h-8 rounded-full flex items-center justify-center text-sm flex-shrink-0">
   347â†’   347â†’                        {stats?.needsAttention?.[item.key] ?? 0}
   348â†’   348â†’                      </div>
   349â†’   349â†’                      <div className="flex-1 min-w-0">
   350â†’   350â†’                        <p className="text-sm font-semibold text-slate-800">{item.label}</p>
   351â†’   351â†’                        <p className="text-xs text-slate-500">{item.description}</p>
   352â†’   352â†’                      </div>
   353â†’   353â†’                      <svg className="w-5 h-5 text-slate-300 group-hover:text-red-500 transition-colors flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   354â†’   354â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
   355â†’   355â†’                      </svg>
   356â†’   356â†’                    </Link>
   357â†’   357â†’                  ))}
   358â†’   358â†’                </div>
   359â†’   359â†’              ) : (
   360â†’   360â†’                <div className="flex items-center justify-center py-8 m-2 bg-emerald-50 rounded-xl">
   361â†’   361â†’                  <div className="text-center">
   362â†’   362â†’                    <div className="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-2">
   363â†’   363â†’                      <svg className="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   364â†’   364â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
   365â†’   365â†’                      </svg>
   366â†’   366â†’                    </div>
   367â†’   367â†’                    <p className="text-emerald-700 font-semibold text-sm">All clear!</p>
   368â†’   368â†’                    <p className="text-xs text-emerald-600/70 mt-0.5">Nothing needs attention right now</p>
   369â†’   369â†’                  </div>
   370â†’   370â†’                </div>
   371â†’   371â†’              )}
   372â†’   372â†’            </div>
   373â†’   373â†’
   374â†’   374â†’            {/* Dealer Actions - 1/3 width - Command Cards */}
   375â†’   375â†’            <div className="bg-slate-50/50 rounded-2xl p-4">
   376â†’   376â†’              <div className="flex items-center gap-2 mb-4">
   377â†’   377â†’                <svg className="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   378â†’   378â†’                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
   379â†’   379â†’                </svg>
   380â†’   380â†’                <h3 className="text-base font-bold text-slate-800">Quick Actions</h3>
   381â†’   381â†’              </div>
   382â†’   382â†’              <div className="space-y-3">
   383â†’   383â†’                {/* Add Vehicle Card */}
   384â†’   384â†’                <Link href="/sales-prep" className="group flex items-center gap-3 p-4 bg-white border border-slate-200 rounded-2xl shadow-sm hover:shadow-md hover:border-blue-500 hover:scale-[1.02] transition-all">
   385â†’   385â†’                  <div className="bg-blue-50 text-blue-600 p-2 rounded-lg">
   386â†’   386â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   387â†’   387â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
   388â†’   388â†’                    </svg>
   389â†’   389â†’                  </div>
   390â†’   390â†’                  <span className="font-semibold text-slate-700">Add Vehicle</span>
   391â†’   391â†’                </Link>
   392â†’   392â†’
   393â†’   393â†’                {/* New Appraisal Card */}
   394â†’   394â†’                <Link href="/appraisals/new" className="group flex items-center gap-3 p-4 bg-white border border-slate-200 rounded-2xl shadow-sm hover:shadow-md hover:border-blue-500 hover:scale-[1.02] transition-all">
   395â†’   395â†’                  <div className="bg-blue-50 text-blue-600 p-2 rounded-lg">
   396â†’   396â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   397â†’   397â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
   398â†’   398â†’                    </svg>
   399â†’   399â†’                  </div>
   400â†’   400â†’                  <span className="font-semibold text-slate-700">New Appraisal</span>
   401â†’   401â†’                </Link>
   402â†’   402â†’
   403â†’   403â†’                {/* View Submissions Card */}
   404â†’   404â†’                <Link href="/forms" className="group flex items-center gap-3 p-4 bg-white border border-slate-200 rounded-2xl shadow-sm hover:shadow-md hover:border-blue-500 hover:scale-[1.02] transition-all">
   405â†’   405â†’                  <div className="bg-blue-50 text-blue-600 p-2 rounded-lg">
   406â†’   406â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   407â†’   407â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
   408â†’   408â†’                    </svg>
   409â†’   409â†’                  </div>
   410â†’   410â†’                  <span className="font-semibold text-slate-700">View Submissions</span>
   411â†’   411â†’                </Link>
   412â†’   412â†’
   413â†’   413â†’                {/* Invite Team Card - Distinct Purple Style */}
   414â†’   414â†’                <Link href="/settings/team" className="group flex items-center gap-3 p-4 bg-gradient-to-r from-violet-50 to-purple-50 border-2 border-violet-200 rounded-2xl shadow-sm hover:shadow-md hover:border-violet-400 hover:scale-[1.02] transition-all">
   415â†’   415â†’                  <div className="bg-gradient-to-br from-violet-500 to-purple-600 text-white p-2 rounded-lg shadow">
   416â†’   416â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   417â†’   417â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
   418â†’   418â†’                    </svg>
   419â†’   419â†’                  </div>
   420â†’   420â†’                  <div>
   421â†’   421â†’                    <span className="font-semibold text-violet-700 block">Invite Team</span>
   422â†’   422â†’                    <span className="text-xs text-violet-500">Add staff members</span>
   423â†’   423â†’                  </div>
   424â†’   424â†’                </Link>
   425â†’   425â†’              </div>
   426â†’   426â†’            </div>
   427â†’   427â†’          </div>
   428â†’   428â†’
   429â†’   429â†’          {/* Bottom Row - Recent Lists */}
   430â†’   430â†’          <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
   431â†’   431â†’            {/* Recent Appraisals */}
   432â†’   432â†’            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
   433â†’   433â†’              <div className="flex justify-between items-center mb-6">
   434â†’   434â†’                <h3 className="text-lg font-bold text-slate-900">Recent Appraisals</h3>
   435â†’   435â†’                <Link href="/appraisals" className="text-xs font-bold text-blue-600 uppercase tracking-wide hover:underline">View All</Link>
   436â†’   436â†’              </div>
   437â†’   437â†’
   438â†’   438â†’              {stats?.recent?.appraisals?.length > 0 ? (
   439â†’   439â†’                <div className="overflow-y-auto max-h-[240px] scrollbar-thin scrollbar-thumb-slate-200 scrollbar-track-transparent">
   440â†’   440â†’                  {/* Column Headers */}
   441â†’   441â†’                  <div className="grid grid-cols-12 gap-2 text-[10px] font-bold text-slate-400 uppercase tracking-wider pb-2 border-b border-slate-100 mb-2">
   442â†’   442â†’                    <div className="col-span-4">Vehicle</div>
   443â†’   443â†’                    <div className="col-span-4">Contact</div>
   444â†’   444â†’                    <div className="col-span-4 text-right">Status</div>
   445â†’   445â†’                  </div>
   446â†’   446â†’                  {/* Data Rows */}
   447â†’   447â†’                  <div className="space-y-1">
   448â†’   448â†’                    {stats.recent.appraisals.map((a) => (
   449â†’   449â†’                      <div
   450â†’   450â†’                        key={a.id}
   451â†’   451â†’                        onClick={() => router.push(`/appraisals/${a.id}`)}
   452â†’   452â†’                        className="grid grid-cols-12 gap-2 items-center py-4 hover:bg-slate-50 transition-colors cursor-pointer rounded-lg -mx-2 px-2"
   453â†’   453â†’                      >
   454â†’   454â†’                        <div className="col-span-4">
   455â†’   455â†’                          <span className="font-mono text-xs bg-[#fcd34d] border border-yellow-500/50 rounded px-1.5 py-0.5 text-slate-900 font-bold">{a.vehicleReg}</span>
   456â†’   456â†’                        </div>
   457â†’   457â†’                        <div className="col-span-4">
   458â†’   458â†’                          <p className="text-sm text-slate-600 truncate">{a.contactId?.name || "â€”"}</p>
   459â†’   459â†’                        </div>
   460â†’   460â†’                        <div className="col-span-4 text-right">
   461â†’   461â†’                          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold border ${
   462â†’   462â†’                            a.decision === "purchased" || a.decision === "converted"
   463â†’   463â†’                              ? "bg-emerald-50 text-emerald-700 border-emerald-200"
   464â†’   464â†’                              : a.decision === "not_purchased" || a.decision === "declined"
   465â†’   465â†’                              ? "bg-red-50 text-red-700 border-red-200"
   466â†’   466â†’                              : "bg-amber-50 text-amber-700 border-amber-200"
   467â†’   467â†’                          }`}>
   468â†’   468â†’                            {a.decision}
   469â†’   469â†’                          </span>
   470â†’   470â†’                        </div>
   471â†’   471â†’                      </div>
   472â†’   472â†’                    ))}
   473â†’   473â†’                  </div>
   474â†’   474â†’                </div>
   475â†’   475â†’              ) : (
   476â†’   476â†’                <div className="flex items-center justify-center py-10 bg-slate-50 rounded-xl">
   477â†’   477â†’                  <p className="text-slate-400 text-sm">No appraisals yet</p>
   478â†’   478â†’                </div>
   479â†’   479â†’              )}
   480â†’   480â†’            </div>
   481â†’   481â†’
   482â†’   482â†’            {/* Pending Prep */}
   483â†’   483â†’            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
   484â†’   484â†’              <div className="flex justify-between items-center mb-6">
   485â†’   485â†’                <h3 className="text-lg font-bold text-slate-900">Pending Prep</h3>
   486â†’   486â†’                <Link href="/sales-prep" className="text-xs font-bold text-blue-600 uppercase tracking-wide hover:underline">View All</Link>
   487â†’   487â†’              </div>
   488â†’   488â†’
   489â†’   489â†’              {stats?.recent?.vehicles?.length > 0 ? (
   490â†’   490â†’                <div className="overflow-y-auto max-h-[240px] scrollbar-thin scrollbar-thumb-slate-200 scrollbar-track-transparent">
   491â†’   491â†’                  {/* Column Headers */}
   492â†’   492â†’                  <div className="grid grid-cols-12 gap-2 text-[10px] font-bold text-slate-400 uppercase tracking-wider pb-2 border-b border-slate-100 mb-2">
   493â†’   493â†’                    <div className="col-span-4">Vehicle</div>
   494â†’   494â†’                    <div className="col-span-4">Reg</div>
   495â†’   495â†’                    <div className="col-span-4 text-right">Status</div>
   496â†’   496â†’                  </div>
   497â†’   497â†’                  {/* Data Rows */}
   498â†’   498â†’                  <div className="space-y-1">
   499â†’   499â†’                    {stats.recent.vehicles.map((v) => (
   500â†’   500â†’                      <div
   501â†’   501â†’                        key={v.id}
   502â†’   502â†’                        onClick={() => router.push("/sales-prep")}
   503â†’   503â†’                        className="grid grid-cols-12 gap-2 items-center py-4 hover:bg-slate-50 transition-colors cursor-pointer rounded-lg -mx-2 px-2"
   504â†’   504â†’                      >
   505â†’   505â†’                        <div className="col-span-4">
   506â†’   506â†’                          <p className="font-bold text-slate-700 text-sm truncate">{v.make} {v.model}</p>
   507â†’   507â†’                        </div>
   508â†’   508â†’                        <div className="col-span-4">
   509â†’   509â†’                          <span className="font-mono text-xs bg-[#fcd34d] border border-yellow-500/50 rounded px-1.5 py-0.5 text-slate-900 font-bold">{v.regCurrent}</span>
   510â†’   510â†’                        </div>
   511â†’   511â†’                        <div className="col-span-4 text-right">
   512â†’   512â†’                          <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-semibold border ${
   513â†’   513â†’                            v.status === "delivered"
   514â†’   514â†’                              ? "bg-slate-100 text-slate-600 border-slate-200"
   515â†’   515â†’                              : v.status === "live"
   516â†’   516â†’                              ? "bg-emerald-50 text-emerald-700 border-emerald-200"
   517â†’   517â†’                              : v.status === "in_prep"
   518â†’   518â†’                              ? "bg-amber-50 text-amber-700 border-amber-200"
   519â†’   519â†’                              : v.status === "in_stock"
   520â†’   520â†’                              ? "bg-blue-50 text-blue-700 border-blue-200"
   521â†’   521â†’                              : "bg-amber-50 text-amber-700 border-amber-200"
   522â†’   522â†’                          }`}>
   523â†’   523â†’                            {v.status.replace("_", " ")}
   524â†’   524â†’                          </span>
   525â†’   525â†’                        </div>
   526â†’   526â†’                      </div>
   527â†’   527â†’                    ))}
   528â†’   528â†’                  </div>
   529â†’   529â†’                </div>
   530â†’   530â†’              ) : (
   531â†’   531â†’                <div className="flex items-center justify-center py-10 bg-slate-50 rounded-xl">
   532â†’   532â†’                  <p className="text-slate-400 text-sm">No vehicles yet</p>
   533â†’   533â†’                </div>
   534â†’   534â†’              )}
   535â†’   535â†’            </div>
   536â†’   536â†’          </div>
   537â†’   537â†’        </div>
   538â†’   538â†’      )}
   539â†’   539â†’    </DashboardLayout>
   540â†’   540â†’  );
   541â†’   541â†’}
   542â†’   542â†’
   543â†’
   544â†’<system-reminder>
   545â†’Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
   546â†’</system-reminder>
   547â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
