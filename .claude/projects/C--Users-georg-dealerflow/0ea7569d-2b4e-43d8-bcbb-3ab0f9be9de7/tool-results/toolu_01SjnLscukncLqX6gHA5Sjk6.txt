193-  // Activity log state
194-  const [activityData, setActivityData] = useState({ activities: [], total: 0, hasMore: false });
195-  const [activityLoading, setActivityLoading] = useState(false);
196-
197-  // VRM Search state
198:  const [vrmSearch, setVrmSearch] = useState("");
199-  const [showVrmDropdown, setShowVrmDropdown] = useState(false);
200-  const [vrmSelectedIndex, setVrmSelectedIndex] = useState(-1);
201-  const [vrmFilter, setVrmFilter] = useState(""); // Persisted filter applied to board
202:  const vrmSearchInputRef = useRef(null);
203-  const vrmDropdownRef = useRef(null);
204-  const [vrmDropdownPos, setVrmDropdownPos] = useState({ top: 0, left: 0 });
205-
206:  // Compute VRM search results reactively based on vrmSearch and vehicles
207:  const vrmSearchResults = useMemo(() => {
208:    if (vrmSearch.length < 2) return [];
209-    if (!vehicles.length) return [];
210-
211:    const query = vrmSearch.toUpperCase().replace(/\s/g, "");
212-
213-    // Filter vehicles matching the query (VRM, make, or model)
214-    const matches = vehicles.filter((v) => {
215-      const vrm = (v.regCurrent || "").toUpperCase().replace(/\s/g, "");
216-      const make = (v.make || "").toUpperCase();
--
224-      const bDate = new Date(b.createdAt || 0);
225-      return bDate - aDate;
226-    });
227-
228-    return sorted.slice(0, 10);
229:  }, [vrmSearch, vehicles]);
230-
231:  // Calculate dropdown position when opening
232-  const updateVrmDropdownPosition = useCallback(() => {
233:    if (vrmSearchInputRef.current) {
234:      const rect = vrmSearchInputRef.current.getBoundingClientRect();
235-      setVrmDropdownPos({
236-        top: rect.bottom + 8,
237-        left: rect.left,
238-      });
239-    }
240-  }, []);
241-
242:  // Update position when dropdown opens
243-  useEffect(() => {
244-    if (showVrmDropdown) {
245-      updateVrmDropdownPosition();
246:      // Reset selection when dropdown opens
247-      setVrmSelectedIndex(-1);
248-    }
249-  }, [showVrmDropdown, updateVrmDropdownPosition]);
250-
251:  // Close dropdown when clicking outside
252-  useEffect(() => {
253-    const handleClickOutside = (e) => {
254-      if (
255-        showVrmDropdown &&
256:        vrmSearchInputRef.current &&
257:        !vrmSearchInputRef.current.contains(e.target) &&
258-        vrmDropdownRef.current &&
259-        !vrmDropdownRef.current.contains(e.target)
260-      ) {
261-        setShowVrmDropdown(false);
262-      }
--
408-
409-  // Open vehicle drawer - vehicle from grid already has tasks, issues, documents
410-  const openVehicleDrawer = (vehicle) => {
411-    setSelectedVehicle({ ...vehicle, id: vehicle.id || vehicle._id });
412-    setActiveTab("overview");
413:    setShowLabelsDropdown(false); // Close labels dropdown when opening new vehicle
414-    setActivityData({ activities: [], total: 0, hasMore: false }); // Reset activity when opening new vehicle
415-  };
416-
417-  const updateVehicleStatus = async (vehicleId, newStatus) => {
418-    try {
--
1328-  const handleVrmSearchChange = (value) => {
1329-    const normalized = value.toUpperCase();
1330-    setVrmSearch(normalized);
1331-    setVrmSelectedIndex(-1); // Reset selection on input change
1332-
1333:    // Show dropdown when 2+ characters
1334-    if (normalized.length >= 2) {
1335-      setShowVrmDropdown(true);
1336-    } else {
1337-      setShowVrmDropdown(false);
1338-    }
1339-  };
1340-
1341-  // Apply VRM filter to board (pressing Enter)
1342-  const applyVrmFilter = () => {
1343:    const filterValue = vrmSearch.trim();
1344-    setVrmFilter(filterValue);
1345-    setShowVrmDropdown(false);
1346-    if (filterValue) {
1347-      toast.success(`Filtering by: ${filterValue}`);
1348-    }
--
1355-    setShowVrmDropdown(false);
1356-  };
1357-
1358-  // Keyboard navigation for VRM search
1359-  const handleVrmKeyDown = (e) => {
1360:    if (!showVrmDropdown || vrmSearchResults.length === 0) {
1361:      // Enter applies filter even without dropdown
1362:      if (e.key === "Enter" && vrmSearch.length >= 2) {
1363-        e.preventDefault();
1364-        applyVrmFilter();
1365-      }
1366-      return;
1367-    }
1368-
1369-    switch (e.key) {
1370-      case "ArrowDown":
1371-        e.preventDefault();
1372-        setVrmSelectedIndex((prev) =>
1373:          prev < vrmSearchResults.length - 1 ? prev + 1 : prev
1374-        );
1375-        break;
1376-      case "ArrowUp":
1377-        e.preventDefault();
1378-        setVrmSelectedIndex((prev) => (prev > 0 ? prev - 1 : -1));
1379-        break;
1380-      case "Enter":
1381-        e.preventDefault();
1382:        if (vrmSelectedIndex >= 0 && vrmSearchResults[vrmSelectedIndex]) {
1383-          // Select highlighted vehicle
1384:          handleVrmSelect(vrmSearchResults[vrmSelectedIndex]);
1385-        } else {
1386-          // Apply filter to board
1387-          applyVrmFilter();
1388-        }
1389-        break;
1390-      case "Escape":
1391-        e.preventDefault();
1392-        setShowVrmDropdown(false);
1393:        vrmSearchInputRef.current?.blur();
1394-        break;
1395-    }
1396-  };
1397-
1398-  const handleVrmSelect = (vehicle) => {
1399:    // Close dropdown and keep search term as filter
1400-    const vrm = vehicle.regCurrent || vehicle.vrm || "";
1401-    setVrmSearch(vrm);
1402-    setVrmFilter(vrm);
1403-    setShowVrmDropdown(false);
1404-
--
1784-              <div className="relative">
1785-                <svg className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
1786-                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
1787-                </svg>
1788-                <input
1789:                  ref={vrmSearchInputRef}
1790-                  type="text"
1791-                  placeholder={vrmFilter ? `Filtered: ${vrmFilter}` : "Search VRM..."}
1792-                  className={`input input-sm input-bordered pl-9 pr-8 w-32 sm:w-48 font-mono uppercase ${vrmFilter ? "border-blue-400 bg-blue-50" : ""}`}
1793:                  value={vrmSearch}
1794-                  onChange={(e) => handleVrmSearchChange(e.target.value)}
1795-                  onFocus={() => {
1796:                    if (vrmSearch.length >= 2) {
1797-                      setShowVrmDropdown(true);
1798-                    }
1799-                  }}
1800-                  onKeyDown={handleVrmKeyDown}
1801-                />
1802:                {(vrmSearch || vrmFilter) && (
1803-                  <button
1804-                    className="absolute right-2 top-1\2 -translate-y-1\2 text-slate-400 hover:text-slate-600"
1805-                    onClick={clearVrmFilter}
1806-                  >
1807-                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
--
1817-        <div
1818-          ref={vrmDropdownRef}
1819-          className="fixed w-80 bg-white rounded-xl shadow-xl border border-slate-200 z-[101] overflow-hidden"
1820-          style={{ top: vrmDropdownPos.top, left: vrmDropdownPos.left }}
1821-        >
1822:          {vrmSearchResults.length > 0 ? (
1823-            <>
1824-              <ul className="py-1 max-h-64 overflow-y-auto">
1825:                {vrmSearchResults.map((vehicle, idx) => {
1826-                  // Check if this VRM has duplicates (for "Latest" badge)
1827-                  const vrm = (vehicle.regCurrent || "").toUpperCase();
1828:                  const duplicateCount = vrmSearchResults.filter(v => (v.regCurrent || "").toUpperCase() === vrm).length;
1829:                  const isFirstOfDuplicate = idx === vrmSearchResults.findIndex(v => (v.regCurrent || "").toUpperCase() === vrm);
1830-                  const isSelected = idx === vrmSelectedIndex;
1831-
1832-                  return (
1833-                    <li key={vehicle.id || vehicle._id}>
1834-                      <button
--
1863-              <div className="px-3 py-2 bg-slate-50 border-t text-xs text-slate-500 flex items-center justify-between">
1864-                <span>Press Enter to filter board</span>
1865-                <span className="text-slate-400">↑↓ Navigate</span>
1866-              </div>
1867-            </>
1868:          ) : vrmSearch.length >= 2 ? (
1869-            <div className="px-4 py-6 text-center">
1870-              <svg className="w-8 h-8 mx-auto text-slate-300 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
1871-                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
1872-              </svg>
1873-              <p className="text-sm text-slate-500">No vehicles found</p>
--
2591-                    </h3>
2592-                    <span className="bg-slate-900/10 text-slate-700 w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center">
2593-                      {columnVehicles.length}
2594-                    </span>
2595-                  </div>
2596:                  <div className="dropdown dropdown-end">
2597-                    <label tabIndex={0} className="btn btn-ghost btn-xs gap-1 bg-white\30 backdrop-blur-sm hover:bg-white/50 rounded-full">
2598-                      <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
2599-                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
2600-                      </svg>
2601-                      <span className="text-xs">
2602-                        {columnSortOptions[col.key] === "newest_first" ? "Newest" :
2603-                         columnSortOptions[col.key] === "alphabetical" ? "A-Z" : "Oldest"}
2604-                      </span>
2605-                    </label>
2606:                    <ul tabIndex={0} className="dropdown-content z-30 menu p-2 shadow-lg bg-white rounded-xl w-44 mt-2">
2607-                      <li>
2608-                        <button
2609-                          className={`rounded-lg ${columnSortOptions[col.key] === "oldest_first" || !columnSortOptions[col.key] ? "active bg-slate-100" : ""}`}
2610-                          onClick={() => setColumnSortOptions(prev => ({ ...prev, [col.key]: "oldest_first" }))}
2611-                        >
--
4724-  // Appraisal lookup state
4725-  const [matchedAppraisal, setMatchedAppraisal] = useState(null);
4726-  const [isCheckingAppraisal, setIsCheckingAppraisal] = useState(false);
4727-  const [appraisalDismissed, setAppraisalDismissed] = useState(false);
4728-
4729:  // VRM appraisal suggestions
4730-  const [appraisalSuggestions, setAppraisalSuggestions] = useState([]);
4731-  const [showAppraisalDropdown, setShowAppraisalDropdown] = useState(false);
4732-  const [isSearchingAppraisals, setIsSearchingAppraisals] = useState(false);
4733-
4734-  // Document uploads
--
4804-    } finally {
4805-      setIsSearchingAppraisals(false);
4806-    }
4807-  };
4808-
4809:  // Handle selecting an appraisal from suggestions
4810-  const handleSelectAppraisalSuggestion = (appraisal) => {
4811-    setFormData(prev => ({
4812-      ...prev,
4813-      regCurrent: appraisal.vehicleReg || prev.regCurrent,
4814-      make: appraisal.vehicleMake || prev.make,
--
5104-                  }}
5105-                  onFocus={() => {
5106-                    if (appraisalSuggestions.length > 0) setShowAppraisalDropdown(true);
5107-                  }}
5108-                  onBlur={(e) => {
5109:                    // Delay hiding dropdown so click on suggestion can register
5110-                    setTimeout(() => setShowAppraisalDropdown(false), 200);
5111-                    checkForAppraisal(e.target.value);
5112-                  }}
5113-                />
5114-                {isSearchingAppraisals && (