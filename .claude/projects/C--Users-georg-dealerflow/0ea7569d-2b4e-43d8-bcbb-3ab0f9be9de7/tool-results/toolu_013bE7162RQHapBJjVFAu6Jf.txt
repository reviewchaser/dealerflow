The file C:\Users\georg\dealerflow\components\DealDrawer.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
  1363→                            {formatCurrency(Math.max(0, totals.balanceDue))}
  1364→                          </span>
  1365→                        </div>
  1366→                      </div>
  1367→                    </div>
  1368→                  </div>
  1369→
  1370→                  {/* Part Exchange Section */}
  1371→                  {deal.partExchange && (
  1372→                    <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
  1373→                      <div className="px-4 py-3 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100">
  1374→                        <div className="flex items-center gap-2">
  1375→                          <div className="w-8 h-8 rounded-lg bg-emerald-100 flex items-center justify-center">
  1376→                            <svg className="w-4 h-4 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1377→                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
  1378→                            </svg>
  1379→                          </div>
  1380→                          <h3 className="text-sm font-bold text-slate-800">Part Exchange</h3>
  1381→                        </div>
  1382→                      </div>
  1383→                      <div className="p-4 space-y-3">
  1384→                        <div>
  1385→                          <span className="text-xs font-medium text-slate-400 uppercase tracking-wide">Vehicle</span>
  1386→                          <p className="font-semibold text-slate-900 mt-0.5">
  1387→                            {deal.partExchange.vrm} - {deal.partExchange.make} {deal.partExchange.model}
  1388→                          </p>
  1389→                        </div>
  1390→                        <div className="grid grid-cols-2 gap-4">
  1391→                          <div>
  1392→                            <span className="text-xs font-medium text-slate-400 uppercase tracking-wide">Allowance</span>
  1393→                            <p className="font-semibold text-slate-900 mt-0.5">
  1394→                              {formatCurrency(deal.partExchange.allowance)}
  1395→                            </p>
  1396→                          </div>
  1397→                          {deal.partExchange.settlement > 0 && (
  1398→                            <div>
  1399→                              <span className="text-xs font-medium text-slate-400 uppercase tracking-wide">Settlement</span>
  1400→                              <p className="font-semibold text-red-600 mt-0.5">
  1401→                                -{formatCurrency(deal.partExchange.settlement)}
  1402→                              </p>
  1403→                            </div>
  1404→                          )}
  1405→                        </div>
  1406→                        <div className="pt-2 border-t border-slate-100">
  1407→                          <span className="text-xs font-medium text-slate-400 uppercase tracking-wide">Net Value</span>
  1408→                          <p className="font-bold text-emerald-600 mt-0.5">
  1409→                            {formatCurrency(totals.pxNetValue)}
  1410→                          </p>
  1411→                        </div>
  1412→                      </div>
  1413→                    </div>
  1414→                  )}
  1415→
  1416→                  {/* Next Actions */}
  1417→                  {deal.status !== "COMPLETED" && deal.status !== "CANCELLED" && (
  1418→                    <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
  1419→                      <div className="px-4 py-3 bg-gradient-to-r from-blue-50 to-white border-b border-slate-100">
  1420→                        <div className="flex items-center gap-2">
  1421→                          <div className="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center">
  1422→                            <svg className="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1423→                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
  1424→                            </svg>
  1425→                          </div>
  1426→                          <h3 className="text-sm font-bold text-slate-800">Next Actions</h3>
  1427→                        </div>
  1428→                      </div>
  1429→                      <div className="p-4 space-y-4">
  1430→                        {/* Take Deposit - for Draft or Deposit_Taken status */}
  1431→                        {(deal.status === "DRAFT" || deal.status === "DEPOSIT_TAKEN") && (() => {
  1432→                          const { allowed, reasons } = canTakeDeposit();
  1433→                          return (
  1434→                            <div className="space-y-2">
  1435→                              <div className="flex items-center justify-between">
  1436→                                <span className="text-sm font-medium text-slate-700">Take Deposit</span>
  1437→                                {deal.status === "DEPOSIT_TAKEN" && (
  1438→                                  <span className="text-xs text-emerald-600 font-medium">Additional deposit</span>
  1439→                                )}
  1440→                              </div>
  1441→                              {deal.status === "DRAFT" && !allowed && reasons.length > 0 && (
  1442→                                <div className="bg-amber-50 border border-amber-200 rounded-xl p-3">
  1443→                                  <p className="text-xs font-medium text-amber-800 mb-1.5">Required:</p>
  1444→                                  <ul className="space-y-1">
  1445→                                    {reasons.map((r, i) => (
  1446→                                      <li key={i} className="text-xs text-amber-700 flex items-center gap-1.5">
  1447→                                        <svg className="w-3 h-3 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1448→                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  1449→                                        </svg>
  1450→                                        {r}
  1451→                                      </li>
  1452→                                    ))}
  1453→                                  </ul>
  1454→                                </div>
  1455→                              )}
  1456→                              <button
  1457→                                onClick={() => (allowed || deal.status === "DEPOSIT_TAKEN") && setShowDepositModal(true)}
  1458→                                disabled={actionLoading || (deal.status === "DRAFT" && !allowed)}
  1459→                                className={`btn btn-sm w-full border-none ${
  1460→                                  allowed || deal.status === "DEPOSIT_TAKEN"
  1461→                                    ? "bg-amber-500 hover:bg-amber-600 text-white"
  1462→                                    : "bg-slate-200 text-slate-400 cursor-not-allowed"
  1463→                                }`}
  1464→                              >
  1465→                                {actionLoading === "deposit" ? (
  1466→                                  <span className="loading loading-spinner loading-xs"></span>
  1467→                                ) : (
  1468→                                  <>
  1469→                                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1470→                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
  1471→                                    </svg>
  1472→                                    {deal.status === "DEPOSIT_TAKEN" ? "Take Additional Deposit" : "Take Deposit"}
  1473→                                  </>
  1474→                                )}
  1475→                              </button>
  1476→                            </div>
  1477→                          );
  1478→                        })()}
  1479→
  1480→                        {/* Generate Invoice */}
  1481→                        {(deal.status === "DRAFT" || deal.status === "DEPOSIT_TAKEN") && (() => {
  1482→                          const { allowed, reasons } = canGenerateInvoice();
  1483→                          return (
  1484→                            <div className="space-y-2 pt-2 border-t border-slate-100">
  1485→                              <div className="flex items-center justify-between">
  1486→                                <span className="text-sm font-medium text-slate-700">Generate Invoice</span>
  1487→                                {deal.status === "DRAFT" && (
  1488→                                  <span className="text-xs text-slate-400">Invoice-first supported</span>
  1489→                                )}
  1490→                              </div>
  1491→                              {!allowed && reasons.length > 0 && !reasons.includes("Invoice already generated") && (
  1492→                                <div className="bg-blue-50 border border-blue-200 rounded-xl p-3">
  1493→                                  <p className="text-xs font-medium text-blue-800 mb-1.5">Required:</p>
  1494→                                  <ul className="space-y-1">
  1495→                                    {reasons.map((r, i) => (
  1496→                                      <li key={i} className="text-xs text-blue-700 flex items-center gap-1.5">
  1497→                                        <svg className="w-3 h-3 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1498→                                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
  1499→                                        </svg>
  1500→                                        {r}
  1501→                                      </li>
  1502→                                    ))}
  1503→                                  </ul>
  1504→                                </div>
  1505→                              )}
  1506→                              <button
  1507→                                onClick={() => allowed && handleGenerateInvoice()}
  1508→                                disabled={actionLoading || !allowed}
  1509→                                className={`btn btn-sm w-full border-none ${
  1510→                                  allowed
  1511→                                    ? "bg-blue-500 hover:bg-blue-600 text-white"
  1512→                                    : "bg-slate-200 text-slate-400 cursor-not-allowed"
  1513→                                }`}
  1514→                              >
  1515→                                {actionLoading === "invoice" ? (
  1516→                                  <span className="loading loading-spinner loading-xs"></span>
  1517→                                ) : (
  1518→                                  <>
  1519→                                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1520→                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
  1521→                                    </svg>
  1522→                                    Generate Invoice
  1523→                                  </>
  1524→                                )}
  1525→                              </button>
  1526→                            </div>
  1527→                          );
  1528→                        })()}
  1529→
  1530→                        {/* Mark Delivered */}
  1531→                        {deal.status === "INVOICED" && (
  1532→                          <button
  1533→                            onClick={handleMarkDelivered}
  1534→                            disabled={actionLoading}
  1535→                            className="btn btn-sm w-full bg-purple-500 hover:bg-purple-600 text-white border-none"
  1536→                          >
  1537→                            {actionLoading === "delivered" ? (
  1538→                              <span className="loading loading-spinner loading-xs"></span>
  1539→                            ) : (
  1540→                              <>
  1541→                                <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1542→                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
  1543→                                </svg>
  1544→                                Mark Delivered
  1545→                              </>
  1546→                            )}
  1547→                          </button>
  1548→                        )}
  1549→
  1550→                        {/* Complete Deal */}
  1551→                        {deal.status === "DELIVERED" && (
  1552→                          <button
  1553→                            onClick={handleMarkCompleted}
  1554→                            disabled={actionLoading}
  1555→                            className="btn btn-sm w-full bg-emerald-500 hover:bg-emerald-600 text-white border-none"
  1556→                          >
  1557→                            {actionLoading === "completed" ? (
  1558→                              <span className="loading loading-spinner loading-xs"></span>
  1559→                            ) : (
  1560→                              <>
  1561→                                <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1562→                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
  1563→                                </svg>
  1564→                                Complete Deal
  1565→                              </>
  1566→                            )}
  1567→                          </button>
  1568→                        )}
  1569→
  1570→                        {/* Delete/Cancel actions */}
  1571→                        <div className="pt-2 border-t border-slate-100">
  1572→                          {deal.status === "DRAFT" ? (
  1573→                            <button
  1574→                              onClick={() => setShowDeleteConfirm(true)}
  1575→                              disabled={actionLoading}
  1576→                              className="btn btn-sm btn-ghost w-full text-red-500 hover:bg-red-50"
  1577→                            >
  1578→                              Delete Draft
  1579→                            </button>
  1580→                          ) : (
  1581→                            <button
  1582→                              onClick={handleCancelDeal}
  1583→                              disabled={actionLoading}
  1584→                              className="btn btn-sm btn-ghost w-full text-red-500 hover:bg-red-50"
  1585→                            >
  1586→                              Cancel Deal
  1587→                            </button>
  1588→                          )}
  1589→                        </div>
  1590→                      </div>
  1591→                    </div>
  1592→                  )}
  1593→
  1594→                  {/* Settlement Plan */}
  1595→                  {deal.status === "DRAFT" && (
  1596→                    <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
  1597→                      <div className="px-4 py-3 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100">
  1598→                        <div className="flex items-center gap-2">
  1599→                          <div className="w-8 h-8 rounded-lg bg-indigo-100 flex items-center justify-center">
  1600→                            <svg className="w-4 h-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1601→                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
  1602→                            </svg>
  1603→                          </div>
  1604→                          <h3 className="text-sm font-bold text-slate-800">Settlement Plan</h3>
  1605→                        </div>
  1606→                      </div>
  1607→                      <div className="p-4 space-y-4">
  1608→                        <div>
  1609→                          <label className="block text-xs font-medium text-slate-500 mb-1.5">How will this be paid?</label>
  1610→                          <div className="flex flex-wrap gap-2">
  1611→                            {PAYMENT_TYPE_OPTIONS.map((opt) => (
  1612→                              <button
  1613→                                key={opt.value}
  1614→                                onClick={() => handleUpdateField({ paymentType: opt.value })}
  1615→                                className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${
  1616→                                  deal.paymentType === opt.value
  1617→                                    ? "bg-[#0066CC] text-white"
  1618→                                    : "bg-slate-100 text-slate-600 hover:bg-slate-200"
  1619→                                }`}
  1620→                              >
  1621→                                {opt.label}
  1622→                              </button>
  1623→                            ))}
  1624→                          </div>
  1625→                        </div>
  1626→
  1627→                        {/* Finance Details - shown when paymentType is FINANCE or MIXED */}
  1628→                        {(deal.paymentType === "FINANCE" || deal.paymentType === "MIXED") && (
  1629→                          <div className="border-t border-slate-100 pt-4 space-y-3">
  1630→                            <h4 className="text-xs font-semibold text-slate-500 uppercase tracking-wide">Finance Details</h4>
  1631→                            <div className="grid grid-cols-2 gap-3">
  1632→                              <div>
  1633→                                <label className="block text-xs text-slate-500 mb-1">Provider</label>
  1634→                                <input
  1635→                                  type="text"
  1636→                                  className="input input-sm input-bordered w-full"
  1637→                                  placeholder="Finance company"
  1638→                                  value={deal.finance?.provider || ""}
  1639→                                  onChange={(e) => handleUpdateField({
  1640→                                    finance: { ...deal.finance, provider: e.target.value }
  1641→                                  })}
  1642→                                />
  1643→                              </div>
  1644→                              <div>
  1645→                                <label className="block text-xs text-slate-500 mb-1">Finance Type</label>
  1646→                                <select
  1647→                                  className="select select-sm select-bordered w-full"
  1648→                                  value={deal.finance?.financeType || ""}
  1649→                                  onChange={(e) => handleUpdateField({
  1650→                                    finance: { ...deal.finance, financeType: e.target.value }
  1651→                                  })}
  1652→                                >
  1653→                                  <option value="">Select...</option>
  1654→                                  {FINANCE_TYPE_OPTIONS.map((opt) => (
  1655→                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
  1656→                                  ))}
  1657→                                </select>
  1658→                              </div>
  1659→                              <div>
  1660→                                <label className="block text-xs text-slate-500 mb-1">Amount Financed</label>
  1661→                                <div className="relative">
  1662→                                  <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">£</span>
  1663→                                  <input
  1664→                                    type="number"
  1665→                                    className="input input-sm input-bordered w-full pl-7"
  1666→                                    placeholder="0.00"
  1667→                                    value={deal.finance?.amountFinanced || ""}
  1668→                                    onChange={(e) => handleUpdateField({
  1669→                                      finance: { ...deal.finance, amountFinanced: parseFloat(e.target.value) || null }
  1670→                                    })}
  1671→                                  />
  1672→                                </div>
  1673→                              </div>
  1674→                              <div>
  1675→                                <label className="block text-xs text-slate-500 mb-1">Customer Deposit</label>
  1676→                                <div className="relative">
  1677→                                  <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm">£</span>
  1678→                                  <input
  1679→                                    type="number"
  1680→                                    className="input input-sm input-bordered w-full pl-7"
  1681→                                    placeholder="0.00"
  1682→                                    value={deal.finance?.customerDeposit || ""}
  1683→                                    onChange={(e) => handleUpdateField({
  1684→                                      finance: { ...deal.finance, customerDeposit: parseFloat(e.target.value) || null }
  1685→                                    })}
  1686→                                  />
  1687→                                </div>
  1688→                              </div>
  1689→                              <div>
  1690→                                <label className="block text-xs text-slate-500 mb-1">Status</label>
  1691→                                <select
  1692→                                  className="select select-sm select-bordered w-full"
  1693→                                  value={deal.finance?.status || "QUOTED"}
  1694→                                  onChange={(e) => handleUpdateField({
  1695→                                    finance: { ...deal.finance, status: e.target.value }
  1696→                                  })}
  1697→                                >
  1698→                                  {FINANCE_STATUS_OPTIONS.map((opt) => (
  1699→                                    <option key={opt.value} value={opt.value}>{opt.label}</option>
  1700→                                  ))}
  1701→                                </select>
  1702→                              </div>
  1703→                              <div>
  1704→                                <label className="block text-xs text-slate-500 mb-1">Reference</label>
  1705→                                <input
  1706→                                  type="text"
  1707→                                  className="input input-sm input-bordered w-full"
  1708→                                  placeholder="Agreement ref"
  1709→                                  value={deal.finance?.reference || ""}
  1710→                                  onChange={(e) => handleUpdateField({
  1711→                                    finance: { ...deal.finance, reference: e.target.value }
  1712→                                  })}
  1713→                                />
  1714→                              </div>
  1715→                            </div>
  1716→                          </div>
  1717→                        )}
  1718→                      </div>
  1719→                    </div>
  1720→                  )}
  1721→
  1722→                  {/* Timeline */}
  1723→                  <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
  1724→                    <div className="px-4 py-3 bg-gradient-to-r from-slate-50 to-white border-b border-slate-100">
  1725→                      <div className="flex items-center gap-2">
  1726→                        <div className="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center">