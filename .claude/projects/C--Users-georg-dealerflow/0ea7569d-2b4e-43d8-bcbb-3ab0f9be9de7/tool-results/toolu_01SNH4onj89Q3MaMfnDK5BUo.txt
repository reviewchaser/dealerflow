     1→import { useState } from "react";
     2→import { signIn } from "next-auth/react";
     3→import { useRouter } from "next/router";
     4→import Head from "next/head";
     5→import Link from "next/link";
     6→import toast from "react-hot-toast";
     7→
     8→export default function SignUp() {
     9→  const router = useRouter();
    10→  const [formData, setFormData] = useState({
    11→    name: "",
    12→    email: "",
    13→    password: "",
    14→    confirmPassword: "",
    15→  });
    16→  const [loading, setLoading] = useState(false);
    17→  const [error, setError] = useState("");
    18→  const [errorCode, setErrorCode] = useState("");
    19→
    20→  const handleChange = (e) => {
    21→    setFormData({ ...formData, [e.target.name]: e.target.value });
    22→  };
    23→
    24→  const handleSignUp = async (e) => {
    25→    e.preventDefault();
    26→    setLoading(true);
    27→    setError("");
    28→    setErrorCode("");
    29→
    30→    // Validate passwords match
    31→    if (formData.password !== formData.confirmPassword) {
    32→      setError("Passwords do not match");
    33→      setLoading(false);
    34→      return;
    35→    }
    36→
    37→    // Validate password strength
    38→    if (formData.password.length < 6) {
    39→      setError("Password must be at least 6 characters");
    40→      setLoading(false);
    41→      return;
    42→    }
    43→
    44→    try {
    45→      // Create user via API
    46→      const res = await fetch("/api/auth/register", {
    47→        method: "POST",
    48→        headers: { "Content-Type": "application/json" },
    49→        body: JSON.stringify({
    50→          name: formData.name,
    51→          email: formData.email,
    52→          password: formData.password,
    53→        }),
    54→      });
    55→
    56→      // Check content-type before parsing JSON
    57→      const contentType = res.headers.get("content-type") || "";
    58→      if (!contentType.includes("application/json")) {
    59→        // Server returned HTML (likely redirect or error page)
    60→        const text = await res.text();
    61→        if (process.env.NODE_ENV !== "production") {
    62→          console.error("[Signup] Non-JSON response:", res.status, text.slice(0, 500));
    63→        }
    64→        setError("Signup failed: server returned HTML (check auth/middleware/API route)");
    65→        setLoading(false);
    66→        return;
    67→      }
    68→
    69→      let data;
    70→      try {
    71→        data = await res.json();
    72→      } catch (parseErr) {
    73→        if (process.env.NODE_ENV !== "production") {
    74→          console.error("[Signup] JSON parse error:", parseErr);
    75→        }
    76→        setError("Signup failed: invalid response from server");
    77→        setLoading(false);
    78→        return;
    79→      }
    80→
    81→      if (!res.ok) {
    82→        // Show the exact error from backend
    83→        const errorMsg = data.error || data.message || "Registration failed";
    84→        if (process.env.NODE_ENV !== "production") {
    85→          console.error("[Signup] API error:", res.status, data);
    86→        }
    87→        setError(errorMsg);
    88→        setErrorCode(data.code || "");
    89→        setLoading(false);
    90→        return;
    91→      }
    92→
    93→      // Sign in with the new credentials
    94→      const signInResult = await signIn("credentials", {
    95→        email: formData.email,
    96→        password: formData.password,
    97→        redirect: false,
    98→      });
    99→
   100→      if (signInResult?.error) {
   101→        // Account created but sign-in failed - redirect to sign in page
   102→        toast.success("Account created! Please sign in.");
   103→        router.push("/auth/signin");
   104→      } else {
   105→        // Success - redirect to create dealer (onboarding)
   106→        toast.success("Welcome to DealerHQ!");
   107→        router.push("/onboarding/create-dealer");
   108→      }
   109→    } catch (err) {
   110→      if (process.env.NODE_ENV !== "production") {
   111→        console.error("[Signup] Unexpected error:", err);
   112→      }
   113→      setError(err.message || "An unexpected error occurred");
   114→      setLoading(false);
   115→    }
   116→  };
   117→
   118→  return (
   119→    <>
   120→      <Head>
   121→        <title>Sign Up | DealerHQ</title>
   122→      </Head>
   123→
   124→      <div className="min-h-screen bg-base-200 flex items-center justify-center p-4">
   125→        <div className="card bg-base-100 shadow-xl w-full max-w-md">
   126→          <div className="card-body">
   127→            {/* Header */}
   128→            <div className="text-center mb-6">
   129→              <Link href="/" className="inline-flex items-center justify-center gap-2 mb-2">
   130→                <svg className="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   131→                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
   132→                </svg>
   133→                <span className="text-xl font-bold">DealerHQ</span>
   134→              </Link>
   135→              <h1 className="text-2xl font-bold">Create Your Account</h1>
   136→              <p className="text-sm text-base-content/60 mt-1">Get started with DealerHQ in seconds</p>
   137→            </div>
   138→
   139→            <form onSubmit={handleSignUp} className="space-y-4">
   140→              {error && (
   141→                <div className="alert alert-error text-sm py-2">
   142→                  <div className="flex flex-col gap-2 w-full">
   143→                    <span>{error}</span>
   144→                    {/* Show helpful links for existing account errors */}
   145→                    {(errorCode === "EMAIL_EXISTS" || errorCode === "NO_PASSWORD_SET") && (
   146→                      <div className="flex gap-3 text-xs">
   147→                        <Link href="/auth/signin" className="link link-primary">
   148→                          Sign in instead
   149→                        </Link>
   150→                        <span className="text-base-content/40">|</span>
   151→                        <Link href="/auth/forgot-password" className="link link-primary">
   152→                          Forgot password?
   153→                        </Link>
   154→                      </div>
   155→                    )}
   156→                  </div>
   157→                </div>
   158→              )}
   159→
   160→              <div className="form-control">
   161→                <label className="label">
   162→                  <span className="label-text">Full Name</span>
   163→                </label>
   164→                <input
   165→                  type="text"
   166→                  name="name"
   167→                  className="input input-bordered"
   168→                  placeholder="John Smith"
   169→                  value={formData.name}
   170→                  onChange={handleChange}
   171→                  required
   172→                  autoComplete="name"
   173→                />
   174→              </div>
   175→
   176→              <div className="form-control">
   177→                <label className="label">
   178→                  <span className="label-text">Email</span>
   179→                </label>
   180→                <input
   181→                  type="email"
   182→                  name="email"
   183→                  className="input input-bordered"
   184→                  placeholder="you@example.com"
   185→                  value={formData.email}
   186→                  onChange={handleChange}
   187→                  required
   188→                  autoComplete="email"
   189→                />
   190→              </div>
   191→
   192→              <div className="form-control">
   193→                <label className="label">
   194→                  <span className="label-text">Password</span>
   195→                </label>
   196→                <input
   197→                  type="password"
   198→                  name="password"
   199→                  className="input input-bordered"
   200→                  placeholder="Min. 6 characters"
   201→                  value={formData.password}
   202→                  onChange={handleChange}
   203→                  required
   204→                  minLength={6}
   205→                  autoComplete="new-password"
   206→                />
   207→              </div>
   208→
   209→              <div className="form-control">
   210→                <label className="label">
   211→                  <span className="label-text">Confirm Password</span>
   212→                </label>
   213→                <input
   214→                  type="password"
   215→                  name="confirmPassword"
   216→                  className="input input-bordered"
   217→                  placeholder="Re-enter password"
   218→                  value={formData.confirmPassword}
   219→                  onChange={handleChange}
   220→                  required
   221→                  minLength={6}
   222→                  autoComplete="new-password"
   223→                />
   224→              </div>
   225→
   226→              <button
   227→                type="submit"
   228→                className="btn btn-primary btn-block"
   229→                disabled={loading}
   230→              >
   231→                {loading ? (
   232→                  <span className="loading loading-spinner loading-sm"></span>
   233→                ) : (
   234→                  "Create Account"
   235→                )}
   236→              </button>
   237→
   238→              <p className="text-xs text-base-content/50 text-center">
   239→                By signing up, you agree to our Terms of Service and Privacy Policy.
   240→              </p>
   241→            </form>
   242→
   243→            {/* Divider */}
   244→            <div className="divider text-xs text-base-content/50">or continue with</div>
   245→
   246→            {/* OAuth Providers */}
   247→            <div className="space-y-2">
   248→              <button
   249→                onClick={() => signIn("google", { callbackUrl: "/onboarding/create-dealer" })}
   250→                className="btn btn-outline btn-block"
   251→              >
   252→                <svg className="w-5 h-5 mr-2" viewBox="0 0 24 24">
   253→                  <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
   254→                  <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
   255→                  <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
   256→                  <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
   257→                </svg>
   258→                Google
   259→              </button>
   260→            </div>
   261→
   262→            {/* Sign In Link */}
   263→            <div className="text-center mt-6">
   264→              <p className="text-sm text-base-content/60">
   265→                Already have an account?{" "}
   266→                <Link href="/auth/signin" className="text-primary hover:underline font-medium">
   267→                  Sign in
   268→                </Link>
   269→              </p>
   270→            </div>
   271→
   272→            {/* Back to Home */}
   273→            <div className="text-center mt-2">
   274→              <Link href="/" className="text-sm text-base-content/50 hover:text-base-content">
   275→                &larr; Back to home
   276→              </Link>
   277→            </div>
   278→          </div>
   279→        </div>
   280→      </div>
   281→    </>
   282→  );
   283→}
   284→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
