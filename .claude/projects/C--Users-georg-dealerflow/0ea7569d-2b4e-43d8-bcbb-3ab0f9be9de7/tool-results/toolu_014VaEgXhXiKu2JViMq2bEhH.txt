     1→import { useEffect, useState } from "react";
     2→import Head from "next/head";
     3→import Link from "next/link";
     4→import DashboardLayout from "@/components/DashboardLayout";
     5→import { toast } from "react-hot-toast";
     6→import { showDummyNotification } from "@/utils/notifications";
     7→import useDealerRedirect from "@/hooks/useDealerRedirect";
     8→
     9→export default function Settings() {
    10→  const { isRedirecting } = useDealerRedirect();
    11→  const [labels, setLabels] = useState([]);
    12→  const [categories, setCategories] = useState([]);
    13→  const [locations, setLocations] = useState([]);
    14→  const [prepTasks, setPrepTasks] = useState([]);
    15→  const [newLabel, setNewLabel] = useState({ name: "", colour: "#6366f1" });
    16→  const [newCategory, setNewCategory] = useState({ name: "", colour: "#3b82f6" });
    17→  const [newLocation, setNewLocation] = useState("");
    18→  const [newPrepTask, setNewPrepTask] = useState("");
    19→
    20→  // Dealer branding state
    21→  const [dealer, setDealer] = useState(null);
    22→  const [dealerForm, setDealerForm] = useState({
    23→    name: "",
    24→    companyName: "",
    25→    companyAddress: "",
    26→    companyPhone: "",
    27→    companyEmail: "",
    28→    googleReviewUrl: "",
    29→    slug: "",
    30→  });
    31→  const [isUploadingLogo, setIsUploadingLogo] = useState(false);
    32→  const [isSavingDealer, setIsSavingDealer] = useState(false);
    33→
    34→  // Sales settings state
    35→  const [salesSettings, setSalesSettings] = useState({
    36→    invoiceNumberPrefix: "INV",
    37→    nextInvoiceNumber: 1,
    38→    depositReceiptPrefix: "DEP",
    39→    nextDepositReceiptNumber: 1,
    40→    vatRate: 20,
    41→    defaultVatScheme: "MARGIN",
    42→    vatNumber: "",
    43→    vatRegistered: false,
    44→    companyNumber: "",
    45→    bankDetails: {
    46→      accountName: "",
    47→      sortCode: "",
    48→      accountNumber: "",
    49→    },
    50→    terms: {
    51→      consumerInPerson: "",
    52→      consumerDistance: "",
    53→      businessInPerson: "",
    54→      businessDistance: "",
    55→    },
    56→  });
    57→  const [isSavingSales, setIsSavingSales] = useState(false);
    58→  const [activeTermsTab, setActiveTermsTab] = useState("consumerInPerson");
    59→
    60→  // Theme state
    61→  const [theme, setTheme] = useState("light");
    62→
    63→  // Integration status state
    64→  const [integrationStatus, setIntegrationStatus] = useState({
    65→    openai: null, // null = loading, true = configured, false = not configured
    66→    dvla: null,
    67→  });
    68→
    69→  // Load theme from localStorage on mount
    70→  useEffect(() => {
    71→    const savedTheme = localStorage.getItem("theme") || "system";
    72→    setTheme(savedTheme);
    73→    applyTheme(savedTheme);
    74→  }, []);
    75→
    76→  const applyTheme = (selectedTheme) => {
    77→    const root = document.documentElement;
    78→    if (selectedTheme === "system") {
    79→      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    80→      root.setAttribute("data-theme", prefersDark ? "dark" : "dealerflow");
    81→      root.classList.toggle("dark", prefersDark);
    82→    } else if (selectedTheme === "light" || selectedTheme === "dealerflow") {
    83→      // Use dealerflow theme for light mode (blue primary color)
    84→      root.setAttribute("data-theme", "dealerflow");
    85→      root.classList.remove("dark");
    86→    } else {
    87→      root.setAttribute("data-theme", selectedTheme);
    88→      root.classList.toggle("dark", selectedTheme === "dark");
    89→    }
    90→  };
    91→
    92→  const handleThemeChange = (newTheme) => {
    93→    setTheme(newTheme);
    94→    localStorage.setItem("theme", newTheme);
    95→    applyTheme(newTheme);
    96→    toast.success(`Theme changed to ${newTheme}`);
    97→  };
    98→
    99→  useEffect(() => {
   100→    fetchLabels();
   101→    fetchCategories();
   102→    fetchLocations();
   103→    fetchPrepTasks();
   104→    fetchDealer();
   105→    fetchIntegrationStatus();
   106→  }, []);
   107→
   108→  const fetchIntegrationStatus = async () => {
   109→    try {
   110→      // Check OpenAI status
   111→      const openaiRes = await fetch("/api/ai/health");
   112→      const openaiData = await openaiRes.json();
   113→
   114→      setIntegrationStatus(prev => ({
   115→        ...prev,
   116→        openai: openaiData.ok === true,
   117→        dvla: true, // DVLA is always configured if env var exists (checked server-side)
   118→      }));
   119→    } catch (error) {
   120→      console.error("Failed to fetch integration status:", error);
   121→    }
   122→  };
   123→
   124→  const fetchLabels = async () => {
   125→    try {
   126→      const res = await fetch("/api/labels");
   127→      const data = await res.json();
   128→      setLabels(data);
   129→    } catch (error) {
   130→      console.error("Failed to load labels");
   131→    }
   132→  };
   133→
   134→  const fetchCategories = async () => {
   135→    try {
   136→      const res = await fetch("/api/calendar/categories");
   137→      const data = await res.json();
   138→      // Ensure data is an array and normalize fields
   139→      const categoriesArray = Array.isArray(data) ? data : (data?.categories ?? []);
   140→      setCategories(
   141→        categoriesArray.map((c) => ({
   142→          id: c.id ?? c._id,
   143→          name: c.name ?? "",
   144→          colour: c.colour ?? c.color ?? "#6366f1",
   145→        }))
   146→      );
   147→    } catch (error) {
   148→      console.error("Failed to load categories");
   149→      setCategories([]); // Reset to empty array on error
   150→    }
   151→  };
   152→
   153→  const addLabel = async (e) => {
   154→    e.preventDefault();
   155→    if (!newLabel.name) return toast.error("Label name required");
   156→    try {
   157→      await fetch("/api/labels", {
   158→        method: "POST",
   159→        headers: { "Content-Type": "application/json" },
   160→        body: JSON.stringify(newLabel),
   161→      });
   162→      setNewLabel({ name: "", colour: "#6366f1" });
   163→      fetchLabels();
   164→      toast.success("Label added");
   165→    } catch (error) {
   166→      toast.error("Failed to add label");
   167→    }
   168→  };
   169→
   170→  const deleteLabel = async (labelId) => {
   171→    if (!confirm("Delete this label?")) return;
   172→    try {
   173→      await fetch(`/api/labels/${labelId}`, { method: "DELETE" });
   174→      fetchLabels();
   175→      toast.success("Label deleted");
   176→    } catch (error) {
   177→      toast.error("Failed to delete label");
   178→    }
   179→  };
   180→
   181→  const addCategory = async (e) => {
   182→    e.preventDefault();
   183→    if (!newCategory.name) return toast.error("Category name required");
   184→    try {
   185→      await fetch("/api/calendar/categories", {
   186→        method: "POST",
   187→        headers: { "Content-Type": "application/json" },
   188→        body: JSON.stringify(newCategory),
   189→      });
   190→      setNewCategory({ name: "", colour: "#3b82f6" });
   191→      fetchCategories();
   192→      toast.success("Category added");
   193→    } catch (error) {
   194→      toast.error("Failed to add category");
   195→    }
   196→  };
   197→
   198→  const fetchLocations = async () => {
   199→    try {
   200→      const res = await fetch("/api/locations");
   201→      const data = await res.json();
   202→      setLocations(data);
   203→    } catch (error) {
   204→      console.error("Failed to load locations");
   205→    }
   206→  };
   207→
   208→  const fetchPrepTasks = async () => {
   209→    try {
   210→      const res = await fetch("/api/prep-tasks");
   211→      const data = await res.json();
   212→      setPrepTasks(data);
   213→    } catch (error) {
   214→      console.error("Failed to load prep tasks");
   215→    }
   216→  };
   217→
   218→  const fetchDealer = async () => {
   219→    try {
   220→      const res = await fetch("/api/dealer");
   221→      const data = await res.json();
   222→
   223→      // If dealer has a logo key, fetch a fresh signed URL
   224→      if (data.logoKey) {
   225→        try {
   226→          const logoRes = await fetch("/api/dealer/logo");
   227→          if (logoRes.ok) {
   228→            const logoData = await logoRes.json();
   229→            data.logoUrl = logoData.url; // Use fresh signed URL
   230→          }
   231→        } catch (logoError) {
   232→          console.warn("Failed to refresh logo URL:", logoError);
   233→        }
   234→      }
   235→
   236→      setDealer(data);
   237→      setDealerForm({
   238→        name: data.name || "",
   239→        companyName: data.companyName || "",
   240→        companyAddress: data.companyAddress || "",
   241→        companyPhone: data.companyPhone || "",
   242→        companyEmail: data.companyEmail || "",
   243→        googleReviewUrl: data.googleReviewUrl || "",
   244→        slug: data.slug || "",
   245→      });
   246→      // Populate salesSettings
   247→      const ss = data.salesSettings || {};
   248→      setSalesSettings({
   249→        invoiceNumberPrefix: ss.invoiceNumberPrefix || "INV",
   250→        nextInvoiceNumber: ss.nextInvoiceNumber || 1,
   251→        depositReceiptPrefix: ss.depositReceiptPrefix || "DEP",
   252→        nextDepositReceiptNumber: ss.nextDepositReceiptNumber || 1,
   253→        vatRate: (ss.vatRate || 0.2) * 100, // Convert to percentage for display
   254→        defaultVatScheme: ss.defaultVatScheme || "MARGIN",
   255→        vatNumber: ss.vatNumber || "",
   256→        vatRegistered: ss.vatRegistered || false,
   257→        companyNumber: ss.companyNumber || "",
   258→        bankDetails: {
   259→          accountName: ss.bankDetails?.accountName || "",
   260→          sortCode: ss.bankDetails?.sortCode || "",
   261→          accountNumber: ss.bankDetails?.accountNumber || "",
   262→        },
   263→        terms: {
   264→          consumerInPerson: ss.terms?.consumerInPerson || "",
   265→          consumerDistance: ss.terms?.consumerDistance || "",
   266→          businessInPerson: ss.terms?.businessInPerson || "",
   267→          businessDistance: ss.terms?.businessDistance || "",
   268→        },
   269→      });
   270→    } catch (error) {
   271→      console.error("Failed to load dealer");
   272→    }
   273→  };
   274→
   275→  const handleLogoUpload = async (e) => {
   276→    const file = e.target.files?.[0];
   277→    if (!file) return;
   278→
   279→    // Validate file type
   280→    const validTypes = ["image/png", "image/jpeg", "image/jpg", "image/webp", "image/gif"];
   281→    if (!validTypes.includes(file.type)) {
   282→      toast.error("Please upload PNG, JPEG, WebP, or GIF");
   283→      return;
   284→    }
   285→
   286→    // Validate file size (max 5MB)
   287→    const maxSize = 5 * 1024 * 1024;
   288→    if (file.size > maxSize) {
   289→      toast.error(`File too large (${(file.size / 1024 / 1024).toFixed(1)}MB). Maximum is 5MB.`);
   290→      return;
   291→    }
   292→
   293→    setIsUploadingLogo(true);
   294→    try {
   295→      const formData = new FormData();
   296→      formData.append("file", file);
   297→
   298→      // Use dedicated dealer logo endpoint (tenant-scoped, handles DB update)
   299→      const uploadRes = await fetch("/api/dealer/logo", {
   300→        method: "POST",
   301→        body: formData,
   302→      });
   303→
   304→      const contentType = uploadRes.headers.get("content-type") || "";
   305→      if (!contentType.includes("application/json")) {
   306→        if (process.env.NODE_ENV !== "production") {
   307→          console.error("[Logo Upload] Non-JSON response:", uploadRes.status);
   308→        }
   309→        throw new Error("Server error (LOGO_UPLOAD_SERVER_ERROR)");
   310→      }
   311→
   312→      const uploadData = await uploadRes.json();
   313→
   314→      if (!uploadRes.ok) {
   315→        const errorMsg = uploadData.error || "Upload failed";
   316→        const errorCode = uploadData.code || "UNKNOWN";
   317→        if (process.env.NODE_ENV !== "production") {
   318→          console.error("[Logo Upload] Error:", errorCode, errorMsg, uploadData.details);
   319→        }
   320→        throw new Error(`${errorMsg} (${errorCode})`);
   321→      }
   322→
   323→      // Dealer logo endpoint updates dealer record automatically
   324→      // Refresh dealer to get the updated logoUrl
   325→      const dealerRes = await fetch("/api/dealer");
   326→      if (!dealerRes.ok) throw new Error("Failed to refresh dealer profile");
   327→      const updatedDealer = await dealerRes.json();
   328→      setDealer(updatedDealer);
   329→      toast.success("Logo uploaded");
   330→    } catch (error) {
   331→      if (process.env.NODE_ENV !== "production") {
   332→        console.error("[Logo Upload] Exception:", error);
   333→      }
   334→      toast.error(error.message || "Failed to upload logo");
   335→    } finally {
   336→      setIsUploadingLogo(false);
   337→    }
   338→  };
   339→
   340→  const removeLogo = async () => {
   341→    try {
   342→      const res = await fetch("/api/dealer", {
   343→        method: "PUT",
   344→        headers: { "Content-Type": "application/json" },
   345→        body: JSON.stringify({ logoUrl: "", logoKey: "" }),
   346→      });
   347→      if (!res.ok) throw new Error("Failed to remove logo");
   348→      const updatedDealer = await res.json();
   349→      setDealer(updatedDealer);
   350→      toast.success("Logo removed");
   351→    } catch (error) {
   352→      toast.error("Failed to remove logo");
   353→    }
   354→  };
   355→
   356→  const saveDealer = async (e) => {
   357→    e.preventDefault();
   358→    setIsSavingDealer(true);
   359→    try {
   360→      const res = await fetch("/api/dealer", {
   361→        method: "PUT",
   362→        headers: { "Content-Type": "application/json" },
   363→        body: JSON.stringify(dealerForm),
   364→      });
   365→      if (!res.ok) throw new Error("Failed to save");
   366→      const updatedDealer = await res.json();
   367→      setDealer(updatedDealer);
   368→      toast.success("Profile saved");
   369→    } catch (error) {
   370→      toast.error("Failed to save profile");
   371→    } finally {
   372→      setIsSavingDealer(false);
   373→    }
   374→  };
   375→
   376→  const saveSalesSettings = async (e) => {
   377→    e.preventDefault();
   378→    setIsSavingSales(true);
   379→    try {
   380→      const payload = {
   381→        salesSettings: {
   382→          invoiceNumberPrefix: salesSettings.invoiceNumberPrefix,
   383→          nextInvoiceNumber: parseInt(salesSettings.nextInvoiceNumber) || 1,
   384→          depositReceiptPrefix: salesSettings.depositReceiptPrefix,
   385→          nextDepositReceiptNumber: parseInt(salesSettings.nextDepositReceiptNumber) || 1,
   386→          vatRate: (parseFloat(salesSettings.vatRate) || 20) / 100, // Convert from percentage
   387→          defaultVatScheme: salesSettings.defaultVatScheme,
   388→          vatNumber: salesSettings.vatNumber,
   389→          vatRegistered: salesSettings.vatRegistered,
   390→          companyNumber: salesSettings.companyNumber,
   391→          bankDetails: salesSettings.bankDetails,
   392→          terms: salesSettings.terms,
   393→        },
   394→      };
   395→
   396→      const res = await fetch("/api/dealer", {
   397→        method: "PUT",
   398→        headers: { "Content-Type": "application/json" },
   399→        body: JSON.stringify(payload),
   400→      });
   401→
   402→      if (!res.ok) throw new Error("Failed to save");
   403→      const updatedDealer = await res.json();
   404→      setDealer(updatedDealer);
   405→      toast.success("Sales settings saved");
   406→    } catch (error) {
   407→      toast.error("Failed to save sales settings");
   408→    } finally {
   409→      setIsSavingSales(false);
   410→    }
   411→  };
   412→
   413→  const addLocation = async (e) => {
   414→    e.preventDefault();
   415→    if (!newLocation.trim()) return toast.error("Location name required");
   416→    try {
   417→      await fetch("/api/locations", {
   418→        method: "POST",
   419→        headers: { "Content-Type": "application/json" },
   420→        body: JSON.stringify({ name: newLocation }),
   421→      });
   422→      setNewLocation("");
   423→      fetchLocations();
   424→      toast.success("Location added");
   425→    } catch (error) {
   426→      toast.error("Failed to add location");
   427→    }
   428→  };
   429→
   430→  const deleteLocation = async (locationId) => {
   431→    if (!confirm("Delete this location?")) return;
   432→    try {
   433→      await fetch(`/api/locations/${locationId}`, { method: "DELETE" });
   434→      fetchLocations();
   435→      toast.success("Location deleted");
   436→    } catch (error) {
   437→      toast.error("Failed to delete location");
   438→    }
   439→  };
   440→
   441→  const addPrepTask = async (e) => {
   442→    e.preventDefault();
   443→    if (!newPrepTask.trim()) return toast.error("Task name required");
   444→    try {
   445→      await fetch("/api/prep-tasks", {
   446→        method: "POST",
   447→        headers: { "Content-Type": "application/json" },
   448→        body: JSON.stringify({ name: newPrepTask }),
   449→      });
   450→      setNewPrepTask("");
   451→      fetchPrepTasks();
   452→      toast.success("Task added");
   453→    } catch (error) {
   454→      toast.error("Failed to add task");
   455→    }
   456→  };
   457→
   458→  const deletePrepTask = async (taskId) => {
   459→    if (!confirm("Delete this task from template?")) return;
   460→    try {
   461→      await fetch(`/api/prep-tasks/${taskId}`, { method: "DELETE" });
   462→      fetchPrepTasks();
   463→      toast.success("Task deleted");
   464→    } catch (error) {
   465→      toast.error("Failed to delete task");
   466→    }
   467→  };
   468→
   469→  const reorderPrepTask = async (taskId, direction) => {
   470→    try {
   471→      await fetch(`/api/prep-tasks/${taskId}/reorder`, {
   472→        method: "POST",
   473→        headers: { "Content-Type": "application/json" },
   474→        body: JSON.stringify({ direction }),
   475→      });
   476→      fetchPrepTasks();
   477→    } catch (error) {
   478→      toast.error("Failed to reorder task");
   479→    }
   480→  };
   481→
   482→  const resetPrepTasksToDefaults = async () => {
   483→    if (!confirm("Reset prep checklist to defaults? This will replace all current tasks.")) return;
   484→    try {
   485→      const res = await fetch("/api/prep-tasks", {
   486→        method: "POST",
   487→        headers: { "Content-Type": "application/json" },
   488→        body: JSON.stringify({ resetToDefaults: true }),
   489→      });
   490→      const data = await res.json();
   491→      setPrepTasks(data);
   492→      toast.success("Reset to defaults");
   493→    } catch (error) {
   494→      toast.error("Failed to reset");
   495→    }
   496→  };
   497→
   498→  // Show loading while checking for dealer redirect
   499→  if (isRedirecting) {
   500→    return (
   501→      <div className="min-h-screen flex items-center justify-center bg-slate-50">
   502→        <div className="flex flex-col items-center gap-4">
   503→          <div className="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin" />
   504→          <p className="text-sm text-slate-500 font-medium">Loading...</p>
   505→        </div>
   506→      </div>
   507→    );
   508→  }
   509→
   510→  return (
   511→    <DashboardLayout>
   512→      <Head><title>Settings | DealerHQ</title></Head>
   513→
   514→      <div className="mb-8">
   515→        <h1 className="text-3xl font-bold">Settings</h1>
   516→        <p className="text-base-content/60 mt-2">Configure your dealership</p>
   517→      </div>
   518→
   519→      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
   520→        {/* Appearance Card */}
   521→        <div className="card bg-base-200">
   522→          <div className="card-body">
   523→            <h2 className="card-title">Appearance</h2>
   524→            <p className="text-sm text-base-content/60">Customize how DealerHQ looks</p>
   525→
   526→            <div className="form-control mt-4">
   527→              <label className="label"><span className="label-text">Theme</span></label>
   528→              <div className="flex gap-2">
   529→                <button
   530→                  className={`btn btn-sm flex-1 ${theme === "light" ? "btn-primary" : "btn-outline"}`}
   531→                  onClick={() => handleThemeChange("light")}
   532→                >
   533→                  <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
   534→                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
   535→                  </svg>
   536→                  Light
   537→                </button>
   538→                <button
   539→                  className={`btn btn-sm flex-1 ${theme === "dark" ? "btn-primary" : "btn-outline"}`}
   540→                  onClick={() => handleThemeChange("dark")}
   541→                >
   542→                  <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
   543→                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
   544→                  </svg>
   545→                  Dark
   546→                </button>
   547→                <button
   548→                  className={`btn btn-sm flex-1 ${theme === "system" ? "btn-primary" : "btn-outline"}`}
   549→                  onClick={() => handleThemeChange("system")}
   550→                >
   551→                  <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
   552→                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
   553→                  </svg>
   554→                  System
   555→                </button>
   556→              </div>
   557→              <label className="label">
   558→                <span className="label-text-alt text-base-content/50">System follows your device preference</span>
   559→              </label>
   560→            </div>
   561→          </div>
   562→        </div>
   563→
   564→        {/* Form Templates Card */}
   565→        <div className="card bg-base-200">
   566→          <div className="card-body">
   567→            <h2 className="card-title">Form Templates</h2>
   568→            <p className="text-sm text-base-content/60">Customize form fields for PDI, Appraisals, Delivery checklists, and more</p>
   569→            <div className="mt-4">
   570→              <Link href="/settings/forms" className="btn btn-primary">
   571→                Manage Form Templates
   572→              </Link>
   573→            </div>
   574→          </div>
   575→        </div>
   576→
   577→        {/* Team Management Card */}
   578→        <div className="card bg-base-200">
   579→          <div className="card-body">
   580→            <h2 className="card-title">Team Members</h2>
   581→            <p className="text-sm text-base-content/60">Invite team members, manage roles, and access permissions</p>
   582→            <div className="mt-4">
   583→              <Link href="/settings/team" className="btn btn-primary">
   584→                Manage Team
   585→              </Link>
   586→            </div>
   587→          </div>
   588→        </div>
   589→
   590→        {/* Setup Wizard Card */}
   591→        <div className="card bg-base-200">
   592→          <div className="card-body">
   593→            <h2 className="card-title">Setup Wizard</h2>
   594→            <p className="text-sm text-base-content/60">Re-run the initial setup to reconfigure your workflow templates and defaults</p>
   595→            <div className="mt-4">
   596→              <Link
   597→                href="/onboarding"
   598→                className="btn btn-outline"
   599→                onClick={async (e) => {
   600→                  e.preventDefault();
   601→                  // Reset onboarding flag so we can re-run
   602→                  await fetch("/api/dealer", {
   603→                    method: "PUT",
   604→                    headers: { "Content-Type": "application/json" },
   605→                    body: JSON.stringify({ completedOnboarding: false }),
   606→                  });
   607→                  window.location.href = "/onboarding";
   608→                }}
   609→              >
   610→                <svg className="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   611→                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
   612→                </svg>
   613→                Re-run Setup Wizard
   614→              </Link>
   615→            </div>
   616→          </div>
   617→        </div>
   618→
   619→        {/* Dealer Branding */}
   620→        <div className="card bg-base-200">
   621→          <div className="card-body">
   622→            <h2 className="card-title">Dealer Branding</h2>
   623→            <p className="text-sm text-base-content/60">Your logo appears in the sidebar and on public forms</p>
   624→
   625→            {/* Logo Upload */}
   626→            <div className="mt-4">
   627→              <label className="label"><span className="label-text">Dealership Logo</span></label>
   628→              <div className="flex items-center gap-4">
   629→                {dealer?.logoUrl ? (
   630→                  <div className="relative">
   631→                    <img
   632→                      src={dealer.logoUrl}
   633→                      alt="Dealer Logo"
   634→                      className="w-24 h-24 object-contain bg-white rounded-lg border border-base-300 p-2"
   635→                    />
   636→                    <button
   637→                      onClick={removeLogo}
   638→                      className="absolute -top-2 -right-2 btn btn-circle btn-xs btn-error"
   639→                    >
   640→                      ✕
   641→                    </button>
   642→                  </div>
   643→                ) : (
   644→                  <div className="w-24 h-24 bg-base-300 rounded-lg flex items-center justify-center text-base-content/40 text-xs">
   645→                    No logo
   646→                  </div>
   647→                )}
   648→                <div className="flex flex-col gap-2">
   649→                  <label className="btn btn-sm btn-outline">
   650→                    {isUploadingLogo ? (
   651→                      <span className="loading loading-spinner loading-sm"></span>
   652→                    ) : (
   653→                      <>Upload Logo</>
   654→                    )}
   655→                    <input
   656→                      type="file"
   657→                      accept="image/png,image/jpeg,image/svg+xml"
   658→                      onChange={handleLogoUpload}
   659→                      className="hidden"
   660→                      disabled={isUploadingLogo}
   661→                    />
   662→                  </label>
   663→                  <span className="text-xs text-base-content/50">PNG, JPG, SVG (max 2MB)</span>
   664→                </div>
   665→              </div>
   666→            </div>
   667→          </div>
   668→        </div>
   669→
   670→        {/* Dealer Profile */}
   671→        <div className="card bg-base-200 lg:col-span-2">
   672→          <div className="card-body">
   673→            <h2 className="card-title">Business Details</h2>
   674→            <p className="text-sm text-base-content/60">Used on forms, invoices, and public pages</p>
   675→            <form onSubmit={saveDealer}>
   676→              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
   677→                <div className="form-control">
   678→                  <label className="label"><span className="label-text">Display Name</span></label>
   679→                  <input
   680→                    type="text"
   681→                    className="input input-bordered"
   682→                    placeholder="My Dealership"
   683→                    value={dealerForm.name}
   684→                    onChange={(e) => setDealerForm({ ...dealerForm, name: e.target.value })}
   685→                  />
   686→                  <label className="label"><span className="label-text-alt text-base-content/50">Shown in sidebar & dashboard</span></label>
   687→                </div>
   688→                <div className="form-control">
   689→                  <label className="label"><span className="label-text">Legal Company Name</span></label>
   690→                  <input
   691→                    type="text"
   692→                    className="input input-bordered"
   693→                    placeholder="My New Motor LTD"
   694→                    value={dealerForm.companyName}
   695→                    onChange={(e) => setDealerForm({ ...dealerForm, companyName: e.target.value })}
   696→                  />
   697→                  <label className="label"><span className="label-text-alt text-base-content/50">Used in T&Cs and legal text on forms</span></label>
   698→                </div>
   699→                <div className="form-control md:col-span-2">
   700→                  <label className="label"><span className="label-text">Company Address</span></label>
   701→                  <textarea
   702→                    className="textarea textarea-bordered"
   703→                    placeholder="123 High Street&#10;London&#10;SW1A 1AA"
   704→                    rows={3}
   705→                    value={dealerForm.companyAddress}
   706→                    onChange={(e) => setDealerForm({ ...dealerForm, companyAddress: e.target.value })}
   707→                  />
   708→                </div>
   709→                <div className="form-control">
   710→                  <label className="label"><span className="label-text">Contact Phone</span></label>
   711→                  <input
   712→                    type="tel"
   713→                    className="input input-bordered"
   714→                    placeholder="01onal761 569871"
   715→                    value={dealerForm.companyPhone}
   716→                    onChange={(e) => setDealerForm({ ...dealerForm, companyPhone: e.target.value })}
   717→                  />
   718→                </div>
   719→                <div className="form-control">
   720→                  <label className="label"><span className="label-text">Contact Email</span></label>
   721→                  <input
   722→                    type="email"
   723→                    className="input input-bordered"
   724→                    placeholder="info@mydealership.com"
   725→                    value={dealerForm.companyEmail}
   726→                    onChange={(e) => setDealerForm({ ...dealerForm, companyEmail: e.target.value })}
   727→                  />
   728→                </div>
   729→                <div className="form-control">
   730→                  <label className="label"><span className="label-text">Public Forms URL Slug</span></label>
   731→                  <div className="join">
   732→                    <span className="join-item btn btn-disabled text-xs">/px/</span>
   733→                    <input
   734→                      type="text"
   735→                      className="input input-bordered join-item flex-1"
   736→                      placeholder="my-dealership"
   737→                      value={dealerForm.slug}
   738→                      onChange={(e) => setDealerForm({ ...dealerForm, slug: e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, '') })}
   739→                    />
   740→                  </div>
   741→                  <label className="label"><span className="label-text-alt text-base-content/50">Used for public form links</span></label>
   742→                </div>
   743→                <div className="form-control">
   744→                  <label className="label"><span className="label-text">Google Review URL</span></label>
   745→                  <input
   746→                    type="url"
   747→                    className="input input-bordered"
   748→                    placeholder="https://g.page/..."
   749→                    value={dealerForm.googleReviewUrl}
   750→                    onChange={(e) => setDealerForm({ ...dealerForm, googleReviewUrl: e.target.value })}
   751→                  />
   752→                </div>
   753→              </div>
   754→              <button type="submit" className="btn btn-primary mt-6" disabled={isSavingDealer}>
   755→                {isSavingDealer ? <span className="loading loading-spinner loading-sm"></span> : "Save Business Details"}
   756→              </button>
   757→            </form>
   758→          </div>
   759→        </div>
   760→
   761→        {/* Sales Settings */}
   762→        <div className="card bg-base-200 lg:col-span-2">
   763→          <div className="card-body">
   764→            <h2 className="card-title">Sales Settings</h2>
   765→            <p className="text-sm text-base-content/60">Configure invoicing, VAT, and document settings</p>
   766→            <form onSubmit={saveSalesSettings}>
   767→              {/* Document Numbering */}
   768→              <div className="mt-4">
   769→                <h3 className="font-semibold text-sm mb-3">Document Numbering</h3>
   770→                <p className="text-xs text-base-content/50 mb-4">Numbers auto-increment with each document. Only prefixes are editable.</p>
   771→                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
   772→                  <div className="form-control">
   773→                    <label className="label"><span className="label-text">Invoice Prefix</span></label>
   774→                    <input
   775→                      type="text"
   776→                      className="input input-bordered"
   777→                      placeholder="INV"
   778→                      value={salesSettings.invoiceNumberPrefix}
   779→                      onChange={(e) => setSalesSettings({ ...salesSettings, invoiceNumberPrefix: e.target.value })}
   780→                    />
   781→                  </div>
   782→                  <div className="form-control">
   783→                    <label className="label"><span className="label-text">Next Invoice Number</span></label>
   784→                    <div className="input input-bordered bg-base-300 flex items-center text-base-content/70 cursor-not-allowed">
   785→                      <span className="font-mono">{salesSettings.invoiceNumberPrefix}{salesSettings.nextInvoiceNumber}</span>
   786→                    </div>
   787→                    <label className="label"><span className="label-text-alt text-base-content/50">Auto-increments with each invoice</span></label>
   788→                  </div>
   789→                  <div className="form-control">
   790→                    <label className="label"><span className="label-text">Deposit Receipt Prefix</span></label>
   791→                    <input
   792→                      type="text"
   793→                      className="input input-bordered"
   794→                      placeholder="DEP"
   795→                      value={salesSettings.depositReceiptPrefix}
   796→                      onChange={(e) => setSalesSettings({ ...salesSettings, depositReceiptPrefix: e.target.value })}
   797→                    />
   798→                  </div>
   799→                  <div className="form-control">
   800→                    <label className="label"><span className="label-text">Next Receipt Number</span></label>
   801→                    <div className="input input-bordered bg-base-300 flex items-center text-base-content/70 cursor-not-allowed">
   802→                      <span className="font-mono">{salesSettings.depositReceiptPrefix}{salesSettings.nextDepositReceiptNumber}</span>
   803→                    </div>
   804→                    <label className="label"><span className="label-text-alt text-base-content/50">Auto-increments with each deposit</span></label>
   805→                  </div>
   806→                </div>
   807→              </div>
   808→
   809→              {/* VAT Settings */}
   810→              <div className="mt-6 pt-6 border-t border-base-300">
   811→                <h3 className="font-semibold text-sm mb-3">VAT Settings</h3>
   812→                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
   813→                  <div className="form-control">
   814→                    <label className="label cursor-pointer justify-start gap-3">
   815→                      <input
   816→                        type="checkbox"
   817→                        className="checkbox checkbox-primary"
   818→                        checked={salesSettings.vatRegistered}
   819→                        onChange={(e) => setSalesSettings({ ...salesSettings, vatRegistered: e.target.checked })}
   820→                      />
   821→                      <span className="label-text">VAT Registered</span>
   822→                    </label>
   823→                  </div>
   824→                  <div className="form-control">
   825→                    <label className="label"><span className="label-text">VAT Number</span></label>
   826→                    <input
   827→                      type="text"
   828→                      className="input input-bordered"
   829→                      placeholder="GB123456789"
   830→                      value={salesSettings.vatNumber}
   831→                      onChange={(e) => setSalesSettings({ ...salesSettings, vatNumber: e.target.value })}
   832→                      disabled={!salesSettings.vatRegistered}
   833→                    />
   834→                  </div>
   835→                  <div className="form-control">
   836→                    <label className="label"><span className="label-text">Company Registration Number</span></label>
   837→                    <input
   838→                      type="text"
   839→                      className="input input-bordered"
   840→                      placeholder="12345678"
   841→                      value={salesSettings.companyNumber}
   842→                      onChange={(e) => setSalesSettings({ ...salesSettings, companyNumber: e.target.value })}
   843→                    />
   844→                  </div>
   845→                  <div className="form-control">
   846→                    <label className="label"><span className="label-text">Default VAT Rate (%)</span></label>
   847→                    <input
   848→                      type="number"
   849→                      className="input input-bordered"
   850→                      min="0"
   851→                      max="100"
   852→                      step="0.1"
   853→                      value={salesSettings.vatRate}
   854→                      onChange={(e) => setSalesSettings({ ...salesSettings, vatRate: e.target.value })}
   855→                    />
   856→                  </div>
   857→                  <div className="form-control">
   858→                    <label className="label"><span className="label-text">Default VAT Scheme</span></label>
   859→                    <select
   860→                      className="select select-bordered"
   861→                      value={salesSettings.defaultVatScheme}
   862→                      onChange={(e) => setSalesSettings({ ...salesSettings, defaultVatScheme: e.target.value })}
   863→                    >
   864→                      <option value="MARGIN">Margin Scheme</option>
   865→                      <option value="VAT_QUALIFYING">VAT Qualifying</option>
   866→                      <option value="NO_VAT">No VAT</option>
   867→                    </select>
   868→                    <label className="label"><span className="label-text-alt text-base-content/50">Applied to new vehicles</span></label>
   869→                  </div>
   870→                </div>
   871→              </div>
   872→
   873→              {/* Bank Details */}
   874→              <div className="mt-6 pt-6 border-t border-base-300">
   875→                <h3 className="font-semibold text-sm mb-3">Bank Details (for invoices)</h3>
   876→                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
   877→                  <div className="form-control">
   878→                    <label className="label"><span className="label-text">Account Name</span></label>
   879→                    <input
   880→                      type="text"
   881→                      className="input input-bordered"
   882→                      placeholder="My Dealership Ltd"
   883→                      value={salesSettings.bankDetails.accountName}
   884→                      onChange={(e) => setSalesSettings({
   885→                        ...salesSettings,
   886→                        bankDetails: { ...salesSettings.bankDetails, accountName: e.target.value }
   887→                      })}
   888→                    />
   889→                  </div>
   890→                  <div className="form-control">
   891→                    <label className="label"><span className="label-text">Sort Code</span></label>
   892→                    <input
   893→                      type="text"
   894→                      className="input input-bordered"
   895→                      placeholder="12-34-56"
   896→                      value={salesSettings.bankDetails.sortCode}
   897→                      onChange={(e) => setSalesSettings({
   898→                        ...salesSettings,
   899→                        bankDetails: { ...salesSettings.bankDetails, sortCode: e.target.value }
   900→                      })}
   901→                    />
   902→                  </div>
   903→                  <div className="form-control">
   904→                    <label className="label"><span className="label-text">Account Number</span></label>
   905→                    <input
   906→                      type="text"
   907→                      className="input input-bordered"
   908→                      placeholder="12345678"
   909→                      value={salesSettings.bankDetails.accountNumber}
   910→                      onChange={(e) => setSalesSettings({
   911→                        ...salesSettings,
   912→                        bankDetails: { ...salesSettings.bankDetails, accountNumber: e.target.value }
   913→                      })}
   914→                    />
   915→                  </div>
   916→                </div>
   917→              </div>
   918→
   919→              {/* Terms Templates */}
   920→              <div className="mt-6 pt-6 border-t border-base-300">
   921→                <h3 className="font-semibold text-sm mb-3">Terms & Conditions Templates</h3>
   922→                <p className="text-xs text-base-content/50 mb-4">These appear on invoices and deposit receipts</p>
   923→
   924→                <div className="tabs tabs-boxed mb-4">
   925→                  <button
   926→                    type="button"
   927→                    className={`tab ${activeTermsTab === "consumerInPerson" ? "tab-active" : ""}`}
   928→                    onClick={() => setActiveTermsTab("consumerInPerson")}
   929→                  >
   930→                    B2C In-Person
   931→                  </button>
   932→                  <button
   933→                    type="button"
   934→                    className={`tab ${activeTermsTab === "consumerDistance" ? "tab-active" : ""}`}
   935→                    onClick={() => setActiveTermsTab("consumerDistance")}
   936→                  >
   937→                    B2C Distance
   938→                  </button>
   939→                  <button
   940→                    type="button"
   941→                    className={`tab ${activeTermsTab === "businessInPerson" ? "tab-active" : ""}`}
   942→                    onClick={() => setActiveTermsTab("businessInPerson")}
   943→                  >
   944→                    B2B In-Person
   945→                  </button>
   946→                  <button
   947→                    type="button"
   948→                    className={`tab ${activeTermsTab === "businessDistance" ? "tab-active" : ""}`}
   949→                    onClick={() => setActiveTermsTab("businessDistance")}
   950→                  >
   951→                    B2B Distance
   952→                  </button>
   953→                </div>
   954→
   955→                {activeTermsTab === "consumerInPerson" && (
   956→                  <div className="form-control">
   957→                    <textarea
   958→                      className="textarea textarea-bordered min-h-[150px]"
   959→                      placeholder="Enter terms for consumer in-person sales..."
   960→                      value={salesSettings.terms.consumerInPerson}
   961→                      onChange={(e) => setSalesSettings({
   962→                        ...salesSettings,
   963→                        terms: { ...salesSettings.terms, consumerInPerson: e.target.value }
   964→                      })}
   965→                    />
   966→                    <label className="label"><span className="label-text-alt text-base-content/50">Used when customer purchases in person at your premises</span></label>
   967→                  </div>
   968→                )}
   969→                {activeTermsTab === "consumerDistance" && (
   970→                  <div className="form-control">
   971→                    <textarea
   972→                      className="textarea textarea-bordered min-h-[150px]"
   973→                      placeholder="Enter terms for consumer distance sales (includes 14-day cooling off period)..."
   974→                      value={salesSettings.terms.consumerDistance}
   975→                      onChange={(e) => setSalesSettings({
   976→                        ...salesSettings,
   977→                        terms: { ...salesSettings.terms, consumerDistance: e.target.value }
   978→                      })}
   979→                    />
   980→                    <label className="label"><span className="label-text-alt text-base-content/50">Used for online/phone sales to consumers (14-day right to cancel applies)</span></label>
   981→                  </div>
   982→                )}
   983→                {activeTermsTab === "businessInPerson" && (
   984→                  <div className="form-control">
   985→                    <textarea
   986→                      className="textarea textarea-bordered min-h-[150px]"
   987→                      placeholder="Enter terms for business-to-business in-person sales..."
   988→                      value={salesSettings.terms.businessInPerson}
   989→                      onChange={(e) => setSalesSettings({
   990→                        ...salesSettings,
   991→                        terms: { ...salesSettings.terms, businessInPerson: e.target.value }
   992→                      })}
   993→                    />
   994→                    <label className="label"><span className="label-text-alt text-base-content/50">Used when selling to businesses in person</span></label>
   995→                  </div>
   996→                )}
   997→                {activeTermsTab === "businessDistance" && (
   998→                  <div className="form-control">
   999→                    <textarea
  1000→                      className="textarea textarea-bordered min-h-[150px]"
  1001→                      placeholder="Enter terms for business-to-business distance sales..."
  1002→                      value={salesSettings.terms.businessDistance}
  1003→                      onChange={(e) => setSalesSettings({
  1004→                        ...salesSettings,
  1005→                        terms: { ...salesSettings.terms, businessDistance: e.target.value }
  1006→                      })}
  1007→                    />
  1008→                    <label className="label"><span className="label-text-alt text-base-content/50">Used for online/phone sales to businesses</span></label>
  1009→                  </div>
  1010→                )}
  1011→              </div>
  1012→
  1013→              <button type="submit" className="btn btn-primary mt-6" disabled={isSavingSales}>
  1014→                {isSavingSales ? <span className="loading loading-spinner loading-sm"></span> : "Save Sales Settings"}
  1015→              </button>
  1016→            </form>
  1017→          </div>
  1018→        </div>
  1019→
  1020→        {/* Custom Vehicle Labels */}
  1021→        <div className="card bg-base-200">
  1022→          <div className="card-body">
  1023→            <h2 className="card-title">Custom Vehicle Labels</h2>
  1024→            <p className="text-sm text-base-content/60">Create labels to tag vehicle cards (e.g. "MOT Expired", "High Priority", "Manager Special")</p>
  1025→
  1026→            <div className="space-y-2 mt-4">
  1027→              {labels.length === 0 ? (
  1028→                <p className="text-sm text-base-content/50 text-center py-4">No labels created yet</p>
  1029→              ) : (
  1030→                labels.map((label) => (
  1031→                  <div key={label.id} className="flex items-center gap-2 p-2 bg-base-100 rounded group">
  1032→                    <div className="w-4 h-4 rounded" style={{ backgroundColor: label.colour }}></div>
  1033→                    <span className="flex-1">{label.name}</span>
  1034→                    <button
  1035→                      className="btn btn-xs btn-error btn-ghost opacity-0 group-hover:opacity-100 transition-opacity"
  1036→                      onClick={() => deleteLabel(label.id)}
  1037→                    >
  1038→                      ✕
  1039→                    </button>
  1040→                  </div>
  1041→                ))
  1042→              )}
  1043→            </div>
  1044→
  1045→            <form onSubmit={addLabel} className="flex gap-2 mt-4">
  1046→              <input type="text" className="input input-bordered input-sm flex-1" placeholder="Label name"
  1047→                value={newLabel.name} onChange={(e) => setNewLabel({ ...newLabel, name: e.target.value })} />
  1048→              <input type="color" className="w-10 h-10 rounded cursor-pointer"
  1049→                value={newLabel.colour} onChange={(e) => setNewLabel({ ...newLabel, colour: e.target.value })} />
  1050→              <button type="submit" className="btn btn-primary btn-sm">Add</button>
  1051→            </form>
  1052→          </div>
  1053→        </div>
  1054→
  1055→        {/* Calendar Categories */}
  1056→        <div className="card bg-base-200">
  1057→          <div className="card-body">
  1058→            <h2 className="card-title">Calendar Categories</h2>
  1059→            <p className="text-sm text-base-content/60">Event types for calendar (e.g. "Handover", "Test Drive")</p>
  1060→            
  1061→            <div className="space-y-2 mt-4">
  1062→              {Array.isArray(categories) && categories.length > 0 ? (
  1063→                categories.map((cat) => (
  1064→                  <div key={cat.id} className="flex items-center gap-2 p-2 bg-base-100 rounded">
  1065→                    <div className="w-4 h-4 rounded" style={{ backgroundColor: cat.colour }}></div>
  1066→                    <span className="flex-1">{cat.name}</span>
  1067→                  </div>
  1068→                ))
  1069→              ) : (
  1070→                <p className="text-sm text-base-content/50 italic">No categories yet</p>
  1071→              )}
  1072→            </div>
  1073→
  1074→            <form onSubmit={addCategory} className="flex gap-2 mt-4">
  1075→              <input type="text" className="input input-bordered input-sm flex-1" placeholder="Category name"
  1076→                value={newCategory.name} onChange={(e) => setNewCategory({ ...newCategory, name: e.target.value })} />
  1077→              <input type="color" className="w-10 h-10 rounded cursor-pointer"
  1078→                value={newCategory.colour} onChange={(e) => setNewCategory({ ...newCategory, colour: e.target.value })} />
  1079→              <button type="submit" className="btn btn-primary btn-sm">Add</button>
  1080→            </form>
  1081→          </div>
  1082→        </div>
  1083→
  1084→        {/* Integrations */}
  1085→        <div className="card bg-base-200">
  1086→          <div className="card-body">
  1087→            <h2 className="card-title">Integrations</h2>
  1088→            <p className="text-sm text-base-content/60">Configure external services</p>
  1089→            
  1090→            <div className="space-y-4 mt-4">
  1091→              <div className="p-3 bg-base-100 rounded-lg">
  1092→                <div className="flex items-center justify-between">
  1093→                  <div>
  1094→                    <p className="font-semibold">DVLA API</p>
  1095→                    <p className="text-xs text-base-content/60">Vehicle lookup service</p>
  1096→                  </div>
  1097→                  {integrationStatus.dvla === null ? (
  1098→                    <span className="loading loading-spinner loading-xs"></span>
  1099→                  ) : integrationStatus.dvla ? (
  1100→                    <span className="badge badge-success">Configured</span>
  1101→                  ) : (
  1102→                    <span className="badge badge-warning">Not configured</span>
  1103→                  )}
  1104→                </div>
  1105→              </div>
  1106→
  1107→              <div className="p-3 bg-base-100 rounded-lg">
  1108→                <div className="flex items-center justify-between">
  1109→                  <div>
  1110→                    <p className="font-semibold">AI Features (OpenAI)</p>
  1111→                    <p className="text-xs text-base-content/60">Vehicle condition suggestions</p>
  1112→                  </div>
  1113→                  {integrationStatus.openai === null ? (
  1114→                    <span className="loading loading-spinner loading-xs"></span>
  1115→                  ) : integrationStatus.openai ? (
  1116→                    <span className="badge badge-success">Configured</span>
  1117→                  ) : (
  1118→                    <span className="badge badge-warning">Not configured</span>
  1119→                  )}
  1120→                </div>
  1121→              </div>
  1122→
  1123→              <div className="p-3 bg-base-100 rounded-lg">
  1124→                <div className="flex items-center justify-between">
  1125→                  <div>
  1126→                    <p className="font-semibold">Email (SendGrid/Resend)</p>
  1127→                    <p className="text-xs text-base-content/60">Review requests & notifications</p>
  1128→                  </div>
  1129→                  <span className="badge badge-ghost">Server configured</span>
  1130→                </div>
  1131→              </div>
  1132→
  1133→              <div className="p-3 bg-base-100 rounded-lg">
  1134→                <div className="flex items-center justify-between">
  1135→                  <div>
  1136→                    <p className="font-semibold">SMS (Twilio)</p>
  1137→                    <p className="text-xs text-base-content/60">Review requests via SMS</p>
  1138→                  </div>
  1139→                  <span className="badge badge-ghost">Server configured</span>
  1140→                </div>
  1141→              </div>
  1142→            </div>
  1143→          </div>
  1144→        </div>
  1145→
  1146→        {/* Offsite Locations */}
  1147→        <div className="card bg-base-200">
  1148→          <div className="card-body">
  1149→            <h2 className="card-title">Offsite Locations</h2>
  1150→            <p className="text-sm text-base-content/60">Manage offsite location names (e.g., "MOT Centre", "Paint Shop")</p>
  1151→
  1152→            <div className="space-y-2 mt-4">
  1153→              {locations.length === 0 ? (
  1154→                <p className="text-sm text-base-content/50 text-center py-4">No locations added yet</p>
  1155→              ) : (
  1156→                locations.map((location) => (
  1157→                  <div key={location.id} className="flex items-center justify-between p-2 bg-base-100 rounded">
  1158→                    <span>{location.name}</span>
  1159→                    <button
  1160→                      className="btn btn-xs btn-error btn-ghost"
  1161→                      onClick={() => deleteLocation(location.id)}
  1162→                    >
  1163→                      Delete
  1164→                    </button>
  1165→                  </div>
  1166→                ))
  1167→              )}
  1168→            </div>
  1169→
  1170→            <form onSubmit={addLocation} className="flex gap-2 mt-4">
  1171→              <input
  1172→                type="text"
  1173→                className="input input-bordered input-sm flex-1"
  1174→                placeholder="Location name (e.g., A1 MOT Centre)"
  1175→                value={newLocation}
  1176→                onChange={(e) => setNewLocation(e.target.value)}
  1177→              />
  1178→              <button type="submit" className="btn btn-primary btn-sm">Add</button>
  1179→            </form>
  1180→          </div>
  1181→        </div>
  1182→
  1183→        {/* Prep Checklist Template */}
  1184→        <div className="card bg-base-200">
  1185→          <div className="card-body">
  1186→            <div className="flex items-center justify-between">
  1187→              <div>
  1188→                <h2 className="card-title">Prep Checklist Template</h2>
  1189→                <p className="text-sm text-base-content/60">Default tasks auto-created for new vehicles</p>
  1190→              </div>
  1191→              <button
  1192→                className="btn btn-ghost btn-xs"
  1193→                onClick={resetPrepTasksToDefaults}
  1194→              >
  1195→                Reset to Defaults
  1196→              </button>
  1197→            </div>
  1198→
  1199→            <div className="space-y-2 mt-4">
  1200→              {prepTasks.length === 0 ? (
  1201→                <p className="text-sm text-base-content/50 text-center py-4">Loading tasks...</p>
  1202→              ) : (
  1203→                prepTasks.map((task, idx) => (
  1204→                  <div key={task.id} className="flex items-center gap-2 p-2 bg-base-100 rounded group">
  1205→                    <div className="flex flex-col gap-0.5">
  1206→                      <button
  1207→                        className="btn btn-xs btn-ghost h-4 min-h-0 px-1 text-base-content/40 hover:text-base-content"
  1208→                        onClick={() => reorderPrepTask(task.id, "up")}
  1209→                        disabled={idx === 0}
  1210→                      >
  1211→                        ▲
  1212→                      </button>
  1213→                      <button
  1214→                        className="btn btn-xs btn-ghost h-4 min-h-0 px-1 text-base-content/40 hover:text-base-content"
  1215→                        onClick={() => reorderPrepTask(task.id, "down")}
  1216→                        disabled={idx === prepTasks.length - 1}
  1217→                      >
  1218→                        ▼
  1219→                      </button>
  1220→                    </div>
  1221→                    <span className="badge badge-ghost badge-sm">{idx + 1}</span>
  1222→                    <span className="flex-1 font-medium">{task.name}</span>
  1223→                    <button
  1224→                      className="btn btn-xs btn-error btn-ghost opacity-0 group-hover:opacity-100 transition-opacity"
  1225→                      onClick={() => deletePrepTask(task.id)}
  1226→                    >
  1227→                      ✕
  1228→                    </button>
  1229→                  </div>
  1230→                ))
  1231→              )}
  1232→            </div>
  1233→
  1234→            <form onSubmit={addPrepTask} className="flex gap-2 mt-4">
  1235→              <input
  1236→                type="text"
  1237→                className="input input-bordered input-sm flex-1"
  1238→                placeholder="Add new task (e.g., Oil Service)"
  1239→                value={newPrepTask}
  1240→                onChange={(e) => setNewPrepTask(e.target.value)}
  1241→              />
  1242→              <button type="submit" className="btn btn-primary btn-sm">Add</button>
  1243→            </form>
  1244→          </div>
  1245→        </div>
  1246→
  1247→        {/* Data Management */}
  1248→        <div className="card bg-base-200 lg:col-span-2">
  1249→          <div className="card-body">
  1250→            <h2 className="card-title text-error">Danger Zone</h2>
  1251→            <p className="text-sm text-base-content/60">Data management actions</p>
  1252→            
  1253→            <div className="flex gap-4 mt-4">
  1254→              <button className="btn btn-outline btn-error" onClick={() => showDummyNotification("Data export")}>
  1255→                Export All Data
  1256→              </button>
  1257→              <button className="btn btn-outline btn-error" onClick={() => {
  1258→                if (confirm("This would delete all data. Are you sure?")) {
  1259→                  showDummyNotification("Data deletion");
  1260→                }
  1261→              }}>
  1262→                Delete All Data
  1263→              </button>
  1264→            </div>
  1265→          </div>
  1266→        </div>
  1267→      </div>
  1268→    </DashboardLayout>
  1269→  );
  1270→}
  1271→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
