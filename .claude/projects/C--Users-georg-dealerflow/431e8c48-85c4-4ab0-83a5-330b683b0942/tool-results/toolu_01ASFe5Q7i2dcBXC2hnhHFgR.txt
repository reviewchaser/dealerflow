     1â†’import { useEffect, useState } from "react";
     2â†’import { useRouter } from "next/router";
     3â†’import Head from "next/head";
     4â†’import Link from "next/link";
     5â†’import DashboardLayout from "@/components/DashboardLayout";
     6â†’import { toast } from "react-hot-toast";
     7â†’import { Card, CardHeader, CardContent } from "@/components/ui/Card";
     8â†’import { KeyValue, KeyValueGrid } from "@/components/ui/KeyValue";
     9â†’import { Badge } from "@/components/ui/Badge";
    10â†’import { PhotoGallery } from "@/components/ui/PhotoGallery";
    11â†’
    12â†’// Categories must match AppraisalIssue model schema (lowercase)
    13â†’const ISSUE_CATEGORIES = ["mechanical", "electrical", "bodywork", "interior", "tyres", "mot", "service", "fault_codes", "other"];
    14â†’const ISSUE_SUBCATEGORIES = {
    15â†’  mechanical: ["Engine", "Transmission", "Suspension", "Brakes", "Exhaust", "Other"],
    16â†’  electrical: ["Battery", "Lights", "Starter Motor", "Alternator", "Sensors", "Other"],
    17â†’  bodywork: ["Panel Damage", "Scratches", "Dents", "Bumper", "Windscreen", "Other"],
    18â†’  interior: ["Seats", "Dashboard", "Trim", "Carpet", "Controls", "Other"],
    19â†’  tyres: ["Tread Depth", "Puncture", "Alloys", "Alignment", "Other"],
    20â†’  mot: ["Advisory", "Failed Item", "Due Soon", "Other"],
    21â†’  service: ["Oil Change", "Filters", "Fluids", "Timing Belt", "Other"],
    22â†’  fault_codes: ["Engine", "Transmission", "ABS", "Airbag", "Emissions", "Other"],
    23â†’  other: ["General", "Misc"],
    24â†’};
    25â†’const CATEGORY_LABELS = {
    26â†’  mechanical: "Mechanical",
    27â†’  electrical: "Electrical",
    28â†’  bodywork: "Bodywork",
    29â†’  interior: "Interior",
    30â†’  tyres: "Tyres",
    31â†’  mot: "MOT",
    32â†’  service: "Service",
    33â†’  fault_codes: "Fault Codes",
    34â†’  other: "Other",
    35â†’};
    36â†’
    37â†’export default function AppraisalDetail() {
    38â†’  const router = useRouter();
    39â†’  const { id } = router.query;
    40â†’  const [appraisal, setAppraisal] = useState(null);
    41â†’  const [issues, setIssues] = useState([]);
    42â†’  const [isLoading, setIsLoading] = useState(true);
    43â†’  const [isConverting, setIsConverting] = useState(false);
    44â†’
    45â†’  // Issue modal state
    46â†’  const [showIssueModal, setShowIssueModal] = useState(false);
    47â†’  const [showShareModal, setShowShareModal] = useState(false);
    48â†’  const [shareLink, setShareLink] = useState(null);
    49â†’  const [isGeneratingShare, setIsGeneratingShare] = useState(false);
    50â†’  const [issueForm, setIssueForm] = useState({
    51â†’    category: "mechanical",
    52â†’    subcategory: "Engine",
    53â†’    description: "",
    54â†’    actionNeeded: "",
    55â†’    estimatedCost: "",
    56â†’    notes: "",
    57â†’  });
    58â†’  const [photoFiles, setPhotoFiles] = useState([]);
    59â†’  const [photoPreviews, setPhotoPreviews] = useState([]);
    60â†’  const [isUploadingPhotos, setIsUploadingPhotos] = useState(false);
    61â†’  const [isAddingIssue, setIsAddingIssue] = useState(false);
    62â†’
    63â†’  useEffect(() => {
    64â†’    if (id) {
    65â†’      fetchAppraisal();
    66â†’      fetchIssues();
    67â†’    }
    68â†’  }, [id]);
    69â†’
    70â†’  const fetchAppraisal = async () => {
    71â†’    try {
    72â†’      const res = await fetch(`/api/appraisals/${id}`);
    73â†’      const data = await res.json();
    74â†’      setAppraisal(data);
    75â†’    } catch (error) {
    76â†’      toast.error("Failed to load");
    77â†’    } finally {
    78â†’      setIsLoading(false);
    79â†’    }
    80â†’  };
    81â†’
    82â†’  const fetchIssues = async () => {
    83â†’    try {
    84â†’      const res = await fetch(`/api/appraisals/issues?appraisalId=${id}`);
    85â†’      const data = await res.json();
    86â†’      setIssues(Array.isArray(data) ? data : []);
    87â†’    } catch (error) {
    88â†’      console.error("Failed to load issues:", error);
    89â†’      setIssues([]);
    90â†’    }
    91â†’  };
    92â†’
    93â†’  const handleDecision = async (decision) => {
    94â†’    try {
    95â†’      await fetch(`/api/appraisals/${id}`, {
    96â†’        method: "PUT",
    97â†’        headers: { "Content-Type": "application/json" },
    98â†’        body: JSON.stringify({ decision }),
    99â†’      });
   100â†’      toast.success(`Marked as ${decision}`);
   101â†’      fetchAppraisal();
   102â†’    } catch (error) {
   103â†’      toast.error("Failed to update");
   104â†’    }
   105â†’  };
   106â†’
   107â†’  const handleConvert = async () => {
   108â†’    setIsConverting(true);
   109â†’    try {
   110â†’      const res = await fetch(`/api/appraisals/${id}/convert`, {
   111â†’        method: "POST",
   112â†’        headers: { "Content-Type": "application/json" },
   113â†’        body: JSON.stringify({ initialStatus: "in_stock" }),
   114â†’      });
   115â†’      if (!res.ok) throw new Error("Failed to convert");
   116â†’      toast.success("Vehicle created!");
   117â†’      router.push("/sales-prep");
   118â†’    } catch (error) {
   119â†’      toast.error(error.message);
   120â†’    } finally {
   121â†’      setIsConverting(false);
   122â†’    }
   123â†’  };
   124â†’
   125â†’  const handlePhotoChange = (e) => {
   126â†’    const files = Array.from(e.target.files);
   127â†’    setPhotoFiles(prev => [...prev, ...files]);
   128â†’
   129â†’    files.forEach(file => {
   130â†’      const reader = new FileReader();
   131â†’      reader.onloadend = () => {
   132â†’        setPhotoPreviews(prev => [...prev, reader.result]);
   133â†’      };
   134â†’      reader.readAsDataURL(file);
   135â†’    });
   136â†’  };
   137â†’
   138â†’  const removePhoto = (index) => {
   139â†’    setPhotoFiles(prev => prev.filter((_, i) => i !== index));
   140â†’    setPhotoPreviews(prev => prev.filter((_, i) => i !== index));
   141â†’  };
   142â†’
   143â†’  const uploadPhotos = async () => {
   144â†’    const uploadedUrls = [];
   145â†’    for (const file of photoFiles) {
   146â†’      const formData = new FormData();
   147â†’      formData.append("file", file);
   148â†’      try {
   149â†’        const res = await fetch("/api/vehicles/upload", {
   150â†’          method: "POST",
   151â†’          body: formData,
   152â†’        });
   153â†’        if (res.ok) {
   154â†’          const data = await res.json();
   155â†’          // Store S3 key (permanent) if available, otherwise use URL (for local dev)
   156â†’          uploadedUrls.push(data.key || data.url);
   157â†’        }
   158â†’      } catch (error) {
   159â†’        console.error("Photo upload failed:", error);
   160â†’      }
   161â†’    }
   162â†’    return uploadedUrls;
   163â†’  };
   164â†’
   165â†’  const handleAddIssue = async () => {
   166â†’    if (!issueForm.description.trim()) {
   167â†’      toast.error("Description is required");
   168â†’      return;
   169â†’    }
   170â†’
   171â†’    setIsAddingIssue(true);
   172â†’
   173â†’    try {
   174â†’      let photoUrls = [];
   175â†’      if (photoFiles.length > 0) {
   176â†’        setIsUploadingPhotos(true);
   177â†’        photoUrls = await uploadPhotos();
   178â†’        setIsUploadingPhotos(false);
   179â†’      }
   180â†’
   181â†’      const res = await fetch("/api/appraisals/issues", {
   182â†’        method: "POST",
   183â†’        headers: { "Content-Type": "application/json" },
   184â†’        body: JSON.stringify({
   185â†’          appraisalId: id,
   186â†’          ...issueForm,
   187â†’          estimatedCost: issueForm.estimatedCost ? parseFloat(issueForm.estimatedCost) : undefined,
   188â†’          photos: photoUrls,
   189â†’        }),
   190â†’      });
   191â†’
   192â†’      if (!res.ok) throw new Error("Failed to add issue");
   193â†’
   194â†’      toast.success("Issue added");
   195â†’      setShowIssueModal(false);
   196â†’      setIssueForm({
   197â†’        category: "mechanical",
   198â†’        subcategory: "Engine",
   199â†’        description: "",
   200â†’        actionNeeded: "",
   201â†’        estimatedCost: "",
   202â†’        notes: "",
   203â†’      });
   204â†’      setPhotoFiles([]);
   205â†’      setPhotoPreviews([]);
   206â†’      fetchIssues();
   207â†’    } catch (error) {
   208â†’      toast.error(error.message);
   209â†’    } finally {
   210â†’      setIsAddingIssue(false);
   211â†’    }
   212â†’  };
   213â†’
   214â†’  const handleDeleteIssue = async (issueId) => {
   215â†’    if (!confirm("Delete this issue?")) return;
   216â†’
   217â†’    try {
   218â†’      await fetch(`/api/appraisals/issues/${issueId}`, { method: "DELETE" });
   219â†’      toast.success("Issue deleted");
   220â†’      fetchIssues();
   221â†’    } catch (error) {
   222â†’      toast.error("Failed to delete");
   223â†’    }
   224â†’  };
   225â†’
   226â†’  const totalEstimatedCost = issues.reduce((sum, issue) => sum + (issue.estimatedCost || 0), 0);
   227â†’
   228â†’  const handleGenerateShareLink = async () => {
   229â†’    setIsGeneratingShare(true);
   230â†’    try {
   231â†’      const res = await fetch(`/api/appraisals/${id}/share`, {
   232â†’        method: "POST",
   233â†’        headers: { "Content-Type": "application/json" },
   234â†’        body: JSON.stringify({ expiresInDays: 60 }),
   235â†’      });
   236â†’      if (!res.ok) throw new Error("Failed to generate share link");
   237â†’      const data = await res.json();
   238â†’      const fullUrl = `${window.location.origin}${data.shareUrl}`;
   239â†’      setShareLink({
   240â†’        url: fullUrl,
   241â†’        expiresAt: data.expiresAt,
   242â†’      });
   243â†’    } catch (error) {
   244â†’      toast.error(error.message);
   245â†’    } finally {
   246â†’      setIsGeneratingShare(false);
   247â†’    }
   248â†’  };
   249â†’
   250â†’  const handleRevokeShareLink = async () => {
   251â†’    if (!confirm("Revoke this share link? Anyone with the link will no longer be able to view this appraisal.")) return;
   252â†’    try {
   253â†’      const res = await fetch(`/api/appraisals/${id}/share`, { method: "DELETE" });
   254â†’      if (!res.ok) throw new Error("Failed to revoke");
   255â†’      setShareLink(null);
   256â†’      toast.success("Share link revoked");
   257â†’    } catch (error) {
   258â†’      toast.error(error.message);
   259â†’    }
   260â†’  };
   261â†’
   262â†’  const copyShareLink = () => {
   263â†’    if (shareLink?.url) {
   264â†’      navigator.clipboard.writeText(shareLink.url);
   265â†’      toast.success("Link copied to clipboard!");
   266â†’    }
   267â†’  };
   268â†’
   269â†’  const handlePrint = () => {
   270â†’    const printContent = `
   271â†’<!DOCTYPE html>
   272â†’<html>
   273â†’<head>
   274â†’  <title>Appraisal - ${appraisal.vehicleReg}</title>
   275â†’  <style>
   276â†’    * { margin: 0; padding: 0; box-sizing: border-box; }
   277â†’    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 40px; color: #1e293b; }
   278â†’    .header { border-bottom: 2px solid #e2e8f0; padding-bottom: 20px; margin-bottom: 30px; }
   279â†’    .title { font-size: 28px; font-weight: bold; margin-bottom: 8px; }
   280â†’    .reg { font-size: 24px; font-family: monospace; color: #1e293b; font-weight: bold; }
   281â†’    .subtitle { font-size: 16px; color: #64748b; margin-top: 8px; }
   282â†’    .section { margin-bottom: 30px; }
   283â†’    .section-title { font-size: 16px; font-weight: 600; color: #475569; margin-bottom: 12px; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px; }
   284â†’    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
   285â†’    .field { margin-bottom: 12px; }
   286â†’    .field-label { font-size: 12px; color: #94a3b8; text-transform: uppercase; margin-bottom: 4px; }
   287â†’    .field-value { font-size: 14px; color: #1e293b; }
   288â†’    .badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
   289â†’    .badge-warning { background: #fef3c7; color: #92400e; }
   290â†’    .badge-success { background: #dcfce7; color: #166534; }
   291â†’    .badge-error { background: #fee2e2; color: #991b1b; }
   292â†’    .notes { background: #f8fafc; padding: 16px; border-radius: 8px; white-space: pre-wrap; font-size: 14px; }
   293â†’    .issue { background: #f8fafc; padding: 12px; border-radius: 8px; margin-bottom: 12px; border-left: 4px solid #6366f1; }
   294â†’    .issue-header { display: flex; gap: 8px; margin-bottom: 8px; align-items: center; }
   295â†’    .issue-badge { background: #e0e7ff; color: #4338ca; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
   296â†’    .issue-desc { font-size: 14px; margin-bottom: 4px; }
   297â†’    .issue-cost { color: #dc2626; font-weight: 600; font-size: 13px; }
   298â†’    .total-cost { font-size: 18px; color: #dc2626; font-weight: bold; margin-top: 16px; padding: 12px; background: #fef2f2; border-radius: 8px; }
   299â†’    .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e2e8f0; font-size: 12px; color: #94a3b8; }
   300â†’    @media print { body { padding: 20px; } }
   301â†’  </style>
   302â†’</head>
   303â†’<body>
   304â†’  <div class="header">
   305â†’    <p class="reg">${appraisal.vehicleReg}</p>
   306â†’    <p class="subtitle">${appraisal.vehicleMake || ""} ${appraisal.vehicleModel || ""} ${appraisal.vehicleYear ? `(${appraisal.vehicleYear})` : ""}</p>
   307â†’    <span class="badge ${appraisal.decision === "converted" ? "badge-success" : appraisal.decision === "declined" ? "badge-error" : "badge-warning"}" style="margin-top: 12px;">
   308â†’      ${appraisal.decision === "pending" ? "New" : appraisal.decision === "reviewed" ? "Reviewed" : appraisal.decision === "converted" ? "Converted" : appraisal.decision === "declined" ? "Declined" : appraisal.decision}
   309â†’    </span>
   310â†’  </div>
   311â†’
   312â†’  <div class="section">
   313â†’    <h2 class="section-title">Vehicle Details</h2>
   314â†’    <div class="grid">
   315â†’      <div class="field"><div class="field-label">Make</div><div class="field-value">${appraisal.vehicleMake || "â€”"}</div></div>
   316â†’      <div class="field"><div class="field-label">Model</div><div class="field-value">${appraisal.vehicleModel || "â€”"}</div></div>
   317â†’      <div class="field"><div class="field-label">Year</div><div class="field-value">${appraisal.vehicleYear || "â€”"}</div></div>
   318â†’      <div class="field"><div class="field-label">Mileage</div><div class="field-value">${appraisal.mileage ? appraisal.mileage.toLocaleString() : "â€”"}</div></div>
   319â†’      <div class="field"><div class="field-label">Colour</div><div class="field-value">${appraisal.colour || "â€”"}</div></div>
   320â†’      <div class="field"><div class="field-label">Fuel Type</div><div class="field-value">${appraisal.fuelType || "â€”"}</div></div>
   321â†’      <div class="field"><div class="field-label">Proposed Price</div><div class="field-value" style="font-weight: bold; font-size: 18px;">${appraisal.proposedPurchasePrice ? "Â£" + appraisal.proposedPurchasePrice.toLocaleString() : "â€”"}</div></div>
   322â†’    </div>
   323â†’  </div>
   324â†’
   325â†’  ${appraisal.conditionNotes ? `
   326â†’  <div class="section">
   327â†’    <h2 class="section-title">Condition Notes</h2>
   328â†’    <div class="notes">${appraisal.conditionNotes}</div>
   329â†’  </div>
   330â†’  ` : ""}
   331â†’
   332â†’  ${issues.length > 0 ? `
   333â†’  <div class="section">
   334â†’    <h2 class="section-title">Issues & Damage (${issues.length})</h2>
   335â†’    ${issues.map(issue => `
   336â†’      <div class="issue">
   337â†’        <div class="issue-header">
   338â†’          <span class="issue-badge">${CATEGORY_LABELS[issue.category] || issue.category}</span>
   339â†’          <strong>${issue.subcategory}</strong>
   340â†’        </div>
   341â†’        <p class="issue-desc">${issue.description}</p>
   342â†’        ${issue.actionNeeded ? `<p style="font-size: 12px; color: #64748b;">Action: ${issue.actionNeeded}</p>` : ""}
   343â†’        ${issue.estimatedCost ? `<p class="issue-cost">Est. cost: Â£${issue.estimatedCost.toLocaleString()}</p>` : ""}
   344â†’      </div>
   345â†’    `).join("")}
   346â†’    ${totalEstimatedCost > 0 ? `<div class="total-cost">Total Estimated Repairs: Â£${totalEstimatedCost.toLocaleString()}</div>` : ""}
   347â†’  </div>
   348â†’  ` : ""}
   349â†’
   350â†’  ${appraisal.contactId ? `
   351â†’  <div class="section">
   352â†’    <h2 class="section-title">Seller Information</h2>
   353â†’    <div class="grid">
   354â†’      <div class="field"><div class="field-label">Name</div><div class="field-value">${appraisal.contactId.name || "â€”"}</div></div>
   355â†’      <div class="field"><div class="field-label">Phone</div><div class="field-value">${appraisal.contactId.phone || "â€”"}</div></div>
   356â†’      <div class="field"><div class="field-label">Email</div><div class="field-value">${appraisal.contactId.email || "â€”"}</div></div>
   357â†’    </div>
   358â†’  </div>
   359â†’  ` : ""}
   360â†’
   361â†’  <div class="footer">
   362â†’    <p>Appraisal created: ${new Date(appraisal.createdAt).toLocaleDateString()} ${new Date(appraisal.createdAt).toLocaleTimeString()}</p>
   363â†’    <p style="margin-top: 4px;">Printed from DealerFlow</p>
   364â†’  </div>
   365â†’</body>
   366â†’</html>`;
   367â†’
   368â†’    const printWindow = window.open("", "_blank");
   369â†’    printWindow.document.write(printContent);
   370â†’    printWindow.document.close();
   371â†’    printWindow.onload = function () {
   372â†’      printWindow.print();
   373â†’    };
   374â†’  };
   375â†’
   376â†’  if (isLoading) {
   377â†’    return (
   378â†’      <DashboardLayout>
   379â†’        <div className="flex justify-center py-20">
   380â†’          <span className="loading loading-spinner loading-lg"></span>
   381â†’        </div>
   382â†’      </DashboardLayout>
   383â†’    );
   384â†’  }
   385â†’
   386â†’  if (!appraisal) {
   387â†’    return (
   388â†’      <DashboardLayout>
   389â†’        <div className="alert alert-error">Appraisal not found</div>
   390â†’      </DashboardLayout>
   391â†’    );
   392â†’  }
   393â†’
   394â†’  return (
   395â†’    <DashboardLayout>
   396â†’      <Head><title>Appraisal {appraisal.vehicleReg} | DealerFlow</title></Head>
   397â†’
   398â†’      <div className="mb-8">
   399â†’        <div className="flex items-center gap-2 mb-4">
   400â†’          <Link href="/appraisals" className="btn btn-ghost btn-sm">â† Back</Link>
   401â†’          <button className="btn btn-ghost btn-sm" onClick={handlePrint}>
   402â†’            <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   403â†’              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
   404â†’            </svg>
   405â†’            Print
   406â†’          </button>
   407â†’          <button className="btn btn-ghost btn-sm" onClick={() => setShowShareModal(true)}>
   408â†’            <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   409â†’              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
   410â†’            </svg>
   411â†’            Share
   412â†’          </button>
   413â†’        </div>
   414â†’        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
   415â†’          <div>
   416â†’            <h1 className="text-3xl font-bold font-mono">{appraisal.vehicleReg}</h1>
   417â†’            <p className="text-base-content/60 mt-2">
   418â†’              {appraisal.vehicleMake} {appraisal.vehicleModel} {appraisal.vehicleYear ? `(${appraisal.vehicleYear})` : ""}
   419â†’            </p>
   420â†’          </div>
   421â†’          <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold border ${
   422â†’            appraisal.decision === "converted" ? "bg-emerald-50 text-emerald-700 border-emerald-200" :
   423â†’            appraisal.decision === "declined" ? "bg-red-50 text-red-700 border-red-200" :
   424â†’            appraisal.decision === "reviewed" ? "bg-blue-50 text-blue-700 border-blue-200" : "bg-amber-50 text-amber-700 border-amber-200"
   425â†’          }`}>
   426â†’            {appraisal.decision === "pending" ? "New" :
   427â†’             appraisal.decision === "reviewed" ? "Reviewed" :
   428â†’             appraisal.decision === "converted" ? "Converted" :
   429â†’             appraisal.decision === "declined" ? "Declined" : appraisal.decision}
   430â†’          </span>
   431â†’        </div>
   432â†’      </div>
   433â†’
   434â†’      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
   435â†’        <div className="lg:col-span-2 space-y-6">
   436â†’          {/* Vehicle Details */}
   437â†’          <Card>
   438â†’            <CardHeader title="Vehicle Details" icon="ğŸš—" />
   439â†’            <CardContent>
   440â†’              <KeyValueGrid cols={2}>
   441â†’                <KeyValue label="Make" value={appraisal.vehicleMake} />
   442â†’                <KeyValue label="Model" value={appraisal.vehicleModel} />
   443â†’                <KeyValue label="Year" value={appraisal.vehicleYear} />
   444â†’                <KeyValue label="Mileage" value={appraisal.mileage?.toLocaleString()} />
   445â†’              </KeyValueGrid>
   446â†’              <div className="mt-4 pt-4 border-t border-slate-100">
   447â†’                <KeyValue label="Proposed Price" value={appraisal.proposedPurchasePrice ? `Â£${appraisal.proposedPurchasePrice.toLocaleString()}` : null} size="lg" />
   448â†’              </div>
   449â†’            </CardContent>
   450â†’          </Card>
   451â†’
   452â†’          {/* Condition Notes */}
   453â†’          <Card>
   454â†’            <CardHeader title="Condition Notes" icon="ğŸ“" />
   455â†’            <CardContent>
   456â†’              <p className="whitespace-pre-wrap text-slate-700">{appraisal.conditionNotes || "No notes recorded"}</p>
   457â†’            </CardContent>
   458â†’          </Card>
   459â†’
   460â†’          {/* Issues Section */}
   461â†’          <Card>
   462â†’            <CardHeader
   463â†’              title="Issues & Damage"
   464â†’              icon="âš ï¸"
   465â†’              subtitle={totalEstimatedCost > 0 ? `Total est. repair: Â£${totalEstimatedCost.toLocaleString()}` : undefined}
   466â†’              action={
   467â†’                <button
   468â†’                  className="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-lg bg-[#0066CC] text-white hover:bg-[#0055BB] transition-colors"
   469â†’                  onClick={() => setShowIssueModal(true)}
   470â†’                >
   471â†’                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   472â†’                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
   473â†’                  </svg>
   474â†’                  Add Issue
   475â†’                </button>
   476â†’              }
   477â†’            />
   478â†’            <CardContent>
   479â†’              {issues.length === 0 ? (
   480â†’                <div className="text-center py-8">
   481â†’                  <div className="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center mx-auto mb-3">
   482â†’                    <svg className="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   483â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
   484â†’                    </svg>
   485â†’                  </div>
   486â†’                  <p className="text-slate-600 font-medium">No issues recorded</p>
   487â†’                  <p className="text-sm text-slate-400 mt-1">Click "Add Issue" to log damage, faults, or condition notes</p>
   488â†’                </div>
   489â†’              ) : (
   490â†’                <div className="space-y-3">
   491â†’                  {issues.map((issue) => (
   492â†’                    <div key={issue.id} className="bg-slate-50 rounded-xl border border-slate-200 p-4">
   493â†’                      <div className="flex items-start justify-between gap-2 mb-2">
   494â†’                        <div className="flex items-center gap-2 flex-wrap">
   495â†’                          <Badge variant={
   496â†’                            issue.category === 'mechanical' ? 'danger' :
   497â†’                            issue.category === 'electrical' ? 'warning' :
   498â†’                            issue.category === 'bodywork' ? 'info' :
   499â†’                            issue.category === 'fault_codes' ? 'danger' :
   500â†’                            issue.category === 'mot' ? 'secondary' : 'default'
   501â†’                          }>
   502â†’                            {CATEGORY_LABELS[issue.category] || issue.category}
   503â†’                          </Badge>
   504â†’                          <span className="font-semibold text-slate-800">{issue.subcategory}</span>
   505â†’                        </div>
   506â†’                        <button
   507â†’                          className="text-xs text-red-500 hover:text-red-700 hover:underline transition-colors"
   508â†’                          onClick={() => handleDeleteIssue(issue.id)}
   509â†’                        >
   510â†’                          Delete
   511â†’                        </button>
   512â†’                      </div>
   513â†’                      <p className="text-sm text-slate-700 mb-2">{issue.description}</p>
   514â†’                      {issue.actionNeeded && (
   515â†’                        <p className="text-xs text-slate-500 mb-1">
   516â†’                          <span className="font-medium text-slate-600">Action needed:</span> {issue.actionNeeded}
   517â†’                        </p>
   518â†’                      )}
   519â†’                      {issue.estimatedCost > 0 && (
   520â†’                        <p className="text-sm font-semibold text-red-600">
   521â†’                          Est. cost: Â£{issue.estimatedCost.toLocaleString()}
   522â†’                        </p>
   523â†’                      )}
   524â†’                      {issue.photos && issue.photos.length > 0 && (
   525â†’                        <div className="mt-3 pt-3 border-t border-slate-200">
   526â†’                          <PhotoGallery photos={issue.photos} thumbnailSize="sm" showCount={false} />
   527â†’                        </div>
   528â†’                      )}
   529â†’                    </div>
   530â†’                  ))}
   531â†’                </div>
   532â†’              )}
   533â†’            </CardContent>
   534â†’          </Card>
   535â†’
   536â†’          {/* Legacy Damage Photos - show if existing */}
   537â†’          {appraisal.damagePhotos && appraisal.damagePhotos.length > 0 && (
   538â†’            <Card>
   539â†’              <CardHeader title="Legacy Damage Photos" icon="ğŸ“·" subtitle="Consider creating issues for these photos" />
   540â†’              <CardContent>
   541â†’                <PhotoGallery photos={appraisal.damagePhotos} thumbnailSize="lg" />
   542â†’              </CardContent>
   543â†’            </Card>
   544â†’          )}
   545â†’
   546â†’          {/* Fault Code Photos - show if existing */}
   547â†’          {appraisal.faultCodePhotos && appraisal.faultCodePhotos.length > 0 && (
   548â†’            <Card>
   549â†’              <CardHeader title="Fault Code Photos" icon="ğŸ”§" />
   550â†’              <CardContent>
   551â†’                <PhotoGallery photos={appraisal.faultCodePhotos} thumbnailSize="lg" />
   552â†’              </CardContent>
   553â†’            </Card>
   554â†’          )}
   555â†’
   556â†’          {/* AI Hints */}
   557â†’          {appraisal.aiHintText && (
   558â†’            <Card variant="accent">
   559â†’              <CardHeader title="AI Suggestions" icon="ğŸ¤–" />
   560â†’              <CardContent>
   561â†’                <p className="whitespace-pre-wrap text-sm text-slate-700">{appraisal.aiHintText}</p>
   562â†’              </CardContent>
   563â†’            </Card>
   564â†’          )}
   565â†’
   566â†’          {/* Seller Info */}
   567â†’          {appraisal.contactId && (
   568â†’            <Card>
   569â†’              <CardHeader title="Seller Information" icon="ğŸ‘¤" />
   570â†’              <CardContent>
   571â†’                <KeyValueGrid cols={3}>
   572â†’                  <KeyValue label="Name" value={appraisal.contactId?.name} />
   573â†’                  <KeyValue label="Phone" value={appraisal.contactId?.phone} />
   574â†’                  <KeyValue label="Email" value={appraisal.contactId?.email} />
   575â†’                </KeyValueGrid>
   576â†’              </CardContent>
   577â†’            </Card>
   578â†’          )}
   579â†’        </div>
   580â†’
   581â†’        {/* Actions Sidebar */}
   582â†’        <div className="lg:col-span-1">
   583â†’          <Card className="sticky top-20">
   584â†’            <CardHeader title="Actions" />
   585â†’            <CardContent className="space-y-4">
   586â†’              {(appraisal.decision === "pending" || appraisal.decision === "reviewed") && !appraisal.vehicleId && (
   587â†’                <div className="space-y-3">
   588â†’                  <button
   589â†’                    className="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-semibold rounded-lg bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50 transition-colors"
   590â†’                    onClick={handleConvert}
   591â†’                    disabled={isConverting}
   592â†’                  >
   593â†’                    {isConverting ? (
   594â†’                      <svg className="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
   595â†’                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
   596â†’                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
   597â†’                      </svg>
   598â†’                    ) : (
   599â†’                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   600â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
   601â†’                      </svg>
   602â†’                    )}
   603â†’                    Convert to Stock
   604â†’                  </button>
   605â†’                  <button
   606â†’                    className="w-full px-4 py-2 text-sm font-medium rounded-lg border border-slate-200 text-slate-700 hover:bg-slate-50 transition-colors"
   607â†’                    onClick={() => handleDecision("reviewed")}
   608â†’                  >
   609â†’                    Mark as Reviewed
   610â†’                  </button>
   611â†’                  <button
   612â†’                    className="w-full px-4 py-2 text-sm font-medium rounded-lg border border-red-200 text-red-600 hover:bg-red-50 transition-colors"
   613â†’                    onClick={() => handleDecision("declined")}
   614â†’                  >
   615â†’                    Decline
   616â†’                  </button>
   617â†’                  <p className="text-xs text-slate-500 text-center">Converting will create a vehicle and default prep tasks.</p>
   618â†’                </div>
   619â†’              )}
   620â†’
   621â†’              {appraisal.decision === "converted" || appraisal.vehicleId ? (
   622â†’                <div className="space-y-3">
   623â†’                  <div className="p-3 rounded-lg bg-emerald-50 border border-emerald-200 text-sm text-emerald-700 text-center">
   624â†’                    Vehicle added to stock
   625â†’                  </div>
   626â†’                  <Link
   627â†’                    href="/sales-prep"
   628â†’                    className="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 text-sm font-semibold rounded-lg bg-[#0066CC] text-white hover:bg-[#0055BB] transition-colors"
   629â†’                  >
   630â†’                    View in Stock & Prep
   631â†’                  </Link>
   632â†’                </div>
   633â†’              ) : null}
   634â†’
   635â†’              {appraisal.decision === "declined" && (
   636â†’                <div className="space-y-3">
   637â†’                  <div className="p-3 rounded-lg bg-slate-100 border border-slate-200 text-sm text-slate-600 text-center">
   638â†’                    This appraisal was declined
   639â†’                  </div>
   640â†’                  <button
   641â†’                    className="w-full px-4 py-2 text-sm font-medium rounded-lg border border-slate-200 text-slate-600 hover:bg-slate-50 transition-colors"
   642â†’                    onClick={() => handleDecision("pending")}
   643â†’                  >
   644â†’                    Re-open
   645â†’                  </button>
   646â†’                </div>
   647â†’              )}
   648â†’
   649â†’              {/* Issues Summary */}
   650â†’              {issues.length > 0 && (
   651â†’                <div className="pt-4 border-t border-slate-200">
   652â†’                  <p className="text-xs font-semibold text-slate-500 uppercase tracking-wide mb-2">Issues Summary</p>
   653â†’                  <p className="text-sm text-slate-700">{issues.length} issue{issues.length !== 1 ? "s" : ""} logged</p>
   654â†’                  {totalEstimatedCost > 0 && (
   655â†’                    <p className="text-sm font-semibold text-red-600">Â£{totalEstimatedCost.toLocaleString()} est. repairs</p>
   656â†’                  )}
   657â†’                </div>
   658â†’              )}
   659â†’
   660â†’              <div className="pt-4 border-t border-slate-200">
   661â†’                <button
   662â†’                  className="w-full px-4 py-2 text-sm font-medium rounded-lg text-red-500 hover:bg-red-50 transition-colors"
   663â†’                  onClick={async () => {
   664â†’                    if (confirm("Delete this appraisal?")) {
   665â†’                      await fetch(`/api/appraisals/${id}`, { method: "DELETE" });
   666â†’                      router.push("/appraisals");
   667â†’                    }
   668â†’                  }}
   669â†’                >
   670â†’                  Delete Appraisal
   671â†’                </button>
   672â†’              </div>
   673â†’            </CardContent>
   674â†’          </Card>
   675â†’        </div>
   676â†’      </div>
   677â†’
   678â†’      {/* Add Issue Modal */}
   679â†’      {showIssueModal && (
   680â†’        <div className="modal modal-open">
   681â†’          <div className="modal-box max-w-lg">
   682â†’            <h3 className="font-bold text-lg mb-4">Add Issue</h3>
   683â†’
   684â†’            <div className="space-y-4">
   685â†’              <div className="grid grid-cols-2 gap-4">
   686â†’                <div className="form-control">
   687â†’                  <label className="label"><span className="label-text">Category</span></label>
   688â†’                  <select
   689â†’                    className="select select-bordered w-full"
   690â†’                    value={issueForm.category}
   691â†’                    onChange={(e) => {
   692â†’                      const newCat = e.target.value;
   693â†’                      setIssueForm({
   694â†’                        ...issueForm,
   695â†’                        category: newCat,
   696â†’                        subcategory: ISSUE_SUBCATEGORIES[newCat][0],
   697â†’                      });
   698â†’                    }}
   699â†’                  >
   700â†’                    {ISSUE_CATEGORIES.map((cat) => (
   701â†’                      <option key={cat} value={cat}>{CATEGORY_LABELS[cat]}</option>
   702â†’                    ))}
   703â†’                  </select>
   704â†’                </div>
   705â†’                <div className="form-control">
   706â†’                  <label className="label"><span className="label-text">Subcategory</span></label>
   707â†’                  <select
   708â†’                    className="select select-bordered w-full"
   709â†’                    value={issueForm.subcategory}
   710â†’                    onChange={(e) => setIssueForm({ ...issueForm, subcategory: e.target.value })}
   711â†’                  >
   712â†’                    {ISSUE_SUBCATEGORIES[issueForm.category].map((sub) => (
   713â†’                      <option key={sub} value={sub}>{sub}</option>
   714â†’                    ))}
   715â†’                  </select>
   716â†’                </div>
   717â†’              </div>
   718â†’
   719â†’              <div className="form-control">
   720â†’                <label className="label"><span className="label-text">Description *</span></label>
   721â†’                <textarea
   722â†’                  className="textarea textarea-bordered"
   723â†’                  rows={3}
   724â†’                  placeholder="Describe the issue..."
   725â†’                  value={issueForm.description}
   726â†’                  onChange={(e) => setIssueForm({ ...issueForm, description: e.target.value })}
   727â†’                />
   728â†’              </div>
   729â†’
   730â†’              <div className="form-control">
   731â†’                <label className="label"><span className="label-text">Action Needed</span></label>
   732â†’                <input
   733â†’                  type="text"
   734â†’                  className="input input-bordered"
   735â†’                  placeholder="e.g., Replace bumper, repaint"
   736â†’                  value={issueForm.actionNeeded}
   737â†’                  onChange={(e) => setIssueForm({ ...issueForm, actionNeeded: e.target.value })}
   738â†’                />
   739â†’              </div>
   740â†’
   741â†’              <div className="form-control">
   742â†’                <label className="label"><span className="label-text">Estimated Repair Cost (Â£)</span></label>
   743â†’                <input
   744â†’                  type="number"
   745â†’                  className="input input-bordered"
   746â†’                  placeholder="0"
   747â†’                  value={issueForm.estimatedCost}
   748â†’                  onChange={(e) => setIssueForm({ ...issueForm, estimatedCost: e.target.value })}
   749â†’                />
   750â†’              </div>
   751â†’
   752â†’              {/* Photo Upload */}
   753â†’              <div className="form-control">
   754â†’                <label className="label"><span className="label-text">Photos</span></label>
   755â†’                <input
   756â†’                  type="file"
   757â†’                  accept="image/*"
   758â†’                  multiple
   759â†’                  className="file-input file-input-bordered w-full"
   760â†’                  onChange={handlePhotoChange}
   761â†’                />
   762â†’                {photoPreviews.length > 0 && (
   763â†’                  <div className="flex flex-wrap gap-2 mt-2">
   764â†’                    {photoPreviews.map((preview, idx) => (
   765â†’                      <div key={idx} className="relative">
   766â†’                        <img src={preview} alt={`Preview ${idx + 1}`} className="w-16 h-16 object-cover rounded-lg" />
   767â†’                        <button
   768â†’                          type="button"
   769â†’                          className="absolute -top-1 -right-1 btn btn-circle btn-xs btn-error"
   770â†’                          onClick={() => removePhoto(idx)}
   771â†’                        >
   772â†’                          Ã—
   773â†’                        </button>
   774â†’                      </div>
   775â†’                    ))}
   776â†’                  </div>
   777â†’                )}
   778â†’              </div>
   779â†’            </div>
   780â†’
   781â†’            <div className="modal-action">
   782â†’              <button
   783â†’                className="btn btn-ghost"
   784â†’                onClick={() => {
   785â†’                  setShowIssueModal(false);
   786â†’                  setPhotoFiles([]);
   787â†’                  setPhotoPreviews([]);
   788â†’                }}
   789â†’              >
   790â†’                Cancel
   791â†’              </button>
   792â†’              <button
   793â†’                className="btn btn-primary"
   794â†’                onClick={handleAddIssue}
   795â†’                disabled={isAddingIssue}
   796â†’              >
   797â†’                {isAddingIssue ? (
   798â†’                  <>
   799â†’                    <span className="loading loading-spinner loading-sm"></span>
   800â†’                    {isUploadingPhotos ? "Uploading..." : "Saving..."}
   801â†’                  </>
   802â†’                ) : (
   803â†’                  "Add Issue"
   804â†’                )}
   805â†’              </button>
   806â†’            </div>
   807â†’          </div>
   808â†’          <div className="modal-backdrop" onClick={() => setShowIssueModal(false)}></div>
   809â†’        </div>
   810â†’      )}
   811â†’
   812â†’      {/* Share Modal */}
   813â†’      {showShareModal && (
   814â†’        <div className="modal modal-open">
   815â†’          <div className="modal-box max-w-md">
   816â†’            <button
   817â†’              className="btn btn-sm btn-circle btn-ghost absolute right-2 top-2"
   818â†’              onClick={() => setShowShareModal(false)}
   819â†’            >
   820â†’              âœ•
   821â†’            </button>
   822â†’            <div className="text-center mb-6">
   823â†’              <div className="w-12 h-12 mx-auto mb-3 rounded-full bg-[#14B8A6]/10 flex items-center justify-center">
   824â†’                <svg className="w-6 h-6 text-[#14B8A6]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   825â†’                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
   826â†’                </svg>
   827â†’              </div>
   828â†’              <h3 className="font-bold text-lg">Share Appraisal</h3>
   829â†’              <p className="text-sm text-base-content/60 mt-1">
   830â†’                Share a read-only view of this appraisal
   831â†’              </p>
   832â†’            </div>
   833â†’
   834â†’            {shareLink ? (
   835â†’              <div className="space-y-4">
   836â†’                <div className="bg-base-200 rounded-lg p-4">
   837â†’                  <label className="text-xs text-base-content/60 uppercase tracking-wider">Public Link</label>
   838â†’                  <div className="flex items-center gap-2 mt-2">
   839â†’                    <input
   840â†’                      type="text"
   841â†’                      readOnly
   842â†’                      value={shareLink.url}
   843â†’                      className="input input-bordered input-sm flex-1 text-xs font-mono"
   844â†’                    />
   845â†’                    <button
   846â†’                      className="btn btn-primary btn-sm"
   847â†’                      onClick={copyShareLink}
   848â†’                    >
   849â†’                      Copy
   850â†’                    </button>
   851â†’                  </div>
   852â†’                  <p className="text-xs text-base-content/60 mt-2">
   853â†’                    Expires: {new Date(shareLink.expiresAt).toLocaleDateString()}
   854â†’                  </p>
   855â†’                </div>
   856â†’
   857â†’                <div className="grid grid-cols-2 gap-2">
   858â†’                  <button
   859â†’                    onClick={() => {
   860â†’                      window.open(`mailto:?subject=Vehicle Appraisal - ${appraisal.vehicleReg}&body=View the appraisal here: ${shareLink.url}`, "_blank");
   861â†’                    }}
   862â†’                    className="btn btn-ghost btn-sm"
   863â†’                  >
   864â†’                    <svg className="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   865â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
   866â†’                    </svg>
   867â†’                    Email
   868â†’                  </button>
   869â†’                  <button
   870â†’                    onClick={() => {
   871â†’                      window.open(`https://wa.me/?text=View this vehicle appraisal: ${encodeURIComponent(shareLink.url)}`, "_blank");
   872â†’                    }}
   873â†’                    className="btn btn-ghost btn-sm"
   874â†’                  >
   875â†’                    <svg className="w-4 h-4 mr-1 text-green-600" viewBox="0 0 24 24" fill="currentColor">
   876â†’                      <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
   877â†’                    </svg>
   878â†’                    WhatsApp
   879â†’                  </button>
   880â†’                </div>
   881â†’
   882â†’                <button
   883â†’                  onClick={handleRevokeShareLink}
   884â†’                  className="btn btn-ghost btn-sm text-error w-full"
   885â†’                >
   886â†’                  Revoke Link
   887â†’                </button>
   888â†’              </div>
   889â†’            ) : (
   890â†’              <div className="space-y-4">
   891â†’                <p className="text-sm text-center text-base-content/60">
   892â†’                  Generate a secure link that allows anyone to view this appraisal (read-only). The link will expire after 60 days.
   893â†’                </p>
   894â†’                <button
   895â†’                  className="btn btn-primary w-full"
   896â†’                  onClick={handleGenerateShareLink}
   897â†’                  disabled={isGeneratingShare}
   898â†’                >
   899â†’                  {isGeneratingShare ? (
   900â†’                    <>
   901â†’                      <span className="loading loading-spinner loading-sm"></span>
   902â†’                      Generating...
   903â†’                    </>
   904â†’                  ) : (
   905â†’                    "Generate Share Link"
   906â†’                  )}
   907â†’                </button>
   908â†’              </div>
   909â†’            )}
   910â†’          </div>
   911â†’          <div className="modal-backdrop" onClick={() => setShowShareModal(false)}></div>
   912â†’        </div>
   913â†’      )}
   914â†’    </DashboardLayout>
   915â†’  );
   916â†’}
   917â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
