  2270â†’                      }`}
  2271â†’                      value={selectedCase.bookedInAt ? new Date(selectedCase.bookedInAt).toISOString().slice(0, 16) : ""}
  2272â†’                      onChange={async (e) => {
  2273â†’                        const newValue = e.target.value ? new Date(e.target.value).toISOString() : null;
  2274â†’                        const oldValue = selectedCase.bookedInAt || null;
  2275â†’                        await updateCase({
  2276â†’                          bookedInAt: newValue,
  2277â†’                          _eventType: "BOOKING_UPDATED",
  2278â†’                          _eventMetadata: { oldBookedAt: oldValue, newBookedAt: newValue }
  2279â†’                        }, newValue ? "Booking updated" : null);
  2280â†’                      }}
  2281â†’                    />
  2282â†’                    {selectedCase.bookedInAt && (
  2283â†’                      <button
  2284â†’                        className="inline-flex items-center gap-1 mt-2 px-2 py-1 text-xs font-medium text-slate-500 hover:text-red-600 hover:bg-red-50 rounded transition-colors"
  2285â†’                        onClick={async () => {
  2286â†’                          const oldValue = selectedCase.bookedInAt;
  2287â†’                          await updateCase({
  2288â†’                            bookedInAt: null,
  2289â†’                            _eventType: "BOOKING_UPDATED",
  2290â†’                            _eventMetadata: { oldBookedAt: oldValue, newBookedAt: null }
  2291â†’                          }, "Booking cleared");
  2292â†’                        }}
  2293â†’                      >
  2294â†’                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2295â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
  2296â†’                        </svg>
  2297â†’                        Clear booking
  2298â†’                      </button>
  2299â†’                    )}
  2300â†’                  </div>
  2301â†’                </div>
  2302â†’              </div>
  2303â†’
  2304â†’              {/* Parts Required Section */}
  2305â†’              <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
  2306â†’                <div className="px-4 py-3 border-b border-slate-100 flex items-center justify-between">
  2307â†’                  <h3 className="text-sm font-semibold text-slate-900">Parts</h3>
  2308â†’                  {selectedCase.partsRequired && (
  2309â†’                    <span className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-orange-100 text-orange-700">
  2310â†’                      Required
  2311â†’                    </span>
  2312â†’                  )}
  2313â†’                </div>
  2314â†’                <div className="p-4 space-y-3">
  2315â†’                  <label className="flex items-center gap-3 cursor-pointer group">
  2316â†’                    <div className="relative">
  2317â†’                      <input
  2318â†’                        type="checkbox"
  2319â†’                        className="sr-only peer"
  2320â†’                        checked={selectedCase.partsRequired || false}
  2321â†’                        onChange={async (e) => {
  2322â†’                          const newValue = e.target.checked;
  2323â†’                          const oldValue = selectedCase.partsRequired || false;
  2324â†’                          await updateCase({
  2325â†’                            partsRequired: newValue,
  2326â†’                            _eventType: "PARTS_UPDATED",
  2327â†’                            _eventMetadata: { partsRequired: newValue, wasRequired: oldValue }
  2328â†’                          }, newValue ? "Parts required marked" : "Parts not required");
  2329â†’                        }}
  2330â†’                      />
  2331â†’                      <div className="w-10 h-6 bg-slate-200 rounded-full peer-checked:bg-[#0066CC] transition-colors"></div>
  2332â†’                      <div className="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow transition-transform peer-checked:translate-x-4"></div>
  2333â†’                    </div>
  2334â†’                    <span className="text-sm font-medium text-slate-700 group-hover:text-slate-900">Parts required</span>
  2335â†’                  </label>
  2336â†’
  2337â†’                  {selectedCase.partsRequired && (
  2338â†’                    <div className="pt-2 border-t border-slate-100">
  2339â†’                      <label className="text-xs font-medium text-slate-500 uppercase tracking-wide mb-1.5 block">Parts Notes</label>
  2340â†’                      <textarea
  2341â†’                        className="w-full px-3 py-2 bg-slate-50 border border-transparent rounded-lg text-slate-900 placeholder-slate-400 focus:bg-white focus:ring-2 focus:ring-[#0066CC] focus:border-transparent transition-all outline-none text-sm resize-none"
  2342â†’                        rows={2}
  2343â†’                        value={selectedCase.partsNotes || ""}
  2344â†’                        placeholder="List parts needed, order status, etc..."
  2345â†’                        onChange={(e) => setSelectedCase({ ...selectedCase, partsNotes: e.target.value })}
  2346â†’                        onBlur={() => updateCase({
  2347â†’                          partsNotes: selectedCase.partsNotes,
  2348â†’                          _eventType: "PARTS_UPDATED",
  2349â†’                          _eventMetadata: { partsNotes: selectedCase.partsNotes }
  2350â†’                        })}
  2351â†’                      />
  2352â†’                    </div>
  2353â†’                  )}
  2354â†’                </div>
  2355â†’              </div>
  2356â†’
  2357â†’              {/* Courtesy Car Section */}
  2358â†’              <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
  2359â†’                <div className="px-4 py-3 border-b border-slate-100 flex items-center justify-between">
  2360â†’                  <div className="flex items-center gap-2">
  2361â†’                    <span className="text-base">ðŸš—</span>
  2362â†’                    <h3 className="text-sm font-semibold text-slate-900">Courtesy Car</h3>
  2363â†’                  </div>
  2364â†’                  {selectedCase.courtesyAllocation?.status === "OUT" && (
  2365â†’                    <span className="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700">
  2366â†’                      Out
  2367â†’                    </span>
  2368â†’                  )}
  2369â†’                </div>
  2370â†’                <div className="p-4 space-y-3">
  2371â†’                  {/* Toggle: Courtesy Required */}
  2372â†’                  <label className="flex items-center gap-3 cursor-pointer group">
  2373â†’                    <div className="relative">
  2374â†’                      <input
  2375â†’                        type="checkbox"
  2376â†’                        className="sr-only peer"
  2377â†’                        checked={selectedCase.courtesyRequired || false}
  2378â†’                        onChange={async (e) => {
  2379â†’                          const newValue = e.target.checked;
  2380â†’                          await updateCase({
  2381â†’                            courtesyRequired: newValue,
  2382â†’                            _eventType: "COURTESY_REQUIRED_TOGGLED",
  2383â†’                            _eventMetadata: { courtesyRequired: newValue }
  2384â†’                          }, newValue ? "Courtesy car marked as required" : "Courtesy car not required");
  2385â†’                        }}
  2386â†’                      />
  2387â†’                      <div className="w-10 h-6 bg-slate-200 rounded-full peer-checked:bg-[#0066CC] transition-colors"></div>
  2388â†’                      <div className="absolute left-1 top-1 w-4 h-4 bg-white rounded-full shadow transition-transform peer-checked:translate-x-4"></div>
  2389â†’                    </div>
  2390â†’                    <span className="text-sm font-medium text-slate-700 group-hover:text-slate-900">Courtesy car required</span>
  2391â†’                  </label>
  2392â†’
  2393â†’                  {/* Allocation Display / Controls */}
  2394â†’                  {selectedCase.courtesyAllocation && selectedCase.courtesyAllocation.status === "OUT" ? (
  2395â†’                    <div className="bg-emerald-50 border border-emerald-200 rounded-lg p-3 space-y-2">
  2396â†’                      <div className="flex items-center justify-between">
  2397â†’                        <span className="text-sm font-medium text-emerald-800">Currently Allocated</span>
  2398â†’                        <span className="inline-flex items-center bg-amber-100 border border-amber-300 rounded-lg px-2 py-0.5 font-mono font-bold text-slate-900 text-xs tracking-wider uppercase">
  2399â†’                          {selectedCase.courtesyAllocation.courtesyVehicle?.regCurrent || "N/A"}
  2400â†’                        </span>
  2401â†’                      </div>
  2402â†’                      {selectedCase.courtesyAllocation.courtesyVehicle && (
  2403â†’                        <p className="text-xs text-emerald-700">
  2404â†’                          {selectedCase.courtesyAllocation.courtesyVehicle.make} {selectedCase.courtesyAllocation.courtesyVehicle.model}
  2405â†’                        </p>
  2406â†’                      )}
  2407â†’                      {selectedCase.courtesyAllocation.dateDueBack && (
  2408â†’                        <p className="text-xs text-emerald-700">
  2409â†’                          Due back: {new Date(selectedCase.courtesyAllocation.dateDueBack).toLocaleDateString("en-GB", { day: "numeric", month: "short" })}
  2410â†’                        </p>
  2411â†’                      )}
  2412â†’                      <button
  2413â†’                        className="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-emerald-700 bg-emerald-100 hover:bg-emerald-200 border border-emerald-200 rounded-lg transition-colors mt-1"
  2414â†’                        onClick={returnCourtesy}
  2415â†’                      >
  2416â†’                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2417â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
  2418â†’                        </svg>
  2419â†’                        Mark as Returned
  2420â†’                      </button>
  2421â†’                    </div>
  2422â†’                  ) : selectedCase.courtesyAllocation && selectedCase.courtesyAllocation.status === "RETURNED" ? (
  2423â†’                    <div className="bg-slate-50 border border-slate-200 rounded-lg p-3">
  2424â†’                      <div className="flex items-center gap-2 text-sm text-slate-600">
  2425â†’                        <svg className="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2426â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
  2427â†’                        </svg>
  2428â†’                        Courtesy car returned
  2429â†’                        {selectedCase.courtesyAllocation.courtesyVehicle?.regCurrent && (
  2430â†’                          <span className="font-mono text-xs bg-slate-100 px-1.5 py-0.5 rounded">({selectedCase.courtesyAllocation.courtesyVehicle.regCurrent})</span>
  2431â†’                        )}
  2432â†’                      </div>
  2433â†’                    </div>
  2434â†’                  ) : selectedCase.courtesyRequired ? (
  2435â†’                    <div className="space-y-2 pt-2 border-t border-slate-100">
  2436â†’                      <p className="text-xs text-amber-600 font-medium flex items-center gap-1">
  2437â†’                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2438â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
  2439â†’                        </svg>
  2440â†’                        No courtesy car allocated yet
  2441â†’                      </p>
  2442â†’                      <div>
  2443â†’                        <label className="text-xs font-medium text-slate-500 uppercase tracking-wide mb-1.5 block">Select Vehicle</label>
  2444â†’                        <select
  2445â†’                          className="w-full px-3 py-2 bg-slate-50 border border-transparent rounded-lg text-slate-900 focus:bg-white focus:ring-2 focus:ring-[#0066CC] focus:border-transparent transition-all outline-none text-sm"
  2446â†’                          onFocus={loadCourtesyVehicles}
  2447â†’                          onChange={(e) => {
  2448â†’                            if (e.target.value) {
  2449â†’                              allocateCourtesy(e.target.value);
  2450â†’                            }
  2451â†’                          }}
  2452â†’                          defaultValue=""
  2453â†’                        >
  2454â†’                          <option value="" disabled>
  2455â†’                            {isLoadingCourtesy ? "Loading..." : "Choose courtesy vehicle..."}
  2456â†’                          </option>
  2457â†’                          {courtesyVehicles.map((v) => (
  2458â†’                            <option key={v._id} value={v._id}>
  2459â†’                              {v.regCurrent} - {v.make} {v.model}
  2460â†’                            </option>
  2461â†’                          ))}
  2462â†’                          {courtesyVehicles.length === 0 && !isLoadingCourtesy && (
  2463â†’                            <option value="" disabled>No courtesy vehicles available</option>
  2464â†’                          )}
  2465â†’                        </select>
  2466â†’                      </div>
  2467â†’                    </div>
  2468â†’                  ) : null}
  2469â†’                </div>
  2470â†’              </div>
  2471â†’
  2472â†’              {/* Quick Actions Row */}
  2473â†’              <div className="flex gap-2 flex-wrap">
  2474â†’                {selectedCase.aiReview?.payload ? (
  2475â†’                  <button
  2476â†’                    className="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-slate-600 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors"
  2477â†’                    onClick={() => setShowRegenerateConfirm(true)}
  2478â†’                    disabled={isGeneratingAI}
  2479â†’                  >
  2480â†’                    {isGeneratingAI ? (
  2481â†’                      <span className="w-4 h-4 border-2 border-slate-300 border-t-slate-600 rounded-full animate-spin"></span>
  2482â†’                    ) : (
  2483â†’                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2484â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
  2485â†’                      </svg>
  2486â†’                    )}
  2487â†’                    Regenerate AI
  2488â†’                  </button>
  2489â†’                ) : (
  2490â†’                  <button
  2491â†’                    className="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-white bg-[#0066CC] hover:bg-[#0055BB] rounded-lg transition-colors shadow-sm"
  2492â†’                    onClick={() => generateAIReview()}
  2493â†’                    disabled={isGeneratingAI}
  2494â†’                  >
  2495â†’                    {isGeneratingAI ? (
  2496â†’                      <span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
  2497â†’                    ) : (
  2498â†’                      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2499â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
  2500â†’                      </svg>
  2501â†’                    )}
  2502â†’                    Generate AI Review
  2503â†’                  </button>
  2504â†’                )}
  2505â†’                <button
  2506â†’                  className="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-slate-600 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
  2507â†’                  disabled={!selectedCase.aiReview?.payload?.draftCustomerReply}
  2508â†’                  onClick={() => copyToClipboard(selectedCase.aiReview?.payload?.draftCustomerReply, "Customer reply")}
  2509â†’                >
  2510â†’                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2511â†’                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
  2512â†’                  </svg>
  2513â†’                  Customer Reply
  2514â†’                </button>
  2515â†’                <button
  2516â†’                  className="inline-flex items-center gap-1.5 px-3 py-2 text-sm font-medium text-slate-600 bg-slate-50 hover:bg-slate-100 border border-slate-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
  2517â†’                  disabled={!selectedCase.aiReview?.payload?.draftInternalNote}
  2518â†’                  onClick={() => copyToClipboard(selectedCase.aiReview?.payload?.draftInternalNote, "Internal note")}
  2519â†’                >
  2520â†’                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2521â†’                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
  2522â†’                  </svg>
  2523â†’                  Internal Note
  2524â†’                </button>
  2525â†’              </div>
  2526â†’
  2527â†’              {/* AI Case Review Panel */}
  2528â†’              {selectedCase.aiReview?.payload ? (
  2529â†’                <div className="bg-[#0066CC]/5/50 rounded-xl border border-[#0066CC]/20 overflow-hidden">
  2530â†’                  <div className="px-4 py-3 border-b border-[#0066CC]/10 flex justify-between items-center bg-[#0066CC]/8">
  2531â†’                    <h3 className="text-sm font-semibold text-[#0055BB] flex items-center gap-2">
  2532â†’                      <span>ðŸ¤–</span> AI Case Review
  2533â†’                    </h3>
  2534â†’                    <span className="text-xs text-[#0066CC]">
  2535â†’                      Generated {relativeTime(selectedCase.aiReview.generatedAt)}
  2536â†’                    </span>
  2537â†’                  </div>
  2538â†’                  <div className="p-4 space-y-4">
  2539â†’                    {/* Summary */}
  2540â†’                    <div>
  2541â†’                      <h4 className="text-xs font-medium text-slate-500 uppercase tracking-wide mb-1.5">Summary</h4>
  2542â†’                      <p className="text-sm text-slate-700">{selectedCase.aiReview.payload.summary}</p>
  2543â†’                    </div>
  2544â†’
  2545â†’                    {/* Possible Causes */}
  2546â†’                    {selectedCase.aiReview.payload.possibleCauses?.length > 0 && (
  2547â†’                      <div>
  2548â†’                        <h4 className="text-xs font-medium text-slate-500 uppercase tracking-wide mb-1.5">Possible Causes</h4>
  2549â†’                        <ul className="text-sm text-slate-700 list-disc list-inside space-y-1">
  2550â†’                          {selectedCase.aiReview.payload.possibleCauses.map((cause, i) => (
  2551â†’                            <li key={i}>{cause}</li>
  2552â†’                          ))}
  2553â†’                        </ul>
  2554â†’                      </div>
  2555â†’                    )}
  2556â†’
  2557â†’                    {/* Recommended Steps */}
  2558â†’                    {selectedCase.aiReview.payload.recommendedSteps?.length > 0 && (
  2559â†’                      <div>
  2560â†’                        <h4 className="text-xs font-medium text-slate-500 uppercase tracking-wide mb-1.5">Recommended Next Steps</h4>
  2561â†’                        <ol className="text-sm text-slate-700 list-decimal list-inside space-y-1">
  2562â†’                          {selectedCase.aiReview.payload.recommendedSteps.map((step, i) => (
  2563â†’                            <li key={i}>{step}</li>
  2564â†’                          ))}
  2565â†’                        </ol>
  2566â†’                      </div>
  2567â†’                    )}
  2568â†’
  2569â†’                    {/* Warranty Considerations */}
  2570â†’                    {selectedCase.aiReview.payload.warrantyConsiderations?.length > 0 && (
  2571â†’                      <div>
  2572â†’                        <h4 className="text-xs font-medium text-slate-500 uppercase tracking-wide mb-1.5">Warranty Considerations</h4>
  2573â†’                        <ul className="text-sm text-slate-700 list-disc list-inside space-y-1">
  2574â†’                          {selectedCase.aiReview.payload.warrantyConsiderations.map((item, i) => (
  2575â†’                            <li key={i}>{item}</li>
  2576â†’                          ))}
  2577â†’                        </ul>
  2578â†’                      </div>
  2579â†’                    )}
  2580â†’
  2581â†’                    {/* Draft Customer Reply */}
  2582â†’                    {selectedCase.aiReview.payload.draftCustomerReply && (
  2583â†’                      <div>
  2584â†’                        <div className="flex justify-between items-center mb-1.5">
  2585â†’                          <h4 className="text-xs font-medium text-slate-500 uppercase tracking-wide">Draft Customer Reply</h4>
  2586â†’                          <button
  2587â†’                            className="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-[#0066CC] hover:text-[#0066CC] hover:bg-[#0066CC]/10 rounded transition-colors"
  2588â†’                            onClick={() => copyToClipboard(selectedCase.aiReview.payload.draftCustomerReply, "Customer reply")}
  2589â†’                          >
  2590â†’                            <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2591â†’                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
  2592â†’                            </svg>
  2593â†’                            Copy
  2594â†’                          </button>
  2595â†’                        </div>
  2596â†’                        <p className="text-sm bg-white p-3 rounded-lg border border-[#0066CC]/10 whitespace-pre-wrap text-slate-700">
  2597â†’                          {selectedCase.aiReview.payload.draftCustomerReply}
  2598â†’                        </p>
  2599â†’                      </div>
  2600â†’                    )}
  2601â†’
  2602â†’                    {/* Draft Internal Note */}
  2603â†’                    {selectedCase.aiReview.payload.draftInternalNote && (
  2604â†’                      <div>
  2605â†’                        <div className="flex justify-between items-center mb-1.5">
  2606â†’                          <h4 className="text-xs font-medium text-slate-500 uppercase tracking-wide">Draft Internal Note</h4>
  2607â†’                          <button
  2608â†’                            className="inline-flex items-center gap-1 px-2 py-1 text-xs font-medium text-[#0066CC] hover:text-[#0066CC] hover:bg-[#0066CC]/10 rounded transition-colors"
  2609â†’                            onClick={() => copyToClipboard(selectedCase.aiReview.payload.draftInternalNote, "Internal note")}
  2610â†’                          >
  2611â†’                            <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2612â†’                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
  2613â†’                            </svg>
  2614â†’                            Copy
  2615â†’                          </button>
  2616â†’                        </div>
  2617â†’                        <p className="text-sm bg-white p-3 rounded-lg border border-[#0066CC]/10 whitespace-pre-wrap text-slate-700">
  2618â†’                          {selectedCase.aiReview.payload.draftInternalNote}
  2619â†’                        </p>
  2620â†’                      </div>
  2621â†’                    )}
  2622â†’                  </div>
  2623â†’                </div>
  2624â†’              ) : (
  2625â†’                <div className="bg-slate-50 rounded-xl border border-slate-200 p-6 text-center">
  2626â†’                  <div className="w-10 h-10 mx-auto mb-3 rounded-full bg-slate-100 flex items-center justify-center text-lg">
  2627â†’                    ðŸ¤–
  2628â†’                  </div>
  2629â†’                  <p className="text-sm text-slate-500">
  2630â†’                    Click "Generate AI Review" to get AI-powered analysis of this case.
  2631â†’                  </p>
  2632â†’                </div>
  2633â†’              )}
  2634â†’
  2635â†’              {/* AI Diagnostics Panel */}
  2636â†’              <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
  2637â†’                <div className="px-4 py-3 border-b border-slate-100 flex items-center justify-between">
  2638â†’                  <h3 className="text-sm font-semibold text-slate-900">AI Diagnostics</h3>
  2639â†’                  <button
  2640â†’                    className="inline-flex items-center gap-1.5 px-2.5 py-1 text-xs font-medium text-slate-600 hover:text-slate-800 hover:bg-slate-100 rounded-md transition-colors"
  2641â†’                    onClick={fetchAIDiagnostics}
  2642â†’                    disabled={isLoadingDiagnostics}
  2643â†’                  >
  2644â†’                    {isLoadingDiagnostics ? (
  2645â†’                      <span className="w-3.5 h-3.5 border-2 border-slate-300 border-t-slate-600 rounded-full animate-spin"></span>
  2646â†’                    ) : aiDiagnostics ? (
  2647â†’                      <>
  2648â†’                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2649â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
  2650â†’                        </svg>
  2651â†’                        Refresh
  2652â†’                      </>
  2653â†’                    ) : (
  2654â†’                      <>
  2655â†’                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  2656â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
  2657â†’                        </svg>
  2658â†’                        Get Suggestions
  2659â†’                      </>
  2660â†’                    )}
  2661â†’                  </button>
  2662â†’                </div>
  2663â†’                {(aiDiagnostics || isLoadingDiagnostics) && (
  2664â†’                  <AISuggestionsPanel
  2665â†’                    suggestions={aiDiagnostics?.suggestions}
  2666â†’                    isLoading={isLoadingDiagnostics}
  2667â†’                    isDummy={aiDiagnostics?.isDummy}
  2668â†’                    errorCode={aiDiagnostics?.errorCode}
  2669â†’                    errorMessage={aiDiagnostics?.errorMessage}

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
