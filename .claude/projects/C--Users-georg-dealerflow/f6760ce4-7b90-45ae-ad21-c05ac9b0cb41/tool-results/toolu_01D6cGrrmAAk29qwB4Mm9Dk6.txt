     1→import { useState } from "react";
     2→import { signIn, getSession } from "next-auth/react";
     3→import { useRouter } from "next/router";
     4→import Head from "next/head";
     5→import Link from "next/link";
     6→
     7→export default function SignIn() {
     8→  const router = useRouter();
     9→  const { callbackUrl, error: urlError } = router.query;
    10→  const [email, setEmail] = useState("");
    11→  const [password, setPassword] = useState("");
    12→  const [loading, setLoading] = useState(false);
    13→  const [error, setError] = useState("");
    14→
    15→  // Only show dev login when explicitly enabled via env var (safe for production)
    16→  const isDevLoginEnabled = process.env.NEXT_PUBLIC_ENABLE_DEV_LOGIN === "true";
    17→
    18→  const handleLogin = async (e) => {
    19→    e.preventDefault();
    20→    setLoading(true);
    21→    setError("");
    22→
    23→    const result = await signIn("credentials", {
    24→      email,
    25→      password,
    26→      redirect: false,
    27→    });
    28→
    29→    if (result?.error) {
    30→      setError(result.error === "CredentialsSignin"
    31→        ? "Invalid email or password"
    32→        : `Sign in failed: ${result.error}`
    33→      );
    34→      setLoading(false);
    35→    } else if (result?.ok) {
    36→      // Get updated session to check dealer context
    37→      const session = await getSession();
    38→
    39→      // If user has no dealer, redirect to create-dealer onboarding
    40→      if (!session?.user?.dealerId) {
    41→        router.push("/onboarding/create-dealer");
    42→      } else {
    43→        // Redirect to callback URL or dashboard
    44→        router.push(callbackUrl || "/dashboard");
    45→      }
    46→    } else {
    47→      setError("Unknown error occurred");
    48→      setLoading(false);
    49→    }
    50→  };
    51→
    52→  return (
    53→    <>
    54→      <Head>
    55→        <title>Sign In | DealerFlow</title>
    56→      </Head>
    57→
    58→      <div className="min-h-screen bg-base-200 flex items-center justify-center p-4">
    59→        <div className="card bg-base-100 shadow-xl w-full max-w-md">
    60→          <div className="card-body">
    61→            {/* Header */}
    62→            <div className="text-center mb-6">
    63→              <Link href="/" className="inline-flex items-center justify-center gap-2 mb-2">
    64→                <svg className="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    65→                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h1.125c.621 0 1.129-.504 1.09-1.124a17.902 17.902 0 00-3.213-9.193 2.056 2.056 0 00-1.58-.86H14.25M16.5 18.75h-2.25m0-11.177v-.958c0-.568-.422-1.048-.987-1.106a48.554 48.554 0 00-10.026 0 1.106 1.106 0 00-.987 1.106v7.635m12-6.677v6.677m0 4.5v-4.5m0 0h-12" />
    66→                </svg>
    67→                <span className="text-xl font-bold">DealerFlow</span>
    68→              </Link>
    69→              <h1 className="text-2xl font-bold">Welcome Back</h1>
    70→              <p className="text-sm text-base-content/60 mt-1">Sign in to your account</p>
    71→            </div>
    72→
    73→            {/* Dev Login Banner - Only when NEXT_PUBLIC_ENABLE_DEV_LOGIN=true */}
    74→            {isDevLoginEnabled && (
    75→              <div className="bg-warning/10 border border-warning/30 rounded-lg p-4 mb-4">
    76→                <p className="text-xs text-warning font-medium mb-2">Dev Login Enabled</p>
    77→                <p className="text-xs text-base-content/60">Use any email with password: <code className="bg-base-200 px-1 rounded">test123</code></p>
    78→              </div>
    79→            )}
    80→
    81→            {/* URL Error */}
    82→            {urlError && (
    83→              <div className="alert alert-error text-sm py-2 mb-4">
    84→                {urlError === "OAuthAccountNotLinked"
    85→                  ? "This email is already registered with a different method."
    86→                  : `Error: ${urlError}`
    87→                }
    88→              </div>
    89→            )}
    90→
    91→            <form onSubmit={handleLogin} className="space-y-4">
    92→              {error && (
    93→                <div className="alert alert-error text-sm py-2">
    94→                  {error}
    95→                </div>
    96→              )}
    97→
    98→              <div className="form-control">
    99→                <label className="label">
   100→                  <span className="label-text">Email</span>
   101→                </label>
   102→                <input
   103→                  type="email"
   104→                  className="input input-bordered"
   105→                  placeholder="you@example.com"
   106→                  value={email}
   107→                  onChange={(e) => setEmail(e.target.value)}
   108→                  required
   109→                  autoComplete="email"
   110→                />
   111→              </div>
   112→
   113→              <div className="form-control">
   114→                <label className="label">
   115→                  <span className="label-text">Password</span>
   116→                </label>
   117→                <input
   118→                  type="password"
   119→                  className="input input-bordered"
   120→                  placeholder="••••••••"
   121→                  value={password}
   122→                  onChange={(e) => setPassword(e.target.value)}
   123→                  required
   124→                  autoComplete="current-password"
   125→                />
   126→              </div>
   127→
   128→              <button
   129→                type="submit"
   130→                className="btn btn-primary btn-block"
   131→                disabled={loading}
   132→              >
   133→                {loading ? (
   134→                  <span className="loading loading-spinner loading-sm"></span>
   135→                ) : (
   136→                  "Sign In"
   137→                )}
   138→              </button>
   139→            </form>
   140→
   141→            {/* Divider */}
   142→            <div className="divider text-xs text-base-content/50">or continue with</div>
   143→
   144→            {/* OAuth Providers */}
   145→            <div className="space-y-2">
   146→              <button
   147→                onClick={() => signIn("google", { callbackUrl: callbackUrl || "/dashboard" })}
   148→                className="btn btn-outline btn-block"
   149→              >
   150→                <svg className="w-5 h-5 mr-2" viewBox="0 0 24 24">
   151→                  <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
   152→                  <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
   153→                  <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
   154→                  <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
   155→                </svg>
   156→                Google
   157→              </button>
   158→            </div>
   159→
   160→            {/* Sign Up Link */}
   161→            <div className="text-center mt-6">
   162→              <p className="text-sm text-base-content/60">
   163→                Don't have an account?{" "}
   164→                <Link href="/auth/signup" className="text-primary hover:underline font-medium">
   165→                  Sign up
   166→                </Link>
   167→              </p>
   168→            </div>
   169→
   170→            {/* Back to Home */}
   171→            <div className="text-center mt-2">
   172→              <Link href="/" className="text-sm text-base-content/50 hover:text-base-content">
   173→                &larr; Back to home
   174→              </Link>
   175→            </div>
   176→          </div>
   177→        </div>
   178→      </div>
   179→    </>
   180→  );
   181→}
   182→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
