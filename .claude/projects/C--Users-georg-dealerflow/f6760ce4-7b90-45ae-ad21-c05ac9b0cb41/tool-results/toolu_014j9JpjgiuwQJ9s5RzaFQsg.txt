     1â†’import { useEffect, useState } from "react";
     2â†’import Head from "next/head";
     3â†’import Link from "next/link";
     4â†’import { useRouter } from "next/router";
     5â†’import { useSession } from "next-auth/react";
     6â†’import DashboardLayout from "@/components/DashboardLayout";
     7â†’import StatsCard from "@/components/StatsCard";
     8â†’
     9â†’// Human-readable form type labels
    10â†’const FORM_TYPE_LABELS = {
    11â†’  PDI: "PDI",
    12â†’  TEST_DRIVE: "Test Drive",
    13â†’  WARRANTY_CLAIM: "Warranty Claim",
    14â†’  COURTESY_OUT: "Courtesy Out",
    15â†’  COURTESY_IN: "Courtesy In",
    16â†’  SERVICE_RECEIPT: "Service",
    17â†’  REVIEW_FEEDBACK: "Feedback",
    18â†’  OTHER: "Other",
    19â†’};
    20â†’
    21â†’// Purpose-led icons for each form type (rounded, modern, single-weight)
    22â†’const FormTypeIcon = ({ type, className = "w-6 h-6" }) => {
    23â†’  const icons = {
    24â†’    // PDI - Checklist icon
    25â†’    PDI: (
    26â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    27â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
    28â†’      </svg>
    29â†’    ),
    30â†’    // Test Drive - Steering wheel
    31â†’    TEST_DRIVE: (
    32â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    33â†’        <circle cx="12" cy="12" r="9" strokeWidth={1.5} />
    34â†’        <circle cx="12" cy="12" r="3" strokeWidth={1.5} />
    35â†’        <path strokeLinecap="round" strokeWidth={1.5} d="M12 3v6M12 15v6M3 12h6M15 12h6" />
    36â†’      </svg>
    37â†’    ),
    38â†’    // Courtesy Out - Car with outward arrow
    39â†’    COURTESY_OUT: (
    40â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    41â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M8 17a2 2 0 100-4 2 2 0 000 4zM16 17a2 2 0 100-4 2 2 0 000 4z" />
    42â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4 13V11a1 1 0 011-1h2l2-3h6l2 3h2a1 1 0 011 1v2M6 13h12M17 6l3 3m0 0l-3 3m3-3H13" />
    43â†’      </svg>
    44â†’    ),
    45â†’    // Courtesy In - Car with inward arrow
    46â†’    COURTESY_IN: (
    47â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    48â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M8 17a2 2 0 100-4 2 2 0 000 4zM16 17a2 2 0 100-4 2 2 0 000 4z" />
    49â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M4 13V11a1 1 0 011-1h2l2-3h6l2 3h2a1 1 0 011 1v2M6 13h12M13 6l-3 3m0 0l3 3m-3-3h7" />
    50â†’      </svg>
    51â†’    ),
    52â†’    // Service Receipt - Wrench/spanner
    53â†’    SERVICE_RECEIPT: (
    54â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    55â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
    56â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    57â†’      </svg>
    58â†’    ),
    59â†’    // Feedback - Star rating
    60â†’    REVIEW_FEEDBACK: (
    61â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    62â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
    63â†’      </svg>
    64â†’    ),
    65â†’    // Delivery - Truck/handover
    66â†’    DELIVERY: (
    67â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    68â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 17a2 2 0 11-4 0 2 2 0 014 0zM19 17a2 2 0 11-4 0 2 2 0 014 0z" />
    69â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0" />
    70â†’      </svg>
    71â†’    ),
    72â†’    // Default - Generic form icon (for OTHER and unknown types)
    73â†’    DEFAULT: (
    74â†’      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
    75â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={1.5} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
    76â†’      </svg>
    77â†’    ),
    78â†’  };
    79â†’  return icons[type] || icons.DEFAULT;
    80â†’};
    81â†’
    82â†’// Default priority forms - PDI is always first as it's the most common daily task
    83â†’const DEFAULT_PRIORITY_FORM_TYPES = ["PDI", "TEST_DRIVE", "DELIVERY"];
    84â†’const ALWAYS_FIRST_FORM_TYPE = "PDI";
    85â†’// Customer-facing forms that should NOT appear in internal dashboard/quick forms
    86â†’const CUSTOMER_FACING_FORM_TYPES = ["WARRANTY_CLAIM"];
    87â†’
    88â†’// Needs Attention item configurations
    89â†’const NEEDS_ATTENTION_ITEMS = [
    90â†’  {
    91â†’    key: "soldInProgress",
    92â†’    label: "Sold in progress",
    93â†’    href: "/sales-prep",
    94â†’    color: "warning",
    95â†’    icon: (
    96â†’      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    97â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
    98â†’      </svg>
    99â†’    ),
   100â†’    description: "vehicles awaiting delivery"
   101â†’  },
   102â†’  {
   103â†’    key: "warrantyNotBookedIn",
   104â†’    label: "Warranty not booked in",
   105â†’    href: "/warranty",
   106â†’    color: "danger",
   107â†’    icon: (
   108â†’      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   109â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
   110â†’      </svg>
   111â†’    ),
   112â†’    description: "cases need scheduling"
   113â†’  },
   114â†’  {
   115â†’    key: "eventsToday",
   116â†’    label: "Events today",
   117â†’    href: "/calendar",
   118â†’    color: "info",
   119â†’    icon: (
   120â†’      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   121â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
   122â†’      </svg>
   123â†’    ),
   124â†’    description: "on your calendar"
   125â†’  },
   126â†’  {
   127â†’    key: "courtesyDueBack",
   128â†’    label: "Courtesy due back",
   129â†’    href: "/warranty",
   130â†’    color: "warning",
   131â†’    icon: (
   132â†’      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   133â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
   134â†’      </svg>
   135â†’    ),
   136â†’    description: "vehicles due today or overdue"
   137â†’  },
   138â†’  {
   139â†’    key: "motExpiringSoon",
   140â†’    label: "MOT expiring soon",
   141â†’    href: "/sales-prep",
   142â†’    color: "danger",
   143â†’    icon: (
   144â†’      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   145â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
   146â†’      </svg>
   147â†’    ),
   148â†’    description: "within 14 days"
   149â†’  },
   150â†’  {
   151â†’    key: "contactDue",
   152â†’    label: "Contact due",
   153â†’    href: "/warranty",
   154â†’    color: "warning",
   155â†’    icon: (
   156â†’      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   157â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
   158â†’      </svg>
   159â†’    ),
   160â†’    description: "warranty cases need follow-up"
   161â†’  },
   162â†’  {
   163â†’    key: "newWarrantyCases",
   164â†’    label: "New warranty cases",
   165â†’    href: "/warranty",
   166â†’    color: "info",
   167â†’    icon: (
   168â†’      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   169â†’        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" />
   170â†’      </svg>
   171â†’    ),
   172â†’    description: "created in last 48 hours"
   173â†’  }
   174â†’];
   175â†’
   176â†’// Color mappings for needs attention
   177â†’const ATTENTION_COLORS = {
   178â†’  warning: {
   179â†’    bg: "bg-gradient-to-br from-amber-50 to-orange-50",
   180â†’    border: "border-amber-200",
   181â†’    icon: "bg-amber-100 text-amber-600",
   182â†’    badge: "bg-amber-500 text-white",
   183â†’    text: "text-amber-900"
   184â†’  },
   185â†’  danger: {
   186â†’    bg: "bg-gradient-to-br from-red-50 to-rose-50",
   187â†’    border: "border-red-200",
   188â†’    icon: "bg-red-100 text-red-600",
   189â†’    badge: "bg-red-500 text-white",
   190â†’    text: "text-red-900"
   191â†’  },
   192â†’  info: {
   193â†’    bg: "bg-gradient-to-br from-blue-50 to-cyan-50",
   194â†’    border: "border-blue-200",
   195â†’    icon: "bg-blue-100 text-blue-600",
   196â†’    badge: "bg-blue-500 text-white",
   197â†’    text: "text-blue-900"
   198â†’  }
   199â†’};
   200â†’
   201â†’export default function Dashboard() {
   202â†’  const router = useRouter();
   203â†’  const { data: session, status } = useSession();
   204â†’  const [stats, setStats] = useState(null);
   205â†’  const [forms, setForms] = useState([]);
   206â†’  const [isLoading, setIsLoading] = useState(true);
   207â†’  const [redirectCheckComplete, setRedirectCheckComplete] = useState(false);
   208â†’
   209â†’  // Check if we should redirect to tenant URL (legacy route access)
   210â†’  useEffect(() => {
   211â†’    async function checkForTenantRedirect() {
   212â†’      // Skip if already on a tenant route
   213â†’      if (router.asPath.startsWith("/app/")) {
   214â†’        setRedirectCheckComplete(true);
   215â†’        return;
   216â†’      }
   217â†’
   218â†’      try {
   219â†’        const res = await fetch("/api/dealers/memberships");
   220â†’        if (!res.ok) {
   221â†’          setRedirectCheckComplete(true);
   222â†’          return;
   223â†’        }
   224â†’
   225â†’        const dealers = await res.json();
   226â†’
   227â†’        if (dealers.length === 0) {
   228â†’          // No dealers - redirect to create dealer
   229â†’          router.push("/onboarding/create-dealer");
   230â†’          return;
   231â†’        }
   232â†’
   233â†’        if (dealers.length === 1) {
   234â†’          // Single dealer - redirect to tenant route (skip fetching stats here)
   235â†’          router.replace(`/app/${dealers[0].slug}/dashboard`);
   236â†’          return;
   237â†’        }
   238â†’
   239â†’        if (dealers.length > 1) {
   240â†’          // Multiple dealers - show picker
   241â†’          router.push("/choose-dealer");
   242â†’          return;
   243â†’        }
   244â†’      } catch (err) {
   245â†’        console.error("Error checking dealer redirect:", err);
   246â†’        setRedirectCheckComplete(true);
   247â†’      }
   248â†’    }
   249â†’
   250â†’    if (session) {
   251â†’      checkForTenantRedirect();
   252â†’    } else if (status === "unauthenticated") {
   253â†’      // Not logged in, don't wait for redirect check
   254â†’      setRedirectCheckComplete(true);
   255â†’    }
   256â†’  }, [session, status, router]);
   257â†’
   258â†’  const defaultStats = {
   259â†’    appraisals: { total: 0, pending: 0 },
   260â†’    vehicles: { total: 0, inStock: 0, inPrep: 0, live: 0, delivered: 0 },
   261â†’    aftercare: { total: 0, open: 0 },
   262â†’    reviews: { count: 0, avgRating: "N/A", lastReviewDays: null },
   263â†’    forms: { total: 0, submissions: 0 },
   264â†’    recent: { appraisals: [], vehicles: [], formSubmissions: [] },
   265â†’    needsAttention: { soldInProgress: 0, warrantyNotBookedIn: 0, eventsToday: 0, courtesyDueBack: 0, motExpiringSoon: 0, contactDue: 0, newWarrantyCases: 0 },
   266â†’    today: { events: 0, deliveries: 0, testDrives: 0, courtesyDueBack: 0 },
   267â†’    topForms: [],
   268â†’    oldestAppraisalDays: null,
   269â†’  };
   270â†’
   271â†’  // Only fetch stats after redirect check is complete (prevents double fetch)
   272â†’  useEffect(() => {
   273â†’    // Skip if we're still checking for redirects or going to redirect
   274â†’    if (!redirectCheckComplete) return;
   275â†’
   276â†’    const safeJsonParse = async (res) => {
   277â†’      const contentType = res.headers.get("content-type") || "";
   278â†’      if (!contentType.includes("application/json")) {
   279â†’        console.error("[Dashboard] Non-JSON response:", res.status, contentType);
   280â†’        return null;
   281â†’      }
   282â†’      return res.json();
   283â†’    };
   284â†’
   285â†’    fetch("/api/dashboard/stats")
   286â†’      .then(async (res) => {
   287â†’        if (res.status === 403) return { error: "No dealer context" };
   288â†’        if (!res.ok) return { error: "Failed to fetch stats" };
   289â†’        return await safeJsonParse(res) || { error: "Invalid response" };
   290â†’      })
   291â†’      .then((statsData) => {
   292â†’        if (statsData?.error) {
   293â†’          console.error("Dashboard stats error:", statsData.error);
   294â†’          setStats(defaultStats);
   295â†’          setForms([]);
   296â†’        } else {
   297â†’          setStats(statsData || defaultStats);
   298â†’          setForms(Array.isArray(statsData?.formsList) ? statsData.formsList : []);
   299â†’        }
   300â†’        setIsLoading(false);
   301â†’      })
   302â†’      .catch((err) => {
   303â†’        console.error("Dashboard fetch error:", err);
   304â†’        setStats(defaultStats);
   305â†’        setForms([]);
   306â†’        setIsLoading(false);
   307â†’      });
   308â†’  }, [redirectCheckComplete]);
   309â†’
   310â†’  const handleFormClick = (form) => {
   311â†’    if (form.isPublic && form.publicSlug) {
   312â†’      window.open(`/public/forms/${form.publicSlug}`, '_blank');
   313â†’    } else {
   314â†’      router.push(`/forms/fill/${form.id || form._id}`);
   315â†’    }
   316â†’  };
   317â†’
   318â†’  // Filter out customer-facing forms from internal dashboard
   319â†’  const internalForms = forms.filter(f => !CUSTOMER_FACING_FORM_TYPES.includes(f.type));
   320â†’
   321â†’  const getTopForms = () => {
   322â†’    const pdiForm = internalForms.find(f => f.type === ALWAYS_FIRST_FORM_TYPE);
   323â†’    let otherTopForms = [];
   324â†’    if (stats?.topForms?.length > 0) {
   325â†’      otherTopForms = stats.topForms
   326â†’        .map(tf => internalForms.find(f => (f.id || f._id?.toString?.() || f._id) === (tf.formId?.toString?.() || tf.formId)))
   327â†’        .filter(f => f && f.type !== ALWAYS_FIRST_FORM_TYPE)
   328â†’        .slice(0, 2);
   329â†’    } else {
   330â†’      otherTopForms = internalForms.filter(f => DEFAULT_PRIORITY_FORM_TYPES.includes(f.type) && f.type !== ALWAYS_FIRST_FORM_TYPE).slice(0, 2);
   331â†’    }
   332â†’    return pdiForm ? [pdiForm, ...otherTopForms] : otherTopForms;
   333â†’  };
   334â†’
   335â†’  const topForms = getTopForms();
   336â†’  const otherForms = internalForms.filter(f => !topForms.find(tf => (tf.id || tf._id?.toString?.() || tf._id) === (f.id || f._id?.toString?.() || f._id)));
   337â†’
   338â†’  const activeNeedsAttention = NEEDS_ATTENTION_ITEMS.filter(item =>
   339â†’    stats?.needsAttention?.[item.key] > 0
   340â†’  );
   341â†’
   342â†’  const hasTodayData = stats?.today && (
   343â†’    stats.today.events > 0 ||
   344â†’    stats.today.deliveries > 0 ||
   345â†’    stats.today.testDrives > 0 ||
   346â†’    stats.today.courtesyDueBack > 0
   347â†’  );
   348â†’
   349â†’  return (
   350â†’    <DashboardLayout>
   351â†’      <Head><title>Dashboard | DealerFlow</title></Head>
   352â†’
   353â†’      {/* Hero Header with Rich Gradient */}
   354â†’      <div className="relative -mx-4 -mt-4 md:-mx-6 md:-mt-6 px-4 md:px-6 pt-8 pb-10 mb-8 hero-gradient border-b border-slate-200/50">
   355â†’        <div className="max-w-7xl mx-auto">
   356â†’          <div className="flex items-start justify-between">
   357â†’            <div>
   358â†’              <h1 className="text-2xl md:text-3xl font-extrabold text-slate-900 tracking-tight">
   359â†’                Good {new Date().getHours() < 12 ? 'morning' : new Date().getHours() < 17 ? 'afternoon' : 'evening'}
   360â†’              </h1>
   361â†’              <p className="text-slate-600 mt-1.5 text-base">Here's what's happening with your dealership today</p>
   362â†’            </div>
   363â†’            <div className="hidden md:flex items-center gap-3">
   364â†’              <div className="text-right">
   365â†’                <p className="text-sm font-bold text-slate-800">
   366â†’                  {new Date().toLocaleDateString('en-GB', { weekday: 'long' })}
   367â†’                </p>
   368â†’                <p className="text-xs text-slate-500">
   369â†’                  {new Date().toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })}
   370â†’                </p>
   371â†’              </div>
   372â†’              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-[#0066CC] to-[#14B8A6] flex items-center justify-center text-white shadow-lg">
   373â†’                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   374â†’                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
   375â†’                </svg>
   376â†’              </div>
   377â†’            </div>
   378â†’          </div>
   379â†’
   380â†’          {/* Today's Activity Pills */}
   381â†’          {hasTodayData && (
   382â†’            <div className="mt-6 flex items-center gap-3 flex-wrap">
   383â†’              <span className="text-xs font-bold text-slate-500 uppercase tracking-wider">Today</span>
   384â†’              <div className="h-4 w-px bg-slate-300" />
   385â†’              <div className="flex items-center gap-2 flex-wrap">
   386â†’                {(stats?.today?.events ?? 0) > 0 && (
   387â†’                  <Link href="/calendar" className="inline-flex items-center gap-2 px-4 py-2 bg-white border border-[#0066CC]/20 text-[#0066CC] rounded-xl text-sm font-semibold hover:bg-[#0066CC]/5 hover:border-[#0066CC]/40 transition-all shadow-sm">
   388â†’                    <span className="w-2.5 h-2.5 rounded-full bg-[#0066CC] animate-pulse" />
   389â†’                    {stats.today.events} event{stats.today.events !== 1 ? "s" : ""}
   390â†’                  </Link>
   391â†’                )}
   392â†’                {(stats?.today?.deliveries ?? 0) > 0 && (
   393â†’                  <Link href="/calendar" className="inline-flex items-center gap-2 px-4 py-2 bg-white border border-emerald-200 text-emerald-700 rounded-xl text-sm font-semibold hover:bg-emerald-50 transition-all shadow-sm">
   394â†’                    <span className="w-2.5 h-2.5 rounded-full bg-emerald-500" />
   395â†’                    {stats.today.deliveries} deliver{stats.today.deliveries !== 1 ? "ies" : "y"}
   396â†’                  </Link>
   397â†’                )}
   398â†’                {(stats?.today?.testDrives ?? 0) > 0 && (
   399â†’                  <Link href="/calendar" className="inline-flex items-center gap-2 px-4 py-2 bg-white border border-cyan-200 text-cyan-700 rounded-xl text-sm font-semibold hover:bg-cyan-50 transition-all shadow-sm">
   400â†’                    <span className="w-2.5 h-2.5 rounded-full bg-cyan-500" />
   401â†’                    {stats.today.testDrives} test drive{stats.today.testDrives !== 1 ? "s" : ""}
   402â†’                  </Link>
   403â†’                )}
   404â†’                {(stats?.today?.courtesyDueBack ?? 0) > 0 && (
   405â†’                  <Link href="/warranty" className="inline-flex items-center gap-2 px-4 py-2 bg-white border border-amber-200 text-amber-700 rounded-xl text-sm font-semibold hover:bg-amber-50 transition-all shadow-sm">
   406â†’                    <span className="w-2.5 h-2.5 rounded-full bg-amber-500" />
   407â†’                    {stats.today.courtesyDueBack} courtesy due
   408â†’                  </Link>
   409â†’                )}
   410â†’              </div>
   411â†’            </div>
   412â†’          )}
   413â†’        </div>
   414â†’      </div>
   415â†’
   416â†’      {isLoading ? (
   417â†’        <div className="flex justify-center py-20">
   418â†’          <div className="flex flex-col items-center gap-4">
   419â†’            <div className="w-12 h-12 border-4 border-[#0066CC]/20 border-t-[#0066CC] rounded-full animate-spin" />
   420â†’            <p className="text-sm text-slate-500 font-medium">Loading dashboard...</p>
   421â†’          </div>
   422â†’        </div>
   423â†’      ) : (
   424â†’        <div className="space-y-8">
   425â†’
   426â†’          {/* KPI Cards Row - Mixed Variants */}
   427â†’          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5">
   428â†’            <StatsCard
   429â†’              title="Pending Appraisals"
   430â†’              value={stats?.appraisals?.pending ?? 0}
   431â†’              trend={typeof stats?.oldestAppraisalDays === "number" ? `Oldest: ${stats.oldestAppraisalDays}d` : null}
   432â†’              icon="ðŸ“‹"
   433â†’              color="primary"
   434â†’              variant="gradient"
   435â†’            />
   436â†’            <StatsCard
   437â†’              title="Total Stock"
   438â†’              value={(stats?.vehicles?.inStock ?? 0) + (stats?.vehicles?.inPrep ?? 0)}
   439â†’              trend={stats?.vehicles?.inPrep > 0 ? `${stats.vehicles.inPrep} in prep` : null}
   440â†’              icon="ðŸš—"
   441â†’              color="secondary"
   442â†’              variant="gradient"
   443â†’            />
   444â†’            <StatsCard
   445â†’              title="Sold in Progress"
   446â†’              value={stats?.vehicles?.live ?? 0}
   447â†’              trend="Awaiting delivery"
   448â†’              icon="ðŸ“¦"
   449â†’              color="warning"
   450â†’              variant="outlined"
   451â†’            />
   452â†’            <StatsCard
   453â†’              title="Total Sold"
   454â†’              value={stats?.vehicles?.delivered ?? 0}
   455â†’              trend="Delivered to customers"
   456â†’              icon="ðŸ†"
   457â†’              color="success"
   458â†’              variant="gradient"
   459â†’            />
   460â†’          </div>
   461â†’
   462â†’          {/* Quick Forms Section */}
   463â†’          {forms.length > 0 && (
   464â†’            <div className="bg-white rounded-2xl shadow-md border border-slate-100 p-6">
   465â†’              <div className="flex items-center justify-between mb-5">
   466â†’                <div className="flex items-center gap-3">
   467â†’                  <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-500 flex items-center justify-center text-white shadow-lg">
   468â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   469â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
   470â†’                    </svg>
   471â†’                  </div>
   472â†’                  <div>
   473â†’                    <h2 className="text-lg font-bold text-slate-900">Quick Forms</h2>
   474â†’                    <p className="text-xs text-slate-500">Launch frequently used forms</p>
   475â†’                  </div>
   476â†’                </div>
   477â†’                <Link href="/forms" className="text-sm text-[#0066CC] hover:text-[#0055BB] font-semibold transition-colors flex items-center gap-1">
   478â†’                  All Submissions
   479â†’                  <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   480â†’                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
   481â†’                  </svg>
   482â†’                </Link>
   483â†’              </div>
   484â†’              <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
   485â†’                {topForms.map((form) => (
   486â†’                  <button
   487â†’                    key={form.id || form._id}
   488â†’                    onClick={() => handleFormClick(form)}
   489â†’                    className="group bg-gradient-to-br from-slate-50 to-white border-2 border-slate-200 p-5 rounded-xl flex flex-col items-center gap-3 hover:border-[#0066CC] hover:shadow-lg hover:scale-[1.02] transition-all cursor-pointer"
   490â†’                  >
   491â†’                    <div className="w-12 h-12 rounded-xl bg-[#0066CC]/10 text-[#0066CC] flex items-center justify-center group-hover:bg-[#0066CC] group-hover:text-white transition-colors">
   492â†’                      <FormTypeIcon type={form.type} className="w-6 h-6" />
   493â†’                    </div>
   494â†’                    <span className="font-bold text-slate-700 text-sm text-center">
   495â†’                      {FORM_TYPE_LABELS[form.type] || form.name}
   496â†’                    </span>
   497â†’                  </button>
   498â†’                ))}
   499â†’                {otherForms.length > 0 && (
   500â†’                  <div className="dropdown dropdown-end">
   501â†’                    <label
   502â†’                      tabIndex={0}
   503â†’                      className="group bg-slate-100 border-2 border-dashed border-slate-300 p-5 rounded-xl flex flex-col items-center gap-3 hover:border-slate-400 hover:bg-slate-50 transition-all cursor-pointer w-full"
   504â†’                    >
   505â†’                      <div className="w-12 h-12 rounded-xl bg-slate-200 text-slate-500 flex items-center justify-center">
   506â†’                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   507â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z" />
   508â†’                        </svg>
   509â†’                      </div>
   510â†’                      <span className="font-bold text-slate-500 text-sm">+{otherForms.length} More</span>
   511â†’                    </label>
   512â†’                    <div tabIndex={0} className="dropdown-content z-20 shadow-2xl bg-white rounded-xl w-64 border border-slate-200 mt-2 overflow-hidden">
   513â†’                      <div className="px-4 py-3 border-b border-slate-100 bg-gradient-to-r from-slate-50 to-white">
   514â†’                        <p className="text-xs font-bold text-slate-500 uppercase tracking-wide">All Forms</p>
   515â†’                      </div>
   516â†’                      <div className="max-h-64 overflow-y-auto">
   517â†’                        {otherForms.map((form) => (
   518â†’                          <button
   519â†’                            key={form.id || form._id}
   520â†’                            onClick={() => handleFormClick(form)}
   521â†’                            className="w-full flex items-center gap-3 px-4 py-3 text-sm font-medium text-slate-700 hover:bg-[#0066CC]/5 hover:text-[#0066CC] transition-colors border-b border-slate-50 last:border-0"
   522â†’                          >
   523â†’                            <div className="w-8 h-8 rounded-lg bg-slate-100 flex items-center justify-center flex-shrink-0 text-slate-500">
   524â†’                              <FormTypeIcon type={form.type} className="w-4 h-4" />
   525â†’                            </div>
   526â†’                            <span className="truncate">{FORM_TYPE_LABELS[form.type] || form.name}</span>
   527â†’                          </button>
   528â†’                        ))}
   529â†’                      </div>
   530â†’                    </div>
   531â†’                  </div>
   532â†’                )}
   533â†’              </div>
   534â†’            </div>
   535â†’          )}
   536â†’
   537â†’          {/* Middle Row - Needs Attention + Quick Actions */}
   538â†’          <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
   539â†’            {/* Needs Attention - Modern Card Layout */}
   540â†’            <div className="lg:col-span-2">
   541â†’              <div className="bg-white rounded-2xl shadow-md border border-slate-100 overflow-hidden">
   542â†’                <div className="flex items-center gap-3 px-6 py-4 border-b border-slate-100 bg-gradient-to-r from-red-50/50 to-amber-50/50">
   543â†’                  <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-amber-500 flex items-center justify-center text-white shadow-lg">
   544â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   545â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
   546â†’                    </svg>
   547â†’                  </div>
   548â†’                  <div>
   549â†’                    <h2 className="text-lg font-bold text-slate-900">Needs Attention</h2>
   550â†’                    <p className="text-xs text-slate-500">Items requiring your immediate action</p>
   551â†’                  </div>
   552â†’                </div>
   553â†’                {activeNeedsAttention.length > 0 ? (
   554â†’                  <div className="p-4 grid grid-cols-1 md:grid-cols-2 gap-3">
   555â†’                    {activeNeedsAttention.map((item) => {
   556â†’                      const colors = ATTENTION_COLORS[item.color];
   557â†’                      return (
   558â†’                        <Link
   559â†’                          key={item.key}
   560â†’                          href={item.href}
   561â†’                          className={`${colors.bg} ${colors.border} border rounded-xl p-4 hover:shadow-md transition-all group`}
   562â†’                        >
   563â†’                          <div className="flex items-start gap-3">
   564â†’                            <div className={`w-10 h-10 rounded-xl ${colors.icon} flex items-center justify-center flex-shrink-0`}>
   565â†’                              {item.icon}
   566â†’                            </div>
   567â†’                            <div className="flex-1 min-w-0">
   568â†’                              <div className="flex items-center gap-2 mb-1">
   569â†’                                <span className={`${colors.badge} px-2 py-0.5 rounded-full text-xs font-bold`}>
   570â†’                                  {stats?.needsAttention?.[item.key] ?? 0}
   571â†’                                </span>
   572â†’                                <span className={`text-sm font-bold ${colors.text}`}>{item.label}</span>
   573â†’                              </div>
   574â†’                              <p className="text-xs text-slate-600">{item.description}</p>
   575â†’                            </div>
   576â†’                            <svg className="w-5 h-5 text-slate-300 group-hover:text-slate-500 transition-colors flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   577â†’                              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
   578â†’                            </svg>
   579â†’                          </div>
   580â†’                        </Link>
   581â†’                      );
   582â†’                    })}
   583â†’                  </div>
   584â†’                ) : (
   585â†’                  <div className="p-8 flex items-center justify-center">
   586â†’                    <div className="text-center">
   587â†’                      <div className="w-16 h-16 bg-gradient-to-br from-emerald-100 to-teal-100 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-inner">
   588â†’                        <svg className="w-8 h-8 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   589â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
   590â†’                        </svg>
   591â†’                      </div>
   592â†’                      <p className="text-lg font-bold text-emerald-700">All clear!</p>
   593â†’                      <p className="text-sm text-emerald-600/70 mt-1">Nothing needs attention right now</p>
   594â†’                    </div>
   595â†’                  </div>
   596â†’                )}
   597â†’              </div>
   598â†’            </div>
   599â†’
   600â†’            {/* Quick Actions - Command Palette Style */}
   601â†’            <div className="bg-white rounded-2xl shadow-md border border-slate-100 p-6">
   602â†’              <div className="flex items-center gap-3 mb-5">
   603â†’                <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-[#0066CC] to-[#0EA5E9] flex items-center justify-center text-white shadow-lg">
   604â†’                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   605â†’                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
   606â†’                  </svg>
   607â†’                </div>
   608â†’                <div>
   609â†’                  <h2 className="text-lg font-bold text-slate-900">Quick Actions</h2>
   610â†’                  <p className="text-xs text-slate-500">Shortcuts to common tasks</p>
   611â†’                </div>
   612â†’              </div>
   613â†’              <div className="space-y-3">
   614â†’                <Link href="/sales-prep" className="action-card">
   615â†’                  <div className="w-10 h-10 rounded-xl bg-[#0066CC]/10 text-[#0066CC] flex items-center justify-center">
   616â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   617â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
   618â†’                    </svg>
   619â†’                  </div>
   620â†’                  <div className="flex-1">
   621â†’                    <span className="font-bold text-slate-800 block">Add Vehicle</span>
   622â†’                    <span className="text-xs text-slate-500">Add to stock</span>
   623â†’                  </div>
   624â†’                </Link>
   625â†’
   626â†’                <Link href="/appraisals/new" className="action-card">
   627â†’                  <div className="w-10 h-10 rounded-xl bg-[#14B8A6]/10 text-[#14B8A6] flex items-center justify-center">
   628â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   629â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
   630â†’                    </svg>
   631â†’                  </div>
   632â†’                  <div className="flex-1">
   633â†’                    <span className="font-bold text-slate-800 block">New Appraisal</span>
   634â†’                    <span className="text-xs text-slate-500">Value a vehicle</span>
   635â†’                  </div>
   636â†’                </Link>
   637â†’
   638â†’                <Link href="/forms" className="action-card">
   639â†’                  <div className="w-10 h-10 rounded-xl bg-amber-100 text-amber-600 flex items-center justify-center">
   640â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   641â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
   642â†’                    </svg>
   643â†’                  </div>
   644â†’                  <div className="flex-1">
   645â†’                    <span className="font-bold text-slate-800 block">View Submissions</span>
   646â†’                    <span className="text-xs text-slate-500">Review form data</span>
   647â†’                  </div>
   648â†’                </Link>
   649â†’
   650â†’                <Link href="/warranty?addCase=1" className="action-card">
   651â†’                  <div className="w-10 h-10 rounded-xl bg-orange-100 text-orange-600 flex items-center justify-center">
   652â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   653â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
   654â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
   655â†’                    </svg>
   656â†’                  </div>
   657â†’                  <div className="flex-1">
   658â†’                    <span className="font-bold text-slate-800 block">Add Aftersales Case</span>
   659â†’                    <span className="text-xs text-slate-500">Log warranty issue</span>
   660â†’                  </div>
   661â†’                </Link>
   662â†’              </div>
   663â†’            </div>
   664â†’          </div>
   665â†’
   666â†’          {/* Bottom Row - Recent Activity Cards */}
   667â†’          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
   668â†’            {/* Recent Appraisals */}
   669â†’            <div className="bg-white rounded-2xl shadow-md border border-slate-100 overflow-hidden">
   670â†’              <div className="flex items-center justify-between px-6 py-4 border-b border-slate-100">
   671â†’                <div className="flex items-center gap-3">
   672â†’                  <div className="w-10 h-10 rounded-xl bg-[#0066CC]/10 text-[#0066CC] flex items-center justify-center">
   673â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   674â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
   675â†’                    </svg>
   676â†’                  </div>
   677â†’                  <h3 className="text-lg font-bold text-slate-900">Recent Appraisals</h3>
   678â†’                </div>
   679â†’                <Link href="/appraisals" className="text-xs font-bold text-[#0066CC] uppercase tracking-wide hover:underline flex items-center gap-1">
   680â†’                  View All
   681â†’                  <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   682â†’                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
   683â†’                  </svg>
   684â†’                </Link>
   685â†’              </div>
   686â†’
   687â†’              {stats?.recent?.appraisals?.length > 0 ? (
   688â†’                <div className="divide-y divide-slate-100">
   689â†’                  {stats.recent.appraisals.slice(0, 5).map((a) => (
   690â†’                    <div
   691â†’                      key={a.id}
   692â†’                      onClick={() => router.push(`/appraisals/${a.id}`)}
   693â†’                      className="flex items-center gap-4 px-6 py-4 hover:bg-slate-50 transition-colors cursor-pointer"
   694â†’                    >
   695â†’                      <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-slate-100 to-slate-50 flex items-center justify-center border border-slate-200">
   696â†’                        <span className="font-mono text-xs font-bold text-slate-600">{a.vehicleReg?.slice(0, 4)}</span>
   697â†’                      </div>
   698â†’                      <div className="flex-1 min-w-0">
   699â†’                        <p className="font-bold text-slate-800 text-sm">{a.vehicleReg}</p>
   700â†’                        <p className="text-xs text-slate-500 truncate">{a.contactId?.name || "No contact"}</p>
   701â†’                      </div>
   702â†’                      <span className={`px-3 py-1 rounded-full text-xs font-bold ${
   703â†’                        a.decision === "purchased" || a.decision === "converted"
   704â†’                          ? "bg-emerald-100 text-emerald-700"
   705â†’                          : a.decision === "not_purchased" || a.decision === "declined"
   706â†’                          ? "bg-red-100 text-red-700"
   707â†’                          : "bg-amber-100 text-amber-700"
   708â†’                      }`}>
   709â†’                        {a.decision}
   710â†’                      </span>
   711â†’                    </div>
   712â†’                  ))}
   713â†’                </div>
   714â†’              ) : (
   715â†’                <div className="flex items-center justify-center py-12">
   716â†’                  <div className="text-center">
   717â†’                    <div className="w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center mx-auto mb-3">
   718â†’                      <svg className="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   719â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
   720â†’                      </svg>
   721â†’                    </div>
   722â†’                    <p className="text-slate-500 text-sm font-medium">No appraisals yet</p>
   723â†’                  </div>
   724â†’                </div>
   725â†’              )}
   726â†’            </div>
   727â†’
   728â†’            {/* Pending Prep */}
   729â†’            <div className="bg-white rounded-2xl shadow-md border border-slate-100 overflow-hidden">
   730â†’              <div className="flex items-center justify-between px-6 py-4 border-b border-slate-100">
   731â†’                <div className="flex items-center gap-3">
   732â†’                  <div className="w-10 h-10 rounded-xl bg-[#14B8A6]/10 text-[#14B8A6] flex items-center justify-center">
   733â†’                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   734â†’                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
   735â†’                    </svg>
   736â†’                  </div>
   737â†’                  <h3 className="text-lg font-bold text-slate-900">Pending Prep</h3>
   738â†’                </div>
   739â†’                <Link href="/sales-prep" className="text-xs font-bold text-[#0066CC] uppercase tracking-wide hover:underline flex items-center gap-1">
   740â†’                  View All
   741â†’                  <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   742â†’                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
   743â†’                  </svg>
   744â†’                </Link>
   745â†’              </div>
   746â†’
   747â†’              {stats?.recent?.vehicles?.length > 0 ? (
   748â†’                <div className="divide-y divide-slate-100">
   749â†’                  {stats.recent.vehicles.slice(0, 5).map((v) => (
   750â†’                    <div
   751â†’                      key={v.id}
   752â†’                      onClick={() => router.push("/sales-prep")}
   753â†’                      className="flex items-center gap-4 px-6 py-4 hover:bg-slate-50 transition-colors cursor-pointer"
   754â†’                    >
   755â†’                      <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-100 to-yellow-50 flex items-center justify-center border border-amber-200">
   756â†’                        <svg className="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   757â†’                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h8m-8 4h8m-8 4h4m-7 4h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
   758â†’                        </svg>
   759â†’                      </div>
   760â†’                      <div className="flex-1 min-w-0">
   761â†’                        <p className="font-bold text-slate-800 text-sm">{v.make} {v.model}</p>
   762â†’                        <p className="text-xs text-slate-500">{v.regCurrent}</p>
   763â†’                      </div>
   764â†’                      <span className={`px-3 py-1 rounded-full text-xs font-bold ${
   765â†’                        v.status === "delivered"
   766â†’                          ? "bg-slate-100 text-slate-600"
   767â†’                          : v.status === "live"
   768â†’                          ? "bg-emerald-100 text-emerald-700"
   769â†’                          : v.status === "in_prep"
   770â†’                          ? "bg-amber-100 text-amber-700"
   771â†’                          : "bg-blue-100 text-blue-700"
   772â†’                      }`}>
   773â†’                        {v.status.replace("_", " ")}
   774â†’                      </span>
   775â†’                    </div>
   776â†’                  ))}
   777â†’                </div>
   778â†’              ) : (
   779â†’                <div className="flex items-center justify-center py-12">
   780â†’                  <div className="text-center">
   781â†’                    <div className="w-12 h-12 rounded-xl bg-slate-100 flex items-center justify-center mx-auto mb-3">
   782â†’                      <svg className="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
   783â†’                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h8m-8 4h8m-8 4h4m-7 4h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
   784â†’                      </svg>
   785â†’                    </div>
   786â†’                    <p className="text-slate-500 text-sm font-medium">No vehicles yet</p>
   787â†’                  </div>
   788â†’                </div>
   789â†’              )}
   790â†’            </div>
   791â†’          </div>
   792â†’        </div>
   793â†’      )}
   794â†’    </DashboardLayout>
   795â†’  );
   796â†’}
   797â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
