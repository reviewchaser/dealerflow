  1070→            }))}
  1071→            activeStage={mobileActiveColumn}
  1072→            onStageChange={setMobileActiveColumn}
  1073→            className="mb-4"
  1074→          />
  1075→
  1076→          {/* Mobile Single Column View */}
  1077→          <div className="md:hidden">
  1078→            {COLUMNS.filter(col => col.key === mobileActiveColumn).map((col) => {
  1079→              const columnCases = getCasesByStatus(col.key);
  1080→              return (
  1081→                <div key={col.key} className="space-y-3">
  1082→                  {columnCases.map((caseItem) => {
  1083→                    const daysOpen = daysSince(caseItem.createdAt);
  1084→                    const priority = caseItem.priority || "normal";
  1085→                    const priorityStyle = PRIORITIES[priority] || PRIORITIES.normal;
  1086→                    const locationType = caseItem.repairLocationType || "WITH_CUSTOMER";
  1087→                    const locationStyle = REPAIR_LOCATION_STYLES[locationType] || REPAIR_LOCATION_STYLES.WITH_CUSTOMER;
  1088→                    const attachmentCount = (caseItem.submissionAttachmentCount || 0) + (caseItem.commentAttachmentCount || 0);
  1089→                    const activityCount = (caseItem.comments?.length || 0) + (caseItem.events?.length || 0);
  1090→
  1091→                    return (
  1092→                      <div
  1093→                        key={caseItem.id || caseItem._id}
  1094→                        className="bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow border border-slate-100/50 overflow-hidden active:scale-[0.98]"
  1095→                        onClick={() => {
  1096→                          const id = caseItem.id || caseItem._id;
  1097→                          fetchCaseDetail(id);
  1098→                        }}
  1099→                      >
  1100→                        <div className={`border-l-4 ${col.accent}`}>
  1101→                          <div className="p-4">
  1102→                            {/* Top row: Reg + badges */}
  1103→                            <div className="flex justify-between items-start mb-2">
  1104→                              <div className="flex-1 min-w-0">
  1105→                                <div className="flex items-center gap-1.5 flex-wrap">
  1106→                                  <span className="inline-block bg-[#fcd34d] border border-yellow-500/50 rounded-md px-2 py-0.5 shadow-sm font-mono font-bold text-slate-900 text-xs tracking-wider uppercase">
  1107→                                    {caseItem.regAtPurchase || caseItem.details?.vehicleReg || "NO REG"}
  1108→                                  </span>
  1109→                                  <span className={`inline-flex items-center px-1.5 py-0.5 rounded text-[9px] font-semibold ${locationStyle.bg} ${locationStyle.text}`}>
  1110→                                    {REPAIR_LOCATION_LABELS[locationType]}
  1111→                                  </span>
  1112→                                  <span className={`inline-flex items-center px-2 py-0.5 rounded-full text-[10px] font-semibold ${priorityStyle.bg} ${priorityStyle.text} border ${priorityStyle.border}`}>
  1113→                                    {priority.charAt(0).toUpperCase() + priority.slice(1)}
  1114→                                  </span>
  1115→                                </div>
  1116→                              </div>
  1117→                            </div>
  1118→
  1119→                            {/* Customer name + Vehicle make/model */}
  1120→                            <div className="mb-2">
  1121→                              <p className="font-semibold text-slate-900 text-sm truncate">
  1122→                                {caseItem.contactId?.name || "Unknown"}
  1123→                              </p>
  1124→                              {caseItem.vehicleId && (
  1125→                                <p className="text-xs text-slate-500">
  1126→                                  {caseItem.vehicleId.make} {caseItem.vehicleId.model}
  1127→                                </p>
  1128→                              )}
  1129→                            </div>
  1130→
  1131→                            {/* Booked date row */}
  1132→                            {caseItem.bookedInAt && (
  1133→                              <div className="flex items-center gap-1 mb-1.5 text-xs text-amber-700">
  1134→                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1135→                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
  1136→                                </svg>
  1137→                                <span className="font-medium">Booked: {formatBookedDate(caseItem.bookedInAt)}</span>
  1138→                              </div>
  1139→                            )}
  1140→
  1141→                            {/* Courtesy badge row */}
  1142→                            {(caseItem.courtesyRequired || caseItem.courtesyAllocationId) && (
  1143→                              <div className="flex items-center gap-1 mb-1.5 text-xs">
  1144→                                <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1145→                                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
  1146→                                </svg>
  1147→                                {caseItem.courtesyAllocationId ? (
  1148→                                  <span className="font-medium text-emerald-700">
  1149→                                    Courtesy: {caseItem.courtesyAllocation?.courtesyVehicle?.regCurrent || "Allocated"}
  1150→                                  </span>
  1151→                                ) : (
  1152→                                  <span className="font-medium text-amber-600">Courtesy needed</span>
  1153→                                )}
  1154→                              </div>
  1155→                            )}
  1156→
  1157→                            {/* Footer row: Days open + icons */}
  1158→                            <div className="flex items-center justify-between text-xs text-slate-500">
  1159→                              <span className="font-medium">{daysOpen}d open</span>
  1160→                              <div className="flex items-center gap-2">
  1161→                                {caseItem.partsRequired && (
  1162→                                  <span className="flex items-center gap-0.5 text-orange-600" title="Parts Required">
  1163→                                    <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1164→                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
  1165→                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
  1166→                                    </svg>
  1167→                                  </span>
  1168→                                )}
  1169→                                {attachmentCount > 0 && (
  1170→                                  <span className="flex items-center gap-0.5" title="Attachments">
  1171→                                    <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1172→                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
  1173→                                    </svg>
  1174→                                    {attachmentCount}
  1175→                                  </span>
  1176→                                )}
  1177→                                {activityCount > 0 && (
  1178→                                  <span className="flex items-center gap-0.5" title="Activity">
  1179→                                    <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1180→                                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
  1181→                                    </svg>
  1182→                                    {activityCount}
  1183→                                  </span>
  1184→                                )}
  1185→                              </div>
  1186→                            </div>
  1187→                          </div>
  1188→                        </div>
  1189→                      </div>
  1190→                    );
  1191→                  })}
  1192→                  {columnCases.length === 0 && (
  1193→                    <div className="text-center py-12 text-slate-400">
  1194→                      <p className="text-sm">No cases in {col.label}</p>
  1195→                    </div>
  1196→                  )}
  1197→                </div>
  1198→              );
  1199→            })}
  1200→          </div>
  1201→
  1202→          {/* Mobile Floating Action Button */}
  1203→          <button
  1204→            onClick={() => setShowAddModal(true)}
  1205→            className="md:hidden fixed fab-safe right-4 z-40 w-14 h-14 bg-[#0066CC] hover:bg-[#0055AA] text-white rounded-2xl shadow-lg shadow-[#0066CC]/30 flex items-center justify-center transition-all active:scale-95"
  1206→          >
  1207→            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1208→              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
  1209→            </svg>
  1210→          </button>
  1211→
  1212→          {/* Desktop Multi-Column View - Matching Sales & Prep exactly */}
  1213→          <div className="hidden md:flex gap-4 overflow-x-auto pb-6">
  1214→            {COLUMNS.map((col) => {
  1215→              const columnCases = getCasesByStatus(col.key);
  1216→              return (
  1217→                <div
  1218→                  key={col.key}
  1219→                  data-column-key={col.key}
  1220→                  className={`flex-shrink-0 w-64 bg-gradient-to-b ${col.gradient} to-transparent rounded-2xl p-3 min-h-[400px]`}
  1221→                  onDragOver={handleDragOver}
  1222→                  onDrop={(e) => handleDrop(e, col.key)}
  1223→                >
  1224→                  {/* Integrated Header - Same as Sales & Prep */}
  1225→                  <div className="flex items-center justify-between mb-3">
  1226→                    <div className="flex items-center gap-2">
  1227→                      <h3 className="font-semibold text-slate-700 text-sm">
  1228→                        {col.label}
  1229→                      </h3>
  1230→                      <span className="bg-slate-900/10 text-slate-700 w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center">
  1231→                        {columnCases.length}
  1232→                      </span>
  1233→                    </div>
  1234→                    <div className="dropdown dropdown-end">
  1235→                      <label tabIndex={0} className="btn btn-ghost btn-xs gap-1 bg-white/30 backdrop-blur-sm hover:bg-white/50 rounded-full">
  1236→                        <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
  1237→                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
  1238→                        </svg>
  1239→                        <span className="text-xs">
  1240→                          {columnSortOptions[col.key] === "newest_first" ? "Newest" :
  1241→                           columnSortOptions[col.key] === "alphabetical" ? "A-Z" : "Oldest"}
  1242→                        </span>
  1243→                      </label>
  1244→                      <ul tabIndex={0} className="dropdown-content z-30 menu p-2 shadow-lg bg-white rounded-xl w-44 mt-2">
  1245→                        <li>
  1246→                          <button
  1247→                            className={`rounded-lg ${columnSortOptions[col.key] === "oldest_first" || !columnSortOptions[col.key] ? "active bg-slate-100" : ""}`}
  1248→                            onClick={() => setColumnSortOptions(prev => ({ ...prev, [col.key]: "oldest_first" }))}
  1249→                          >
  1250→                            Oldest First
  1251→                          </button>
  1252→                        </li>
  1253→                        <li>
  1254→                          <button
  1255→                            className={`rounded-lg ${columnSortOptions[col.key] === "newest_first" ? "active bg-slate-100" : ""}`}
  1256→                            onClick={() => setColumnSortOptions(prev => ({ ...prev, [col.key]: "newest_first" }))}
  1257→                          >
  1258→                            Newest First
  1259→                          </button>
  1260→                        </li>
  1261→                        <li>
  1262→                          <button
  1263→                            className={`rounded-lg ${columnSortOptions[col.key] === "alphabetical" ? "active bg-slate-100" : ""}`}
  1264→                            onClick={() => setColumnSortOptions(prev => ({ ...prev, [col.key]: "alphabetical" }))}
  1265→                          >
  1266→                            Alphabetical (Name)
  1267→                          </button>
  1268→                        </li>
  1269→                      </ul>

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
